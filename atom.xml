<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>banban&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/0571ff454db1ab343c858f10a02ffebe</icon>
  <subtitle>Learn Anything, Anytime, Anywhere~</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://banbanpeppa.github.io/"/>
  <updated>2020-01-15T03:45:22.077Z</updated>
  <id>https://banbanpeppa.github.io/</id>
  
  <author>
    <name>Chen Zhi Ling</name>
    <email>wisteriasomnus@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>AngularJSä½¿ç”¨Echarts</title>
    <link href="https://banbanpeppa.github.io/2020/01/13/angularjs/ng-echarts/"/>
    <id>https://banbanpeppa.github.io/2020/01/13/angularjs/ng-echarts/</id>
    <published>2020-01-13T03:27:23.847Z</published>
    <updated>2020-01-15T03:45:22.077Z</updated>
    
    <content type="html"><![CDATA[<p>ğŸ¤ª</p><p>Echartsæä¾›äº†éå¸¸å¼ºå¤§çš„å¯è§†åŒ–åŠŸèƒ½ï¼Œåœ¨å¹³æ—¶çš„å¼€å‘è¿‡ç¨‹ä¸­éš¾å…ç”¨åˆ°echartsæ¥åŠ©åŠ›æ•°æ®å±•ç¤ºï¼Œæ¨åŠ¨æ•°æ®æ›´åŠ æ–¹ä¾¿ä½¿ç”¨ã€‚</p><p>é‚£ä¹ˆåœ¨Angularjsä¸­è¯¥å¦‚ä½•ä½¿ç”¨echartså‘¢ï¼Ÿä¸‹é¢æ’¸ä¸€ä¸ªä¾‹å­æ–¹ä¾¿åé¢å‚è€ƒã€‚</p><h2 id="æŒ‡ä»¤-amp-echarts"><a href="#æŒ‡ä»¤-amp-echarts" class="headerlink" title="æŒ‡ä»¤&amp;echarts"></a>æŒ‡ä»¤&amp;echarts</h2><p>AngularJSä¸­çš„æŒ‡ä»¤æ˜¯ä¸€ç§ç‰¹æœ‰çš„å¤„ç†DOMèŠ‚ç‚¹çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥æ“ä½œä»¥åŠæ¸²æŸ“å¯é‡ç”¨çš„UIç»„ä»¶ã€‚ä¾‹å¦‚æƒ³è¦ç”¨AngularJSå¤„ç†echartsçš„ä¸€ä¸ªæŸ±çŠ¶å›¾ğŸ“Šï¼Œåˆ™å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ“ä½œ</p><pre><code class="js">angular.module(&#39;demo&#39;)    .directive(&#39;myBarChart&#39;, function($window) { //å®šä¹‰æŸ±çŠ¶å›¾æŒ‡ä»¤        return {            restrict: &#39;EA&#39;, // ä»¥å±æ€§æˆ–è€…tagçš„å½¢å¼è°ƒç”¨æŒ‡ä»¤            link: function($scope, element, attrs) {  //attrs æ˜¯DOMå…ƒç´ çš„å±æ€§é›†åˆ                var myBarChart = echarts.init(element[0]); // elementæ˜¯ä¸€ä¸ªjqliteå¯¹è±¡ï¼Œå¦‚æœJQueryå†AngularJSä¹‹å‰å¼•å…¥ï¼Œåˆ™æ˜¯ä¸€ä¸ªJqueryå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨Jqueryæ‰€æœ‰çš„æ–¹æ³•                $scope.$watch(attrs.eData, function(newVal, oldVal, scope) {//ç›‘å¬å±æ€§e-dataçš„å€¼ï¼Œå½“æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶æ‰§è¡Œä½œä¸ºç¬¬äºŒä¸ªå‚æ•°çš„å‡½æ•°                    var xData = [],                        sData = [],                        data = newVal,                        totalCount = 0;                    angular.forEach(data, function(val) {                        xData.push(val.name);                        sData.push(val.value);                        totalCount += val.value;                    });                    var option = {                        title: {                            text: &#39;ç”¨æˆ·è®¿é—®æ¥æºç»Ÿè®¡&#39;,                            subtext: &#39;æ€»è®¡å€¼:&#39; + totalCount,                            x: &#39;center&#39;,                        },                        color: [&#39;#333642&#39;],                        tooltip: {                            trigger: &#39;axis&#39;,                            axisPointer: {                                type: &#39;shadow&#39;                            }                        },                        grid: {                            left: &#39;3%&#39;,                            right: &#39;4%&#39;,                            bottom: &#39;3%&#39;,                            containLabel: true                        },                        xAxis: [{                            type: &#39;category&#39;,                            data: xData,                            axisTick: {                            alignWithLabel: true                            }                        }],                        yAxis: [{                            type: &#39;value&#39;                        }],                        series: [{                            name: &#39;ç›´æ¥è®¿é—®&#39;,                            type: &#39;bar&#39;,                            barWidth: &#39;60%&#39;,                            data: sData                        }]                    };                    myBarChart.setOption(option);                }, true);                $window.onresize = function() {                    myBarChart.resize();                }            }        }    });</code></pre><p>é€šè¿‡æŒ‡ä»¤å¤„ç†å¥½äº†ç»„ä»¶ä¹‹åï¼Œä¾¿å¯ä»¥åœ¨ä¹‹åçš„å¼€å‘ä¸­ä½¿ç”¨ç»„ä»¶ã€‚</p><h2 id="ä½¿ç”¨echartsæŒ‡ä»¤"><a href="#ä½¿ç”¨echartsæŒ‡ä»¤" class="headerlink" title="ä½¿ç”¨echartsæŒ‡ä»¤"></a>ä½¿ç”¨echartsæŒ‡ä»¤</h2><p><strong>JavaScript</strong></p><pre><code class="js">var app = angular.module(&quot;demo&quot;, []); //å®šä¹‰ä¸€ä¸ªæ¨¡å—angular.module(&quot;demo&quot;).controller(&quot;myCtrl&quot;, function($scope, $http, $interval) {  //å®šä¹‰æ§åˆ¶å™¨  $interval(function() {    //è°ƒç”¨$intervalæœåŠ¡æ‰§è¡Œå¾ªç¯ä»»åŠ¡ï¼Œ3ç§’è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡æ•°æ®    $http      .get(&quot;/demo_get&quot;) //è°ƒç”¨$httpæœåŠ¡è·å–æ•°æ®      .success(function(data) {        if (data.status == &quot;0&quot;) {          $scope.data = data.data; //å°†æ•°æ®æ”¾åœ¨modelä¸­        }      })      .error(function() {        $scope.data[0].value = Math.floor(Math.random() * 2000); //æ¨¡æ‹Ÿæ•°æ®æ”¹å˜æµ‹è¯•      });  }, 5000);  //å‡è®¾è·å–åˆ°çš„æ•°æ®å¦‚ä¸‹ï¼š  var fakeData = {    status: 0,    data: [      {        value: 335,        name: &quot;ç›´æ¥è®¿é—®&quot;      },      {        value: 310,        name: &quot;é‚®ä»¶è¥é”€&quot;      },      {        value: 234,        name: &quot;å¾®ä¿¡è·³è½¬&quot;      },      {        value: 135,        name: &quot;è§†é¢‘å¹¿å‘Š&quot;      },      {        value: 748,        name: &quot;æœç´¢å¼•æ“&quot;      }    ]  };  $scope.data = fakeData.data;});</code></pre><p><strong>HTML</strong></p><pre><code class="html">&lt;div ng-app=&quot;demo&quot; ng-controller=&quot;myCtrl&quot; id=&quot;demo&quot;&gt;  &lt;div style=&quot;height:320px;&quot; my-bar-chart e-data=&quot;data&quot;&gt;&lt;/div&gt;&lt;/div&gt;</code></pre><p>æ•´ä½“æ•ˆæœå¯ä»¥å‚è€ƒï¼š<a href="https://codepen.io/zhilingsomnus/pen/mdyjqKX?editors=1010" target="_blank" rel="noopener">https://codepen.io/zhilingsomnus/pen/mdyjqKX?editors=1010</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ğŸ¤ª&lt;/p&gt;
&lt;p&gt;Echartsæä¾›äº†éå¸¸å¼ºå¤§çš„å¯è§†åŒ–åŠŸèƒ½ï¼Œåœ¨å¹³æ—¶çš„å¼€å‘è¿‡ç¨‹ä¸­éš¾å…ç”¨åˆ°echartsæ¥åŠ©åŠ›æ•°æ®å±•ç¤ºï¼Œæ¨åŠ¨æ•°æ®æ›´åŠ æ–¹ä¾¿ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆåœ¨Angularjsä¸­è¯¥å¦‚ä½•ä½¿ç”¨echartså‘¢ï¼Ÿä¸‹é¢æ’¸ä¸€ä¸ªä¾‹å­æ–¹ä¾¿åé¢å‚è€ƒã€‚&lt;/p&gt;
&lt;h2 id=&quot;æŒ‡ä»¤-am
      
    
    </summary>
    
    
      <category term="AngularJS" scheme="https://banbanpeppa.github.io/tags/AngularJS/"/>
    
  </entry>
  
  <entry>
    <title>[è½¬] å…³äº Angular é‡Œçš„ $q å’Œ Promise</title>
    <link href="https://banbanpeppa.github.io/2019/11/10/angularjs/promise/"/>
    <id>https://banbanpeppa.github.io/2019/11/10/angularjs/promise/</id>
    <published>2019-11-10T15:25:18.619Z</published>
    <updated>2019-11-10T15:27:33.878Z</updated>
    
    <content type="html"><![CDATA[<p>é“¾æ¥ï¼š<a href="https://llp0574.github.io/2016/12/07/All-about-and-Promises-in-Angular/" target="_blank" rel="noopener">å…³äº Angular é‡Œçš„ $q å’Œ Promise</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é“¾æ¥ï¼š&lt;a href=&quot;https://llp0574.github.io/2016/12/07/All-about-and-Promises-in-Angular/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å…³äº Angular é‡Œçš„ $q å’Œ Pr
      
    
    </summary>
    
    
      <category term="AngularJS" scheme="https://banbanpeppa.github.io/tags/AngularJS/"/>
    
  </entry>
  
  <entry>
    <title>Logstashæ€§èƒ½è°ƒä¼˜</title>
    <link href="https://banbanpeppa.github.io/2019/11/10/bigdata/elk/logstash_performance_tuning/"/>
    <id>https://banbanpeppa.github.io/2019/11/10/bigdata/elk/logstash_performance_tuning/</id>
    <published>2019-11-10T13:32:52.629Z</published>
    <updated>2019-11-10T13:53:10.781Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Logstashæ€§èƒ½è°ƒä¼˜"><a href="#Logstashæ€§èƒ½è°ƒä¼˜" class="headerlink" title="Logstashæ€§èƒ½è°ƒä¼˜"></a>Logstashæ€§èƒ½è°ƒä¼˜</h1><p><a href="https://www.elastic.co/guide/en/logstash/current/performance-tuning.html" target="_blank" rel="noopener">è¯¦ç»†è°ƒä¼˜å‚è€ƒ</a></p><h2 id="Inputså’ŒOutputsçš„æ€§èƒ½"><a href="#Inputså’ŒOutputsçš„æ€§èƒ½" class="headerlink" title="Inputså’ŒOutputsçš„æ€§èƒ½"></a>Inputså’ŒOutputsçš„æ€§èƒ½</h2><p>å½“è¾“å…¥è¾“å‡ºæºçš„æ€§èƒ½å·²ç»è¾¾åˆ°ä¸Šé™ï¼Œé‚£ä¹ˆæ€§èƒ½ç“¶é¢ˆä¸åœ¨Logstashï¼Œåº”ä¼˜å…ˆå¯¹è¾“å…¥è¾“å‡ºæºçš„æ€§èƒ½è¿›è¡Œè°ƒä¼˜ã€‚  </p><h2 id="ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼š"><a href="#ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼š" class="headerlink" title="ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼š"></a>ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼š</h2><ul><li>CPU<ul><li>ç¡®å®šCPUä½¿ç”¨ç‡æ˜¯å¦è¿‡é«˜ï¼Œå¦‚æœCPUè¿‡é«˜åˆ™å…ˆæŸ¥çœ‹JVMå †ç©ºé—´ä½¿ç”¨ç‡éƒ¨åˆ†ï¼Œç¡®è®¤æ˜¯å¦ä¸ºGCé¢‘ç¹å¯¼è‡´ï¼Œå¦‚æœGCæ­£å¸¸ï¼Œåˆ™å¯ä»¥é€šè¿‡è°ƒèŠ‚Logstash workerç›¸å…³é…ç½®æ¥è§£å†³ã€‚</li></ul></li><li>å†…å­˜<ul><li>ç”±äºLogstashè¿è¡Œåœ¨JVMä¸Šï¼Œå› æ­¤æ³¨æ„è°ƒæ•´JVMå †ç©ºé—´ä¸Šé™ï¼Œä»¥ä¾¿å…¶æœ‰è¶³å¤Ÿçš„è¿è¡Œç©ºé—´ã€‚å¦å¤–æ³¨æ„Logstashæ‰€åœ¨æœºå™¨ä¸Šæ˜¯å¦æœ‰å…¶ä»–åº”ç”¨å ç”¨äº†å¤§é‡å†…å­˜ï¼Œå¯¼è‡´Logstashå†…å­˜ç£ç›˜äº¤æ¢é¢‘ç¹ã€‚</li></ul></li><li>I/Oä½¿ç”¨ç‡<br>1ï¼‰ç£ç›˜IOï¼š<br>  ç£ç›˜IOé¥±å’Œå¯èƒ½æ˜¯å› ä¸ºä½¿ç”¨äº†ä¼šå¯¼è‡´ç£ç›˜IOé¥±å’Œçš„åˆ›å»ºï¼ˆå¦‚file outputï¼‰,å¦å¤–Logstashä¸­å‡ºç°é”™è¯¯äº§ç”Ÿå¤§é‡é”™è¯¯æ—¥å¿—æ—¶ä¹Ÿä¼šå¯¼è‡´ç£ç›˜IOé¥±å’Œã€‚Linuxä¸‹å¯ä»¥é€šè¿‡iostat, dstatç­‰æŸ¥çœ‹ç£ç›˜IOæƒ…å†µ<br>2ï¼‰ç½‘ç»œIOï¼š<br>  ç½‘ç»œIOé¥±å’Œä¸€èˆ¬å‘ç”Ÿåœ¨ä½¿ç”¨æœ‰å¤§é‡ç½‘ç»œæ“ä½œçš„æ’ä»¶æ—¶ã€‚linuxä¸‹å¯ä»¥ä½¿ç”¨dstatæˆ–iftopç­‰æŸ¥çœ‹ç½‘ç»œIOæƒ…å†µ<br>3ï¼‰JVMå †æ£€æŸ¥ï¼š    <pre><code>1ã€å¦‚æœJVMå †å¤§å°è®¾ç½®è¿‡å°ä¼šå¯¼è‡´GCé¢‘ç¹ï¼Œä»è€Œå¯¼è‡´CPUä½¿ç”¨ç‡è¿‡é«˜  2ã€å¿«é€ŸéªŒè¯è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯doubleå †å¤§å°ï¼Œçœ‹æ€§èƒ½æ˜¯å¦æœ‰æå‡ã€‚æ³¨æ„è¦ç»™ç³»ç»Ÿè‡³å°‘é¢„ç•™1GBçš„ç©ºé—´ã€‚  3ã€ä¸ºäº†ç²¾ç¡®æŸ¥æ‰¾é—®é¢˜å¯ä»¥ä½¿ç”¨jmapæˆ–VisualVMã€‚[å‚è€ƒ](https://www.elastic.co/guide/en/logstash/current/tuning-logstash.html#profiling-the-heap)4ã€è®¾ç½®Xmså’ŒXmxä¸ºç›¸åŒå€¼ï¼Œé˜²æ­¢å †å¤§å°åœ¨è¿è¡Œæ—¶è°ƒæ•´ï¼Œè¿™ä¸ªè¿‡ç¨‹éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</code></pre>4ï¼‰Logstash workerè®¾ç½®ï¼š<br>workerç›¸å…³é…ç½®åœ¨logstash.ymlä¸­ï¼Œä¸»è¦åŒ…æ‹¬å¦‚ä¸‹ä¸‰ä¸ªï¼š<ul><li>pipeline.workersï¼š<br>è¯¥å‚æ•°ç”¨ä»¥æŒ‡å®šLogstashä¸­æ‰§è¡Œfilterå’Œoutputçš„çº¿ç¨‹æ•°ï¼Œå½“å¦‚æœå‘ç°CPUä½¿ç”¨ç‡å°šæœªè¾¾åˆ°ä¸Šé™ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´è¯¥å‚æ•°ï¼Œä¸ºLogstashæä¾›æ›´é«˜çš„æ€§èƒ½ã€‚å»ºè®®å°†Workeræ•°è®¾ç½®é€‚å½“è¶…è¿‡CPUæ ¸æ•°å¯ä»¥å‡å°‘IOç­‰å¾…æ—¶é—´å¯¹å¤„ç†è¿‡ç¨‹çš„å½±å“ã€‚å®é™…è°ƒä¼˜ä¸­å¯ä»¥å…ˆé€šè¿‡-wæŒ‡å®šè¯¥å‚æ•°ï¼Œå½“ç¡®å®šå¥½æ•°å€¼åå†å†™å…¥é…ç½®æ–‡ä»¶ä¸­ã€‚</li><li>pipeline.batch.size:<br>è¯¥æŒ‡æ ‡ç”¨äºæŒ‡å®šå•ä¸ªworkerçº¿ç¨‹ä¸€æ¬¡æ€§æ‰§è¡Œflilterå’Œoutputçš„eventæ‰¹é‡æ•°ã€‚å¢å¤§è¯¥å€¼å¯ä»¥å‡å°‘IOæ¬¡æ•°ï¼Œæé«˜å¤„ç†é€Ÿåº¦ï¼Œä½†æ˜¯ä¹Ÿä»¥ä¸ºè¿™å¢åŠ å†…å­˜ç­‰èµ„æºçš„æ¶ˆè€—ã€‚å½“ä¸Elasticsearchè”ç”¨æ—¶ï¼Œè¯¥å€¼å¯ä»¥ç”¨äºæŒ‡å®šElasticsearchä¸€æ¬¡bluckæ“ä½œçš„å¤§å°ã€‚</li><li>pipeline.batch.delay:<br>è¯¥æŒ‡æ ‡ç”¨äºæŒ‡å®šworkerç­‰å¾…æ—¶é—´çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœworkeråœ¨è¯¥æ—¶é—´å†…æ²¡æœ‰ç­‰åˆ°pipeline.batch.sizeä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆå°†ç›´æ¥å¼€å§‹æ‰§è¡Œfilterå’Œoutputè€Œä¸å†ç­‰å¾…ã€‚</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Logstashæ€§èƒ½è°ƒä¼˜&quot;&gt;&lt;a href=&quot;#Logstashæ€§èƒ½è°ƒä¼˜&quot; class=&quot;headerlink&quot; title=&quot;Logstashæ€§èƒ½è°ƒä¼˜&quot;&gt;&lt;/a&gt;Logstashæ€§èƒ½è°ƒä¼˜&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://www.elastic.c
      
    
    </summary>
    
    
      <category term="Big Data" scheme="https://banbanpeppa.github.io/tags/Big-Data/"/>
    
      <category term="ELK" scheme="https://banbanpeppa.github.io/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>AngularJSå®ç°input autofocuså±æ€§</title>
    <link href="https://banbanpeppa.github.io/2019/10/10/angularjs/ng-focus/"/>
    <id>https://banbanpeppa.github.io/2019/10/10/angularjs/ng-focus/</id>
    <published>2019-10-10T04:06:31.701Z</published>
    <updated>2019-10-11T11:47:05.906Z</updated>
    
    <content type="html"><![CDATA[<h1 id="AngularJSå®ç°input-focusèšç„¦"><a href="#AngularJSå®ç°input-focusèšç„¦" class="headerlink" title="AngularJSå®ç°input focusèšç„¦"></a>AngularJSå®ç°input focusèšç„¦</h1><p>AngularJSé€šè¿‡æŒ‡ä»¤çš„æ–°å±æ€§æ¥æ‰©å±•HTMLï¼Œå…¶å†…ç½®äº†è®¸å¤šæŒ‡ä»¤æ¥ä¸ºåº”ç”¨æ·»åŠ åŠŸèƒ½ï¼Œæœ€å¸¸è§çš„æŒ‡ä»¤å¦‚<code>ng-app</code>ã€<code>ng-model</code>ã€<code>ng-bind</code>ç­‰ç­‰ï¼ŒåŒæ—¶AngularJSè¿˜æä¾›äº†ç”¨æˆ·è‡ªå®šä¹‰æŒ‡ä»¤åŠŸèƒ½ã€‚</p><p><strong>é€šè¿‡derectiveå®ç°è‡ªå®šä¹‰focusèšç„¦</strong></p><p>ä¸ºäº†èƒ½å¤Ÿè®©inputæ ‡ç­¾å…·æœ‰è‡ªåŠ¨è·å–ç„¦ç‚¹çš„èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä¸€ä¸ªæŒ‡ä»¤æ¥å®ç°ã€‚å…·ä½“çš„å®ç°å¦‚ä¸‹</p><pre><code class="js">var app = angular.module(&#39;plunker&#39;, []);var MyCtrl = function ($scope, $timeout) {};app.directive(&#39;customFocus&#39;, function($timeout) {  return {    scope: { trigger: &#39;=customFocus&#39; },    link: function(scope, element) {      scope.$watch(&#39;trigger&#39;, function(value) {        if(value === true) {           $timeout(function() {            element[0].focus();            scope.trigger = false;          });        }      });    }  };});</code></pre><p>ä¹‹ååœ¨htmlçš„inputæ ‡ç­¾ä¸­å¯ä»¥è¿™ä¹ˆä½¿ç”¨</p><pre><code class="html">&lt;html ng-app=&quot;plunker&quot;&gt;  &lt;head&gt;    &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/angularjs/1.0.4/angular.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;example.js&quot;&gt;&lt;/script&gt;    &lt;link href=&quot;https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css&quot; rel=&quot;stylesheet&quot;&gt;  &lt;/head&gt;  &lt;body&gt;&lt;div ng-controller=&quot;MyCtrl&quot;&gt;    &lt;button class=&quot;btn&quot;  ng-click=&quot;showForm=true;focusInput=true&quot;&gt;show form and focus input&lt;/button&gt;    &lt;div ng-show=&quot;showForm&quot;&gt;      &lt;input type=&quot;text&quot; custom-focus=&quot;focusInput&quot;&gt;      &lt;button class=&quot;btn&quot; ng-click=&quot;showForm=false&quot;&gt;hide form&lt;/button&gt;    &lt;/div&gt;&lt;/div&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p><a href="https://codepen.io/marco27384/pen/GqgZXo" target="_blank" rel="noopener">ã€ç¤ºä¾‹ã€‘</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;AngularJSå®ç°input-focusèšç„¦&quot;&gt;&lt;a href=&quot;#AngularJSå®ç°input-focusèšç„¦&quot; class=&quot;headerlink&quot; title=&quot;AngularJSå®ç°input focusèšç„¦&quot;&gt;&lt;/a&gt;AngularJSå®ç°inp
      
    
    </summary>
    
    
      <category term="AngularJS" scheme="https://banbanpeppa.github.io/tags/AngularJS/"/>
    
  </entry>
  
  <entry>
    <title>v2ray + websocket + nginx</title>
    <link href="https://banbanpeppa.github.io/2019/10/09/essay/v2ray_ws/"/>
    <id>https://banbanpeppa.github.io/2019/10/09/essay/v2ray_ws/</id>
    <published>2019-10-09T15:01:00.000Z</published>
    <updated>2019-10-11T11:42:05.840Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…v2ray"><a href="#å®‰è£…v2ray" class="headerlink" title="å®‰è£…v2ray"></a>å®‰è£…v2ray</h2><pre><code class="bash">bash &lt;(curl -L -s https://install.direct/go.sh)systemctl status v2ray</code></pre><h2 id="é…ç½®v2ray"><a href="#é…ç½®v2ray" class="headerlink" title="é…ç½®v2ray"></a>é…ç½®v2ray</h2><p>å…·ä½“çš„åšæ³•å’Œå¦ä¸€ç¯‡æ–‡ç« <a href="/2019/03/29/essay/v2ray/">ã€Šæ­å»ºv2rayã€‹</a>ä¸€æ ·ï¼Œåªæ˜¯å…¶ä¸­çš„é…ç½®æ–‡ä»¶æ›¿æ¢ä¸ºç”¨websocketï¼Œå¦‚ä¸‹</p><pre><code class="json">{  &quot;log&quot; : {    &quot;access&quot;: &quot;/var/log/v2ray/access.log&quot;,    &quot;error&quot;: &quot;/var/log/v2ray/error.log&quot;,    &quot;loglevel&quot;: &quot;warning&quot;  },  &quot;inbound&quot;: {    &quot;port&quot;: 9000,    &quot;listen&quot;: &quot;127.0.0.1&quot;,    &quot;protocol&quot;: &quot;vmess&quot;,    &quot;settings&quot;: {      &quot;clients&quot;: [        {          &quot;id&quot;: &quot;8d837310-8120-ca48-748e-830359e454b9&quot;,          &quot;level&quot;: 1,          &quot;alterId&quot;: 64        }      ]    },   &quot;streamSettings&quot;:{      &quot;network&quot;: &quot;ws&quot;,      &quot;wsSettings&quot;: {           &quot;path&quot;: &quot;/v2ray&quot;      }   }  },  &quot;outbound&quot;: {    &quot;protocol&quot;: &quot;freedom&quot;,    &quot;settings&quot;: {}  },  &quot;outboundDetour&quot;: [    {      &quot;protocol&quot;: &quot;blackhole&quot;,      &quot;settings&quot;: {},      &quot;tag&quot;: &quot;blocked&quot;    }  ],  &quot;routing&quot;: {    &quot;strategy&quot;: &quot;rules&quot;,    &quot;settings&quot;: {      &quot;rules&quot;: [        {          &quot;type&quot;: &quot;field&quot;,          &quot;ip&quot;: [            &quot;0.0.0.0/8&quot;,            &quot;10.0.0.0/8&quot;,            &quot;100.64.0.0/10&quot;,            &quot;127.0.0.0/8&quot;,            &quot;169.254.0.0/16&quot;,            &quot;172.16.0.0/12&quot;,            &quot;192.0.0.0/24&quot;,            &quot;192.0.2.0/24&quot;,            &quot;192.168.0.0/16&quot;,            &quot;198.18.0.0/15&quot;,            &quot;198.51.100.0/24&quot;,            &quot;203.0.113.0/24&quot;,            &quot;::1/128&quot;,            &quot;fc00::/7&quot;,            &quot;fe80::/10&quot;          ],          &quot;outboundTag&quot;: &quot;blocked&quot;        }      ]    }  }}</code></pre><h2 id="é…ç½®nginx"><a href="#é…ç½®nginx" class="headerlink" title="é…ç½®nginx"></a>é…ç½®nginx</h2><p>å®‰è£…</p><pre><code class="bash">apt install nginx</code></pre><p>é…ç½®<code>/etc/nginx/conf.d/v2ray.conf</code>ï¼Œå¦‚ä¸‹</p><pre><code class="json">/etc/nginx/conf.d# cat v2ray.conf server {    listen 443;    server_name ip.address.of.your.vps;    location /v2ray {        proxy_redirect off;        proxy_pass http://127.0.0.1:9000;        proxy_http_version 1.1;        proxy_set_header Upgrade $http_upgrade;        proxy_set_header Connection &quot;upgrade&quot;;        proxy_set_header Host $http_host;    }}</code></pre><p>ä¸ºäº†å…è®¸è®¿é—®è€…è®¿é—®nginxç«™ç‚¹ï¼Œæ‚¨éœ€è¦æ‰“å¼€ç«¯å£80å’Œ443ï¼š</p><pre><code class="bash">apt install -y firewalldfirewall-cmd --permanent --zone=public --add-service=http firewall-cmd --permanent --zone=public --add-service=httpsfirewall-cmd --reload</code></pre><h2 id="é…ç½®V2rayX"><a href="#é…ç½®V2rayX" class="headerlink" title="é…ç½®V2rayX"></a>é…ç½®V2rayX</h2><p>å¯åŠ¨v2rayxä¹‹åä¼šæœ‰è¿™æ ·ä¸€ä¸ªå›¾æ ‡<br><img src="/images/essay/v2ray/v2rayx_status.png" alt="image"><br>ç‚¹å‡»Configureè¿›å…¥é…ç½®<br><img src="/images/essay/v2ray/v2rayx_config.png" alt="image"><br><img src="/images/essay/v2ray/v2rayx_config_detail.png" alt="image"><br>æ¥ä¸‹æ¥ç‚¹å‡»transport settingsè¿›å…¥é…ç½®</p><p>é…ç½®websocket<br><img src="/images/essay/v2ray/v2rayx_ws_config.png" alt="image"><br>é…ç½®http/2<br><img src="/images/essay/v2ray/v2rayx_http_config.png" alt="image"><br>é…ç½®tls<br><img src="/images/essay/v2ray/v2rayx_tls_config.png" alt="image"></p><p>åœ¨å¼€å¯æœåŠ¡ç«¯V2rayå’ŒnginxæœåŠ¡åï¼ŒGoogle itï¼</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://segmentfault.com/a/1190000018242765" target="_blank" rel="noopener">V2ray+websocket+tls+caddy+serverSpeeder</a></li><li><a href="https://www.muzilong.cn/storage/html/185/blog.itswcg.com/2019-02/update-vpn.html" target="_blank" rel="noopener">ç§‘å­¦ä¸Šç½‘2.0ï¼šv2ray+websocket+nginx</a></li><li><a href="https://www.xpath.org/blog/001531048571577582cfa0ea2804e5f9cb224de052a4975000" target="_blank" rel="noopener">v2ray +tls + websocket + nginx é…ç½®ä¸ä½¿ç”¨</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å®‰è£…v2ray&quot;&gt;&lt;a href=&quot;#å®‰è£…v2ray&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…v2ray&quot;&gt;&lt;/a&gt;å®‰è£…v2ray&lt;/h2&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;bash &amp;lt;(curl -L -s https://
      
    
    </summary>
    
    
      <category term="éšç¬”" scheme="https://banbanpeppa.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>rsync - æ–‡ä»¶åŒæ­¥ä¸ä¼ è¾“ç¥å™¨</title>
    <link href="https://banbanpeppa.github.io/2019/09/18/linux/rsync/"/>
    <id>https://banbanpeppa.github.io/2019/09/18/linux/rsync/</id>
    <published>2019-09-18T06:44:00.000Z</published>
    <updated>2019-10-01T09:19:38.523Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶åŒæ­¥ç¥å™¨-â€”â€”-Rsync"><a href="#æ–‡ä»¶åŒæ­¥ç¥å™¨-â€”â€”-Rsync" class="headerlink" title="æ–‡ä»¶åŒæ­¥ç¥å™¨ â€”â€” Rsync"></a>æ–‡ä»¶åŒæ­¥ç¥å™¨ â€”â€” Rsync</h1><p><img src="/images/linux/rsynclogo.jpg" alt="image"></p><p>Rsyncä½œä¸ºæ–‡ä»¶åŒæ­¥å·¥å…·ï¼Œå…¶åœ¨è®¸å¤šåœºæ™¯ä¸‹éƒ½æä¾›äº†ä¾¿æ·ã€‚ä¸ºäº†å®ç°æ–‡ä»¶ä¼ è¾“ï¼Œç”¨æˆ·ä¼šä½¿ç”¨<code>scp</code>å·¥å…·ï¼ŒğŸ¤ <code>scp</code>å·¥å…·æ˜¯åŸºäºsshåè®®æ¥è®¾è®¡çš„ï¼Œå…¶åœ¨å®‰å…¨æ€§ä¸Šé¢ä¼˜åŠ¿æ˜æ˜¾ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨å¦‚ä¸‹åœºæ™¯ï¼Œ<code>scp</code>æ— ç–‘æ˜¯ä¸€ç§æ¯”è¾ƒæµªè´¹èµ„æºå¹¶ä¸”æ¯”è¾ƒä½æ•ˆçš„åšæ³•ï¼š</p><p>å½“ä¼ è¾“çš„æ–‡ä»¶ç»å¸¸é¢ä¸´ä¿®æ”¹æˆ–è€…å‘ç”Ÿå˜æ›´ï¼Œä¾‹å¦‚ä»£ç ï¼Œä½¿ç”¨scpä¼šå…¨é‡è¿›è¡Œè¦†ç›–ï¼Œæ¯ä¸€æ¬¡éƒ½ä¼šè¿›è¡Œæ‰€æœ‰æ–‡ä»¶çš„å¤åˆ¶ï¼Œå¹¶ä¸”è¦†ç›–ã€‚</p><p>è¿™ä¸ªæ—¶å€™é€šå¸¸ä¼šé‡‡ç”¨<code>rsync</code>çš„æ–¹å¼æ¥åŒæ­¥æ–‡ä»¶ï¼Œå®ç°å¢é‡å¼ä¼ è¾“æ–‡ä»¶ï¼Œè¿™æ ·èƒ½å¤Ÿæå¤§æå‡æ–‡ä»¶çš„ä¼ è¾“æ•ˆç‡ã€‚</p><h2 id="scp-vs-rsync"><a href="#scp-vs-rsync" class="headerlink" title="scp vs rsync"></a>scp vs rsync</h2><p>1. å¯¹æ¯”é»˜è®¤å‚æ•°ä¸‹, ä¸¤ç§æ–¹å¼æ¶ˆè€—çš„ç³»ç»Ÿèµ„æºæƒ…å†µ</p><ul><li>åœ¨éƒ½æ˜¯ç©ºç›®å½•çš„æƒ…å†µä¸‹åŒæ­¥ä¿¡æ¯ï¼Œscpå’Œrsyncçš„æ‰§è¡Œæ•ˆç‡ç›¸å½“ï¼Œåœ¨ä¸€ä¸ªé‡çº§ï¼Œä½†æ˜¯å½“å·²ç»åŒæ­¥è¿‡ä¸€æ¬¡ä¹‹åï¼Œåœ¨åç»­åŒæ­¥å†…å®¹çš„è¿‡ç¨‹ä¸­ä¼šçœ‹åˆ°åŒæ­¥çš„æ•ˆç‡rsyncå¿«äº†éå¸¸å¤šï¼Œè¿™æ˜¯å› ä¸ºscpæ˜¯å¤åˆ¶ï¼Œè€Œrsyncæ˜¯è¦†ç›–ã€‚</li></ul><p>2. åœ¨æœåŠ¡å™¨ç«¯å­˜åœ¨å¯¹åº”æœåŠ¡çš„æ¡ä»¶ä¸‹</p><ul><li>scpæ˜¯åŠ å¯†çš„</li><li>rsyncæœ¬èº«æ˜¯ä¸åŠ å¯†çš„ï¼Œé™¤éé…ç½®äº†ä½¿ç”¨sshé€šé“æˆ–è€…vpné€šé“ï¼Œä¸ºæ­¤ysyncçš„ä¼ è¾“æ•ˆç‡ä¼šæ¯”è¾ƒé«˜ã€‚</li></ul><p>3. scpå’Œrsyncçš„å…·ä½“é€‚ç”¨åœºæ™¯</p><ul><li>å¦‚æœæ˜¯é¢‘ç¹æ›´æ–°çš„æ–‡ä»¶å¹¶ä¸”æ˜¯å°æ–‡ä»¶ï¼Œåˆ™å»ºè®®ä½¿ç”¨rsync</li><li>å¦‚æœæ˜¯å¾ˆå°‘æ›´æ–°çš„æ–‡ä»¶ï¼Œå»ºè®®ä½¿ç”¨scpï¼Œç®€å•æ–¹ä¾¿å¿«æ·ï¼ŒåŒæ—¶è¿˜æ˜¯åŠ å¯†ä¼ è¾“</li></ul><h2 id="rsyncå®‰è£…"><a href="#rsyncå®‰è£…" class="headerlink" title="rsyncå®‰è£…"></a>rsyncå®‰è£…</h2><p>rsync å‘½ä»¤åœ¨å¤§éƒ¨åˆ†çš„Unixæˆ–è€…Linuxç³»ç»Ÿä¸Šé¢éƒ½é¢„è£…äº†ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…ã€‚</p><p>åœ¨CentOS &amp; RHELç³»ç»Ÿä¸Šæ‰§è¡Œ</p><pre><code class="sh">yum install rsync -y</code></pre><p>åœ¨Debianç³»æ“ä½œç³»ç»Ÿä¸­(Ubuntu &amp; Linux Mint)æ‰§è¡Œ</p><pre><code class="sh">apt install rsync -y</code></pre><h2 id="rsyncå‘½ä»¤"><a href="#rsyncå‘½ä»¤" class="headerlink" title="rsyncå‘½ä»¤"></a>rsyncå‘½ä»¤</h2><p><img src="/images/linux/rsync-command-example-linux.jpg" alt="image"></p><p>rsyncçš„å‘½ä»¤å‚æ•°ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹</p><pre><code class="js">rsync      -a  å½’æ¡£æ¨¡å¼ï¼Œè¡¨ç¤ºä»¥é€’å½’æ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œå¹¶ä¿æŒæ‰€æœ‰å±æ€§    -r  å¯¹äºç›®å½•ä»¥é€’å½’æ¨¡å¼å¤„ç†ï¼Œä¸»è¦é’ˆå¯¹ç›®å½•ï¼Œä¼ è¾“çš„æ˜¯ç›®å½•å¿…é¡»åŠ -r    -v  æ‰“å°ä¸€äº›ä¿¡æ¯å‡ºæ¥ï¼Œæ¯”å¦‚é€Ÿç‡ï¼Œæ–‡ä»¶æ•°é‡ç­‰ã€‚    -l  ä¿ç•™è½¯è¿é“¾    -L  å‘å¯¹å¾…å¸¸è§„æ–‡ä»¶ä¸€æ ·å¤„ç†è½¯é“¾æ¥ï¼Œå¦‚æœæ˜¯src(æºæœº)ä¸­æœ‰è½¯é“¾æ¥æ–‡ä»¶ï¼ŒåˆšåŠ ä¸Šè¯¥é€‰é¡¹åä¼šæŠŠè½¯è¿æ¥æŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶æ‹·è´åˆ°dstï¼ˆç›®æ ‡æœºï¼‰    -p  ä¿æŒæ–‡ä»¶æƒé™    -o  ä¿æŒæ–‡ä»¶å±ä¸»ä¿¡æ¯    -g  ä¿æŒæ–‡ä»¶å±ç»„ä¿¡æ¯    -D  ä¿æŒ è®¾å¤‡æ–‡ä»¶ä¿¡æ¯    -t  ä¿æŒ æ–‡ä»¶æ—¶é—´ä¿¡æ¯    --delete åˆ é™¤é‚£äº›dstä¸­srcæ²¡æœ‰çš„æ–‡ä»¶    --exclude=PATTERNæŒ‡å®šæ’é™¤ä¸éœ€è¦ä¼ è¾“çš„æ–‡ä»¶ï¼Œç­‰å·åé¢è·Ÿæ–‡ä»¶åï¼Œå¯ä»¥æ˜¯ä¸‡ç”¨å­—ç¬¦æ¨¡å¼ï¼ˆå¦‚*.txtï¼‰        PATTERNè·¯å¾„æ˜¯ç›¸å¯¹å¼„è¦åŒæ­¥çš„è·¯å¾„å¦‚(rsync -avPz --exclude=zabbix /opt/sh 10.8.64.99::backup/tmp/ #æ’é™¤çš„æ˜¯/opt/sh/zabbix)    --progressæˆ–-P åœ¨åŒæ­¥çš„è¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°åŒæ­¥çš„è¿‡ç¨‹çŠ¶æ€ï¼Œæ¯”å¦‚ç»Ÿè®¡è¦åŒæ­¥çš„æ–‡ä»¶æ•°é‡ï¼ŒåŒæ­¥çš„æ–‡ä»¶ä¼ è¾“é€Ÿåº¦ç­‰ç­‰ã€‚ã€‚ã€‚    --bwlimit=10 ï¼ˆé™åˆ¶ä¼ è¾“é€Ÿåº¦ï¼‰    -u  åŠ ä¸Šè¿™ä¸ªé€‰é¡¹åå°†ä¼šæŠŠDSTä¸­æ¯”SRCè¿˜æ–°çš„æ–‡ä»¶æ’é™¤æ‰ï¼Œä¸ä¼šè¦†ç›–    -z  å‹ç¼©   ä¼ è¾“çš„è¿‡ç¨‹ä¸­ä¼šå‹ç¼©ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šæ„ŸçŸ¥ã€‚ æ–‡ä»¶åˆ°äº†ç›®æ ‡æœºå™¨ä¸Šæˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ã€‚    ï¼ˆå·¥ä½œä¸­å¸¸ç”¨çš„å‡ ä¸ª -a  -v  --delete  --excludeï¼‰</code></pre><p>ä½¿ç”¨rsyncä¼ è¾“æ–‡ä»¶æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡<code>ssh</code>éš§é“æ¥ä¼ è¾“ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡è¿æ¥æœåŠ¡ç«¯çš„<code>rsync daemon</code>æ¥ä¼ è¾“ã€‚</p><p>ä¸€ä¸‹ä¸¾ä¸€äº›ä¾‹å­æ¥è¯´æ˜ä¸¤ç§ä¼ è¾“æ¨¡å¼ã€‚</p><pre><code>rsyncåŒæ­¥sshéš§é“æ–¹å¼ï¼š#åé¢çš„ç›®å½•æ˜¯ç›®æ ‡åœ°å€    ä¾‹1ï¼šrsync -avPz 192.168.183.109:/tmp/1.txt /tmp/   æ‹‰æ–‡ä»¶ï¼šè¿œç¨‹åˆ°æœ¬æœº    ä¾‹2ï¼šrsync -avPz /tmp/1.txt  192.168.183.109:/tmp/   æ¨æ–‡ä»¶ï¼šæœ¬æœºåˆ°è¿œç¨‹    ä¾‹3ï¼šrsync -avPz -e &quot;ssh -p 10022&quot; /tmp/1.txt  192.168.183.109:/tmp/   æ¨æ–‡ä»¶ï¼šæœ¬æœºåˆ°è¿œç¨‹ï¼Œç«¯å£ä¸æ˜¯22çš„æƒ…å†µrsyncåŒæ­¥daemonæ–¹å¼    ä¾‹1ï¼šä¸éœ€è¦å¯†ç    å­¦sshå…å¯†ç ç™»é™†    rsync -auvPz --bwlimit=10 ï¼ˆé™åˆ¶ä¼ è¾“é€Ÿåº¦ï¼‰ tmp.txt test@&lt;ip&gt;::test --password-file=~/.rsync.password    ä¾‹2ï¼šæŸ¥è¯¢rsyncdå¯ç”¨æ¨¡å—   (listå‚æ•°ï¼Œyesä¼šæ˜¾ç¤ºï¼Œnoä¸ä¼šæ˜¾ç¤º)    rsync -list --port 8873  192.168.186.118::</code></pre><h2 id="rsync-daemon"><a href="#rsync-daemon" class="headerlink" title="rsync daemon"></a>rsync daemon</h2><p>rsyncé€šè¿‡daemonçš„æ–¹å¼å¯åŠ¨ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œè®©å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯å®Œæˆæ–‡ä»¶ä¼ è¾“ã€‚daemonçš„å¯ä»¥åˆ†ä¸åŒæ¨¡å—æ¥å¤„ç†ä¸åŒçš„rsyncè¯·æ±‚ã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿå¯åŠ¨ä¸€ä¸ªæœåŠ¡ç«¯rsync daemonï¼Œéœ€è¦æŒ‰ç…§å¦‚ä¸‹ä¾‹å­é…ç½®</p><p>åˆ›å»º<code>/etc/rsyncd.conf</code>é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><pre><code class="conf">port=8873log file=/var/log/rsync.logpid file=/var/run/rsyncd.pidaddress=192.168.0.11 # æœ¬æœºIPåœ°å€[mkdocs]path=/home/banban/mkdocsuse chroot=truemax connections=4read only=nolist=trueuid=banbangid=banbanauth users=chenzhilingsecrets file=/etc/rsyncd.passwd# pre-xfer exec=/home/banban/deploy.shpost-xfer exec=/home/banban/deploy.shhosts allow=192.168.0.1/32</code></pre><p>è§£é‡Šä¸€ä¸‹æ¯ä¸€ä¸ªå‚æ•°çš„å«ä¹‰</p><pre><code class="conf">portï¼šè¯´æ˜å¯åŠ¨rsyncdæœåŠ¡çš„ç«¯å£å·ï¼Œé»˜è®¤æ˜¯873ã€‚log fileï¼šæ—¥å¿—æ–‡ä»¶ä½ç½®ã€‚pid fileï¼šæœåŠ¡æ–‡ä»¶ã€‚addressï¼šå¯åŠ¨rsyncdæœåŠ¡çš„æœ¬æœºIPåœ°å€[]ï¼šrsyncçš„æ¨¡å—pathï¼šrsyncéœ€è¦åŒæ­¥çš„ç›®å½•ä½ç½®ï¼Œè¿™é‡ŒæŒ‡æ˜ä¸º/home/banban/mkdocsuse chroot true|falseï¼šæ˜¯å¦éœ€è¦rootæƒé™æ¥åŒæ­¥max connectionsï¼šæŒ‡å®šæœ€å¤§çš„è¿æ¥æ•°ã€‚listï¼šå½“ç”¨æˆ·æŸ¥è¯¢è¯¥æœåŠ¡å™¨ä¸Šçš„å¯ç”¨æ¨¡å—æ—¶ï¼Œæ˜¯å¦åˆ—å‡ºè¿™ä¸ªæ¨¡å—ã€‚uid/gidï¼šbanbanauth usersï¼šbanbansecrets fileï¼šæŒ‡å®šå¯†ç æ–‡ä»¶ï¼Œè¯¥å‚æ•°è¿åŒä¸Šé¢çš„å‚æ•°å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ä¸ä½¿ç”¨å¯†ç éªŒè¯ã€‚æ³¨æ„è¯¥å¯†ç æ–‡ä»¶çš„æƒé™ä¸€å®šè¦æ˜¯600ã€‚hosts allowï¼šè¡¨ç¤ºè¢«å…è®¸è¿æ¥è¯¥æ¨¡å—çš„ä¸»æœºï¼Œå…¶ä¸­å‰é¢ä¸¤ä¸ªIPæ˜¯ä½œä¸šç»™å‡ºçš„å¦å¤–ä¸¤å°æœºå™¨çš„IPï¼Œæœ€åä¸€ä¸ªæ˜¯é€šè¿‡åœ¨åŠå…¬ç½‘ä¸‹ä½¿ç”¨dig -x åè§£å¾—åˆ°çš„gitlabçš„ip</code></pre><blockquote><p>å…·ä½“å…³äº<code>rsyncd.conf</code>çš„é…ç½®å¯ä»¥å‚è€ƒ: <a href="https://download.samba.org/pub/rsync/rsyncd.conf.html" target="_blank" rel="noopener">https://download.samba.org/pub/rsync/rsyncd.conf.html</a></p></blockquote><p>åˆ›å»ºå¯†ç æ–‡ä»¶<code>/etc/rsyncd.passwd</code></p><pre><code class="bash">echo &quot;chenzhiling:xxxxx&quot; &gt; /etc/rsyncd.passwdchmod 600 /etc/rsyncd.passwd</code></pre><blockquote><p>æ³¨æ„ï¼šè¿™ä¸ªæ–‡ä»¶çš„æƒé™ä¸€å®šè¦è®¾ç½®ä¸º600ï¼Œæ–‡ä»¶å†…å®¹æ ¼å¼[rsync-user:password]</p></blockquote><p>å¯åŠ¨æœåŠ¡</p><pre><code class="bash">rsync --daemon --config=/etc/rsyncd.conf</code></pre><p>ä¸ºäº†æ–¹ä¾¿rsyncçš„æœåŠ¡ç®¡ç†ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬</p><pre><code class="bash">#!/bin/bash # this script for start|stop rsync daemon service status1=$(ps -ef | egrep &quot;rsync --daemon&quot; | grep -v &#39;grep&#39;) pidfile=&quot;/var/run/rsyncd.pid&quot; start_rsync=&quot;rsync --daemon --config=/etc/rsyncd.conf&quot; function rsyncstart() {     if [ &quot;${status1}X&quot; == &quot;X&quot; ];then         rm -f $pidfile               ${start_rsync}           status2=$(ps -ef | egrep &quot;rsync --daemon.*rsyncd.conf&quot; | grep -v &#39;grep&#39;)         if [  &quot;${status2}X&quot; != &quot;X&quot;  ];then             echo &quot;rsync service start.......OK&quot;           fi     else         echo &quot;rsync service is running !&quot;        fi } function rsyncstop() {     if [ &quot;${status1}X&quot; != &quot;X&quot; ];then         kill -9 $(cat $pidfile)         status2=$(ps -ef | egrep &quot;rsync --daemon&quot; | grep -v &#39;grep&#39;)         if [ &quot;${statusw2}X&quot; == &quot;X&quot; ];then             echo &quot;rsync service stop.......OK&quot;         fi     else         echo &quot;rsync service is not running !&quot;        fi } function rsyncstatus() {     if [ &quot;${status1}X&quot; != &quot;X&quot; ];then         echo &quot;rsync service is running !&quot;       else          echo &quot;rsync service is not running !&quot;     fi } function rsyncrestart() {     if [ &quot;${status1}X&quot; == &quot;X&quot; ];then         echo &quot;rsync service is not running...&quot;         rsyncstart     else         rsyncstop         rsyncstart    fi       }  case $1 in     &quot;start&quot;)         rsyncstart         ;;     &quot;stop&quot;)         rsyncstop         ;;     &quot;status&quot;)         rsyncstatus         ;;     &quot;restart&quot;)         rsyncrestart         ;;     *)        echo             echo  &quot;Usage: `basename $0` start|stop|restart|status&quot;         echo esac</code></pre><p>å¯åŠ¨äº†æœåŠ¡ä¹‹åï¼Œä¾¿å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶</p><pre><code class="bash">rsync -avz --port 8873 ./ chenzhiling@&lt;ip&gt;::mkdocs/</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æ–‡ä»¶åŒæ­¥ç¥å™¨-â€”â€”-Rsync&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶åŒæ­¥ç¥å™¨-â€”â€”-Rsync&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶åŒæ­¥ç¥å™¨ â€”â€” Rsync&quot;&gt;&lt;/a&gt;æ–‡ä»¶åŒæ­¥ç¥å™¨ â€”â€” Rsync&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/images/
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://banbanpeppa.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>æ‡’äººç¥å™¨autojump</title>
    <link href="https://banbanpeppa.github.io/2019/09/16/linux/autojump/"/>
    <id>https://banbanpeppa.github.io/2019/09/16/linux/autojump/</id>
    <published>2019-09-16T05:59:00.000Z</published>
    <updated>2019-09-16T07:17:02.754Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/linux/autojump.jpg" alt="image"></p><h2 id="What-is-autojump"><a href="#What-is-autojump" class="headerlink" title="What is autojump"></a>What is autojump</h2><p><code>autojump</code>æ˜¯ä¸€ä¸ªç±»ä¼¼äº<code>cd</code>å‘½ä»¤çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¿«é€Ÿå®šä½åˆ°ç›®å½•æˆ–è€…æ–‡ä»¶ï¼Œå…¶å®ç°çš„åŸºæœ¬åŸç†æ˜¯ç”±äº<code>autojump</code>ç»´æŠ¤äº†ä¸€ä¸ªç›®å½•è®¿é—®å†å²è¡¨ï¼Œå¦‚æœå‡ºç°ç›®å½•ååŒåçš„æƒ…å†µï¼Œ<code>autojump</code>ä¼šæ ¹æ®ä¸åŒç›®å½•çš„è®¿é—®é¢‘ç‡æ¥è®¾ç½®å¯¹åº”çš„æƒé‡ï¼Œæƒé‡é«˜çš„ä¼˜å…ˆè¿›å…¥ã€‚</p><p>å¼€æºåœ°å€ï¼š<a href="https://github.com/wting/autojump" target="_blank" rel="noopener">https://github.com/wting/autojump</a></p><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p><code>autojump</code>çš„å®‰è£…ä¸»è¦åœ¨Linuxå’ŒMacç³»ç»Ÿä¸‹é¢ï¼Œç›®å‰åœ¨Windowsä¸‹é¢è¿˜æ²¡æœ‰ç›´æ¥çš„æ”¯æŒã€‚</p><h3 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian/Ubuntu"></a>Debian/Ubuntu</h3><p>å®‰è£…</p><pre><code class="bash">apt install -y autojump</code></pre><p>åœ¨Debianç³»ç³»ç»Ÿä¸­ï¼Œéœ€è¦æ‰‹åŠ¨æ¿€æ´»<code>autojump</code>ï¼Œä¸ºäº†æš‚æ—¶æ¿€æ´» autojump åº”ç”¨ï¼Œå³ç›´åˆ°ä½ å…³é—­å½“å‰ä¼šè¯æˆ–æ‰“å¼€ä¸€ä¸ªæ–°çš„ä¼šè¯ä¹‹å‰è®© autojump å‡æœ‰æ•ˆï¼Œä½ éœ€è¦ä»¥å¸¸è§„ç”¨æˆ·èº«ä»½è¿è¡Œä¸‹é¢çš„å‘½ä»¤:</p><pre><code class="bash">source /usr/share/autojump/autojump.sh on startup</code></pre><p>ä¸ºäº†ä½¿å¾— autojump åœ¨ BASH shell ä¸­æ°¸ä¹…æœ‰æ•ˆï¼Œä½ éœ€è¦è¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚</p><pre><code class="bash">echo &#39;. /usr/share/autojump/autojump.sh&#39; &gt;&gt; ~/.bashrc</code></pre><p>å…³äºautojumpçš„æ–‡æ¡£æ”¾åœ¨</p><pre><code class="bash">cat /usr/share/doc/autojump/README.Debian</code></pre><h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><p>å®‰è£…</p><pre><code class="bash">yum install epel-releaseyum install autojumpæˆ–dnf install autojump</code></pre><h3 id="å…³äºshell"><a href="#å…³äºshell" class="headerlink" title="å…³äºshell"></a>å…³äºshell</h3><p>å¯¹äºç‰¹åˆ«çš„shellä¾‹å¦‚zshæˆ–è€…fishï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„autojumpç‰ˆæœ¬,åœ¨zshä¸‹ä½¿ç”¨ <code>autojump-zsh</code> ï¼Œåœ¨fishä¸‹ä½¿ç”¨<code>autojump-fish</code>ã€‚</p><h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h3><p>ç›´æ¥é€šè¿‡brewè¿›è¡Œå®‰è£…</p><pre><code class="bash">brew install autojump</code></pre><p>é»˜è®¤å®‰è£…çš„ä½ç½®æ˜¯</p><pre><code class="bash">/usr/local/Cellar/autojump/</code></pre><p>ä¸åŒç‰ˆæœ¬éƒ½æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹é¢ã€‚</p><p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¯¢é—®ä¸€äº›é…ç½®çš„æ­¥éª¤ï¼Œæ ¹æ®æç¤ºé…ç½®å³å¯ã€‚</p><p>å®‰è£…å¥½ä¹‹åï¼Œå¦‚æœæ˜¯ä½¿ç”¨é»˜è®¤çš„bashï¼Œæ‰§è¡Œ</p><pre><code class="bash">bash /usr/local/Cellar/autojump/22.5.3/share/autojump/autojump.bash</code></pre><p>åŒæ—¶å°†ä¸‹åˆ—é…ç½®æ·»åŠ åˆ°<code>~/.bash_profile</code>ä¸­</p><pre><code class="bash"># Set autojump env. /usr/local/Cellar/autojump/22.5.3/share/autojump/autojump.bash</code></pre><p>å¦‚æœæ˜¯<code>oh-my-zsh</code>ä½œä¸ºç”¨æˆ·shellï¼Œåˆ™é…ç½®pluginï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®å†…å®¹åˆ°<code>~/.zshrc</code>ä¸­</p><pre><code class="bash">plugins=(... autojump)</code></pre><p>å…¶ä¸­çœç•¥å·è¡¨ç¤ºåˆ«çš„pluginã€‚</p><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>autoçš„ä½¿ç”¨å¾ˆç®€å•ï¼Œé€šè¿‡-hå¯ä»¥çœ‹åˆ°å…¶ä¸»è¦çš„åŠŸèƒ½</p><pre><code class="bash">chenzhiling@banban:~ âœ j -h usage: autojump [-h] [-a DIRECTORY] [-i [WEIGHT]] [-d [WEIGHT]] [--complete]                [--purge] [-s] [-v]                [DIRECTORY [DIRECTORY ...]]Automatically jump to directory passed as an argument.positional arguments:  DIRECTORY             directory to jump tooptional arguments:  -h, --help            show this help message and exit  -a DIRECTORY, --add DIRECTORY                        add path  -i [WEIGHT], --increase [WEIGHT]                        increase current directory weight  -d [WEIGHT], --decrease [WEIGHT]                        decrease current directory weight  --complete            used for tab completion  --purge               remove non-existent paths from database  -s, --stat            show database entries and their key weights  -v, --version         show version informationPlease see autojump(1) man pages for full documentation.</code></pre><p><code>autojump</code>çš„åˆ«åæ˜¯<code>j</code>ï¼Œå¾ˆç®€çº¦</p><pre><code class="bash">chenzhiling@banban:~ âœ j -s________________________________________0:     total key weight0:     stored directories0.00:     current directory weightdata:    /Users/chenzhiling/Library/autojump/autojump.txt</code></pre><p>åˆšå®‰è£…çš„æ—¶å€™ï¼Œautojumpæ²¡æœ‰è®°å½•ä»»ä½•ä¿¡æ¯ï¼Œå› æ­¤æ€»æƒé‡ä¸º0ã€‚</p><p>åœ¨ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´<code>cd</code>å‘½ä»¤ä¹‹åï¼Œautojumpè‡ªç„¶è€Œç„¶ä¼šè®°å½•ä¸€äº›ç›®å½•è®¿é—®è®°å½•ï¼Œå¦‚ä¸‹</p><pre><code class="bash">chenzhiling@banban:~ âœ j -s...65.6:   /Users/chenzhiling/dev/nodejs-workspace67.8:   /Users/chenzhiling/dev/nodejs-workspace/devteam/x-ui67.8:   /Users/chenzhiling/dev/nodejs-workspace/devteam81.2:   /Users/chenzhiling/dev/python-workspace/devteam/x-server________________________________________2806:    total weight168:     number of entries0.00:    current directory weightdata:    /Users/chenzhiling/Library/autojump/autojump.txt</code></pre><p>è¿™æ ·æƒé‡æœ€é«˜çš„ä¼šä¼˜å…ˆè¢«éå†ï¼Œä¾‹å¦‚æƒ³è¦å¿«é€Ÿè·³è½¬åˆ°<code>x-server</code>è¿™ä¸ªç›®å½•ä¸‹é¢</p><pre><code class="bash">j x-server</code></pre><p>ä¾¿å¯ä»¥ç›´æ¥è·³è½¬åˆ°<code>/Users/chenzhiling/dev/python-workspace/devteam/x-server</code>è¿™ä¸ªç›®å½•ä¸‹é¢ï¼Œçœå»äº†å¾ˆé•¿çš„ç›®å½•è¾“å…¥ã€‚</p><p>å¦‚æœ<code>autojump</code>è¿˜æ²¡æœ‰è®°å½•çš„é‚£äº›ç›®å½•ä½ æƒ³è¦ç›´æ¥è·³è½¬ï¼Œæ˜¯ä¸è¡Œçš„ï¼Œè‡³å°‘éœ€è¦ä½¿ç”¨<code>cd</code>è¿›å…¥åˆ°å¯¹åº”çš„ç›®å½•ä¸€æ¬¡ï¼Œæ‰æœ‰å¯èƒ½ç”¨<code>autojump</code>ï¼Œå¦åˆ™ä¼šç›´æ¥è·³è½¬åˆ°<code>.</code>ã€‚</p><p>Enjoy itï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/linux/autojump.jpg&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;What-is-autojump&quot;&gt;&lt;a href=&quot;#What-is-autojump&quot; class=&quot;headerlink&quot; title=&quot;Wh
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://banbanpeppa.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearchçš„å®‰è£…ä¸ä½¿ç”¨</title>
    <link href="https://banbanpeppa.github.io/2019/09/16/bigdata/elk/elasticsearch/"/>
    <id>https://banbanpeppa.github.io/2019/09/16/bigdata/elk/elasticsearch/</id>
    <published>2019-09-16T01:36:29.376Z</published>
    <updated>2019-09-18T06:54:09.117Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h1><p><img src="/images/bigdata/elk/elk.jpg" alt="image"></p><h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a><del>Getting Started</del></h2><p>Elasticsearchæ˜¯ä¸€ä¸ªé«˜å¯æ‰©å±•çš„å¼€æºå…¨æ–‡æ£€ç´¢å’Œåˆ†æå¼•æ“ã€‚å®ƒæä¾›äº†å¿«é€Ÿå®æ—¶è¿›è¡Œå­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†ææµ·é‡æ•°æ®çš„åŠŸèƒ½ã€‚è¿™ä¸ªå·¥å…·é€šå¸¸ç”¨äºé‚£äº›éœ€è¦å¤æ‚æŸ¥è¯¢åŠŸèƒ½å’Œéœ€æ±‚çš„åœºæ™¯ï¼Œæˆ‘ä»¬å°†Elasticsearchä½œä¸ºä¸€ä¸ªåº•å±‚å¼•æ“æŠ€æœ¯æ¥é©±åŠ¨é¡¶å±‚åº”ç”¨ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›ç®€å•çš„ä½¿ç”¨Elasticsearchçš„ç”¨ä¾‹</p><ul><li>åœ¨ä¸€ä¸ªåœ¨çº¿ç”µå•†å¹³å°ä¸­ï¼Œéœ€è¦å…è®¸ç”¨æˆ·å¯¹ä¸åŒçš„å•†å“è¿›è¡Œæœç´¢ï¼Œå•†å“çš„ç§ç±»ç¹å¤šï¼Œéœ€è¦èƒ½å¤ŸåŠæ—¶è¿”å›æ¯”è¾ƒç²¾å‡†çš„ç»“æœã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨Elasticsearchæ¥å­˜å‚¨æ‰€æœ‰å•†å“çš„åˆ†ç±»å’Œæ¸…å•ï¼Œä¹‹åElasticsearchæ¥æä¾›å…¶å¼ºå¤§çš„æœç´¢åŠŸèƒ½ã€‚</li><li>åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œç”¨æˆ·æƒ³è¦å¯¹å¤§é‡çš„æ—¥å¿—æ–‡ä»¶è¿›è¡Œåˆ†æï¼Œä»ä¸­çš„å¾—åˆ°ä¸€äº›å…³äºäº§å“çš„ä½¿ç”¨è¶‹åŠ¿ã€ç»Ÿè®¡ç»“æœä»¥åŠä¸€äº›å¼‚å¸¸æƒ…å†µï¼Œä»¥æ­¤æ¥è¿›ä¸€æ­¥é©±åŠ¨äº§å“è¿›æ­¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨Logstashï¼ˆELKçš„Lï¼‰æ¥å¯¹æ—¥å¿—è¿›è¡Œé‡‡é›†ã€èšåˆå’Œè§£æï¼Œä¹‹åLogstashå°†å¤„ç†å¥½çš„æ—¥å¿—è½åˆ°Elasticsearchï¼Œåªè¦æ•°æ®è½åˆ°äº†Elasticsearchï¼Œç”¨æˆ·ä¾¿å¯ä»¥ä½¿ç”¨å®ƒçš„å¼ºå¤§çš„æœç´¢å’ŒèšåˆåŠŸèƒ½æ¥è·å–è‡ªå·±æƒ³è¦çš„ç»“æœå†…å®¹ã€‚</li><li>åœ¨ç”¨æˆ·ä½¿ç”¨æŸä¸€ä¸ªç”µå•†å¹³å°çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ç”¨æˆ·å¯¹æŸä¸€ä¸ªå•†å“æ„Ÿå…´è¶£ï¼Œä½†æ˜¯å¯èƒ½ç”¨æˆ·æš‚æ—¶ä¸èƒ½æ¥å—å½“å‰ä»·æ ¼ï¼Œè¿™æ—¶å€™ç”¨æˆ·å¯èƒ½å¸Œæœ›è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œåœ¨å•†å“ä»·æ ¼é™ä½åˆ°å¯¹åº”è¿™ä¸ªä»·æ ¼çš„æ—¶å€™å°±é€šè¿‡æŸç§æ–¹å¼é€šçŸ¥ç”¨æˆ·ï¼Œç”¨æˆ·èƒ½å¤Ÿåœ¨ç¬¬ä¸€æ—¶é—´è·å–å¾—åˆ°è¯¥å•†å“é™ä»·çš„ä¿¡æ¯ã€‚è¿™ä¸ªå¯ä»¥é€šè¿‡Elasticsearchæ¥å®ç°ï¼ŒElasticsearché€šè¿‡å…¶åå‘æŸ¥è¯¢çš„èƒ½åŠ›ï¼Œå¯¹å•†å“ä»·æ ¼è¿›è¡ŒæŸ¥è¯¢ï¼Œå½“ä»·æ ¼æ»¡è¶³äº†æ¡ä»¶æ—¢å¯ä»¥é€šè¿‡å‘Šè­¦ç³»ç»Ÿå°†æ¶ˆæ¯å‘é€ç»™ç”¨æˆ·ã€‚</li><li>åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œç”¨æˆ·ä¼šéœ€è¦å¯¹å¤§é‡çš„æ•°æ®è¿›è¡Œå¿«é€Ÿå®¡æŸ¥ã€åˆ†æä»¥åŠè·å–æ•°æ®çš„å¯è§†åŒ–ç»“æœï¼Œå¯ä»¥ä½¿ç”¨Elasticsearchè¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œä½¿ç”¨Kibanaæ¥å¯¹æ•°æ®è¿›è¡Œæ˜¾ç¤ºï¼ŒKibanaæ˜¯ä¸€ä¸ªæ•°æ®å¯è§†åŒ–çš„dashboardï¼Œå®ƒå¯ä»¥å±•ç¤ºä¸€ç³»åˆ—å¯¹ç”¨æˆ·æ¥è¯´å¾ˆé‡è¦çš„æ•°æ®ï¼Œç”¨æˆ·å¯ä»¥å®šåˆ¶å¯¹åº”æ˜¾ç¤ºçš„æ•°æ®å†…å®¹ã€‚å¦ä¸€æ–¹å˜ï¼Œç”¨æˆ·è¿˜å¯ä»¥ä½¿ç”¨Elasticsearchå¼ºå¤§çš„èšåˆèƒ½åŠ›æ¥è¿›è¡Œå¤æ‚å¾—å¤šå•†ä¸šæ•°æ®æŸ¥è¯¢ã€‚</li></ul><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Elasticsearchæ˜¯Elastic Stackï¼ˆç®€ç§°ESï¼‰çš„æ ¸å¿ƒåˆ†å¸ƒå¼æ£€ç´¢å’Œåˆ†æç»„ä»¶ï¼ŒLogstashå’ŒBeatsä¸»è¦ç”¨äºå°†æ•°æ®è¿›è¡Œé‡‡é›†ã€èšåˆä»¥åŠå¤„ç†æ•°æ®ï¼Œç„¶åå°†æ•°æ®å­˜å‚¨åˆ°Elasticsearchï¼ŒKibanaåˆ™å°†å¤„ç†å¥½çš„æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œå¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œä¸€äº›æ“ä½œä¸ç›‘æ§ã€‚è€Œé‚£äº›ç´¢å¼•ã€æ£€ç´¢ä»¥åŠåˆ†æçš„æ ¸å¿ƒåŠŸèƒ½éƒ½æ˜¯åœ¨Elasticsearchä¸­å®Œæˆçš„ã€‚</p><p>Elasticsearchæä¾›äº†å®æ—¶æ£€ç´¢ä¸åˆ†ææ•°æ®çš„èƒ½åŠ›ï¼Œä¸ç®¡æ˜¯ç»“æ„åŒ–çš„æ•°æ®è¿˜æ˜¯éç»“æ„åŒ–çš„æ•°æ®ã€æ•°å­—åŒ–æ•°æ®ã€åœ°ç†æ•°æ®ç­‰ï¼ŒElasticsearchéƒ½èƒ½å¤Ÿé«˜æ•ˆåœ°è¿›è¡Œå­˜å‚¨å¹¶å»ºç«‹ç´¢å¼•ï¼ŒåŒæ—¶å®ç°é«˜æ•ˆæ£€ç´¢èƒ½åŠ›ã€‚ç”¨æˆ·å¯ä»¥è¿œè¿œè¶…å‡ºç®€å•çš„æ£€ç´¢å’Œèšåˆä¿¡æ¯ï¼Œä»¥å‘ç°æ•°æ®ä¸­çš„è¶‹åŠ¿å’Œæ¨¡å¼ï¼Œè¾¾åˆ°æ•°æ®åˆ†æçš„ç›®çš„ã€‚éšç€æ•°æ®å’ŒæŸ¥è¯¢é‡çš„å¢é•¿ï¼ŒElasticsearchçš„åˆ†å¸ƒå¼ç‰¹æ€§ä½¿å¾—éƒ¨ç½²èƒ½å¤Ÿéšä¹‹æ— ç¼å¢é•¿ï¼Œå®ç°åŠ¨æ€æ‰©å±•çš„èƒ½åŠ›ã€‚</p><p>åœ¨ç°å®ä¸šåŠ¡ä¸­ï¼Œæ˜¾ç„¶ä¸æ˜¯æ¯ä¸€ä¸ªé—®é¢˜éƒ½æ˜¯æœç´¢é—®é¢˜ï¼Œä½†æ˜¯Elasticsearchæä¾›äº†å¤„ç†å„ç§æ•°æ®çš„é€Ÿåº¦å’Œçµæ´»æ€§ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ç”¨ä¾‹ï¼š</p><ul><li>å°†æœç´¢æ¡†æ·»åŠ åˆ°åº”ç”¨æˆ–è€…ç½‘ç«™ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ES</li><li>å­˜å‚¨å’Œåˆ†ææ—¥å¿—ã€æŒ‡æ ‡å’Œå®‰å…¨äº‹ä»¶æ•°æ®</li><li>ä½¿ç”¨æœºå™¨å­¦ä¹ æ‰‹æ®µæ¥è‡ªåŠ¨æ¨¡å‹åŒ–å®æ—¶æ•°æ®çš„è¡Œä¸º</li><li>åªç”¨Elasticsearchä½œä¸ºå…¨è‡ªåŠ¨åŒ–å•†åŠ¡æµç¨‹çš„å¼•æ“</li><li>æŠŠElasticsearchä½œä¸ºGISæ¥ç®¡ç†ã€é›†æˆå’Œåˆ†æåœ°ç†æ•°æ®</li></ul><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>åœ¨Elasticsearchä¸­æœ‰ä¸€äº›æ ¸å¿ƒæ¦‚å¿µï¼ŒæŒæ¡è¿™äº›æ¦‚å¿µæœ‰åŠ©äºå¯¹Elasticsearchçš„ç†è§£ã€‚</p><h3 id="NRTï¼ˆNear-Realtimeï¼‰è¿‘å®æ—¶"><a href="#NRTï¼ˆNear-Realtimeï¼‰è¿‘å®æ—¶" class="headerlink" title="NRTï¼ˆNear Realtimeï¼‰è¿‘å®æ—¶"></a>NRTï¼ˆNear Realtimeï¼‰è¿‘å®æ—¶</h3><p>Elasticsearchæ˜¯ä¸€ä¸ªè¿‘å®æ—¶çš„æœç´¢å¹³å°ï¼Œä¹Ÿå°±æ˜¯è¯´Elasticsearchåœ¨å¯¹æŸä¸€ä¸ªæ–‡æ¡£å»ºç«‹å¥½indexä¹‹ååˆ°è¿›å…¥å¯æœç´¢é˜¶æ®µä¼šæœ‰ä¸€ä¸ªæ—¶å»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ç§’é’Ÿï¼‰ã€‚</p><h3 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h3><p>é›†ç¾¤é€šå¸¸æŒ‡çš„æ˜¯ç”±ä¸€å°æˆ–è€…å¤šå°æœåŠ¡èŠ‚ç‚¹ç»„æˆçš„èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹å­˜å‚¨äº†å®Œæ•´çš„æ•°æ®å†…å®¹ï¼Œå¹¶ä¸”å¯¹è¿™äº›æ•°æ®æä¾›äº†è”åˆç´¢å¼•ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œæ•°æ®æ£€ç´¢ã€‚ä¸€ä¸ªé›†ç¾¤é€šå¸¸ä¼šç”±ä¸€ä¸ªç‹¬ä¸€çš„åç§°è¿›è¡Œæ ‡è¯†ï¼ˆé»˜è®¤ä½¿ç”¨â€œelasticsearchâ€ï¼‰ï¼Œè¿™ä¸ªåç§°å¾ˆé‡è¦ï¼Œä¸€ä¸ªèŠ‚ç‚¹åœ¨åŠ å…¥äº†æŸä¸€ä¸ªåç§°çš„é›†ç¾¤ä¹‹åï¼Œåªèƒ½å±äºæŸä¸€ä¸ªé›†ç¾¤ã€‚</p><p>æ‰€ä»¥åœ¨ä¸€äº›ç¯å¢ƒä¸‹ï¼Œè¦ç¡®ä¿é’ˆå¯¹ä¸åŒçš„é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œå¦åˆ™å¯èƒ½å°±ä¼šå‡ºç°ä¸€äº›èŠ‚ç‚¹åŠ å…¥é”™è¯¯çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥å®šä¹‰åä¸º<code>logging-dev</code>ã€ <code>logging-stage</code>æˆ–è€…<code>logging-prod</code>çš„åå­—æ¥åŒºåˆ†ä¸åŒçš„esé›†ç¾¤ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªé›†ç¾¤æ˜¯å®Œå…¨æ”¯æŒåªå­˜åœ¨ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µçš„ã€‚</p><h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªé›†ç¾¤çš„ä¸€éƒ¨åˆ†ï¼ŒèŠ‚ç‚¹å­˜å‚¨äº†æ•°æ®ï¼Œå‚ä¸åˆ°ä¸€ä¸ªé›†ç¾¤ä¸­æä¾›å…¶ç´¢å¼•å’Œæœç´¢çš„èƒ½åŠ›ã€‚åŒé›†ç¾¤æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸€ä¸ªèŠ‚ç‚¹ç”±ä¸€ä¸ªUUIDæ¥æ ‡è¯†ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨UUIDï¼Œç”¨æˆ·å¯ä»¥è‡ªé¡¶ä¸€ä¸ªåç§°æ¥æ ‡è¯†èŠ‚ç‚¹ã€‚</p><p>ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡é…ç½®åŠ å…¥åˆ°æŸä¸€ä¸ªç‰¹å®šçš„é›†ç¾¤ä¸­ï¼Œé»˜è®¤ä¸€ä¸ªèŠ‚ç‚¹ç›´æ¥åŠ å…¥åˆ°åä¸ºâ€elasticsearchâ€œé›†ç¾¤ä¸­ã€‚å‡è®¾åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæœ‰ä¸€äº›esèŠ‚ç‚¹å¯åŠ¨å¹¶ä¸”èƒ½å¤Ÿç›¸äº’å‘ç°ï¼Œä»–ä»¬ä¼šè‡ªç»„ç»‡å½¢æˆä¸€ä¸ªåä¸º<code>elasticsearch</code>çš„é›†ç¾¤ï¼Œå¹¶åŠ å…¥åˆ°è¿™ä¸ªé›†ç¾¤ä¸­ã€‚</p><p>åœ¨ä¸€ä¸ªé›†ç¾¤ä¸‹ï¼Œå¯ä»¥å®¹çº³ä»»æ„å¤šçš„èŠ‚ç‚¹ã€‚</p><h3 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h3><p>Indexæ˜¯ä¸€ç³»åˆ—æœ‰ç›¸åŒæˆ–è€…ç›¸ä¼¼ç‰¹å¾çš„æ–‡æ¡£ï¼Œä¾‹å¦‚å¯¹äºç”¨æˆ·æ•°æ®ï¼Œå¯ä»¥ä¸ºå…¶å®šä¹‰ä¸€ä¸ª<code>customer index</code>ï¼Œå¯¹äºå•†å“ç±»ç›®ï¼Œå¯ä»¥å®šä¹‰å¦ä¸€ä¸ªindexä¸º<code>catagory</code>ï¼Œä¸€ä¸ªindexç”±ä¸€ä¸ªåç§°æ¥è¡¨ç¤ºï¼Œè€Œè¿™ä¸ªindexä¼šåœ¨åç»­çš„ç´¢å¼•ã€æ£€ç´¢ã€æ›´æ–°ä»¥åŠåˆ é™¤æ–‡æ¡£ç­‰æ“ä½œçš„æ—¶å€™ä½¿ç”¨ã€‚</p><p>åœ¨ä¸€ä¸ªå•ç‹¬çš„é›†ç¾¤ä¸­ï¼Œå¯ä»¥ä¸ºæ–‡æ¡£å®šä¹‰ä»»æ„å¤šçš„indexã€‚</p><h3 id="Type-ï¼ˆ6-0-0ç‰ˆæœ¬ä¹‹åå¼ƒç”¨"><a href="#Type-ï¼ˆ6-0-0ç‰ˆæœ¬ä¹‹åå¼ƒç”¨" class="headerlink" title="Type ï¼ˆ6.0.0ç‰ˆæœ¬ä¹‹åå¼ƒç”¨)"></a><del>Type ï¼ˆ6.0.0ç‰ˆæœ¬ä¹‹åå¼ƒç”¨)</del></h3><p>åœ¨ä¸€ä¸ªindexä¸‹é¢çš„é€»è¾‘åˆ†åŒºï¼Œèƒ½å¤Ÿå°†ä¸åŒç±»å‹çš„æ–‡æ¡£å½’ç±»åˆ°åŒä¸€ä¸ªindexä¸‹é¢ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ–‡æ¡£ç±»å‹æ˜¯<code>users</code>çš„ç±»å‹ï¼Œå¦ä¸€ç±»çš„æ–‡æ¡£ç±»å‹æ˜¯<code>blog posts</code>ç±»å‹ï¼Œè¿™ä¸¤ä¸ªç±»å‹å¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªindexçš„ä¸åŒåˆ†åŒºä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„typeä¸‹é¢ã€‚</p><p>è¿™ä¸ªæ¦‚å¿µåœ¨åç»­çš„esç‰ˆæœ¬ä¸­å·²ç»å¼ƒç”¨äº†ã€‚å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/removal-of-types.html" target="_blank" rel="noopener">Removal of mapping types</a>ã€‚</p><h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3><p>åœ¨å‰é¢æœ‰æåˆ°æ–‡æ¡£çš„æ¦‚å¿µï¼Œä¸€ä¸ªæ–‡æ¡£æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè¢«indexçš„æœ€å°å•å…ƒï¼Œä¾‹å¦‚å¯ä»¥ä¸ºä¸€ä¸ªå•ç‹¬çš„é¡¾å®¢å®šä¹‰ä¸€ä¸ªæ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥ä¸ºä¸€ä¸ªå•ç‹¬çš„å•†å“å®šä¹‰ä¸€ä¸ªæ–‡æ¡£ã€‚è¿™ä¸ªæ–‡æ¡£é€šå¸¸æ˜¯ç”¨JSONæ¥è¡¨ç¤ºã€‚</p><p>åœ¨ä¸€ä¸ªindexæˆ–è€…typeä¸‹ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„å¤šçš„æ–‡æ¡£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªæ–‡æ¡£è™½ç„¶ç‰©ç†ä½ç½®ä¸Šé¢æ¥è¯´æ˜¯åœ¨ä¸€ä¸ªindexä¸‹é¢çš„ï¼Œä½†æ˜¯ä¸€ä¸ªæ–‡æ¡£å¿…é¡»è¯¦ç»†åˆ†é…åˆ°indexä¸‹é¢çš„æŸä¸€ä¸ªtypeä¸‹ã€‚</p><h3 id="Shards-amp-Replicas"><a href="#Shards-amp-Replicas" class="headerlink" title="Shards &amp; Replicas"></a>Shards &amp; Replicas</h3><p>åœ¨ä¸€ä¸ªindexä¸‹é¢å¯èƒ½ä¼šå­˜å‚¨éå¸¸å¤§é‡çš„æ–‡æ¡£ï¼ˆæ•°æ®ï¼‰ï¼Œè¿™äº›æ•°æ®æœ‰å¯èƒ½ä¼šè¶…å‡ºä¸€ä¸ªèŠ‚ç‚¹çš„ç¡¬ä»¶é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå•ç‹¬çš„indexä¸‹é¢æœ‰è¶…è¿‡1TBçš„æ–‡æ¡£ï¼Œè¿™ä¸ªå¯èƒ½ä¼šè¶…è¿‡ä¸€ä¸ªèŠ‚ç‚¹çš„ç£ç›˜å®¹é‡æˆ–è€…å¯èƒ½ä¼šå¯¼è‡´æŸ¥è¯¢çš„æ•ˆç‡éå¸¸çš„æ…¢ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒElasticsearchå°†indexè¿›è¡Œå†åˆ†å‰²ä¸ºä¸€ä¸ªä¸€ä¸ªshardsï¼ˆåˆ†ç‰‡ï¼‰ï¼Œå½“å®šä¹‰äº†ä¸€ä¸ªindexçš„æ—¶å€™ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šå¯¹åº”çš„shardsï¼ˆåˆ†ç‰‡ï¼‰æ•°ï¼Œæ¯ä¸ªåˆ†ç‰‡æœ¬èº«éƒ½æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨ä¸”ç‹¬ç«‹çš„â€œç´¢å¼•â€ï¼Œå¯ä»¥æ‰˜ç®¡åœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šã€‚</p><p>åˆ†ç‰‡ä¹‹æ‰€ä»¥å¾ˆé‡è¦æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„åŸå› ï¼š</p><ul><li>åˆ†ç‰‡å…è®¸ç”¨æˆ·æ°´å¹³åˆ†å‰²æˆ–è€…æ°´å¹³æ‰©å±•å†…å®¹å·</li><li>å…è®¸ç”¨æˆ·è·¨åˆ†ç‰‡ï¼ˆåˆ†ç‰‡å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šé¢ï¼‰åˆ†å¸ƒå’Œå¹¶è¡ŒåŒ–æ“ä½œï¼Œè¿›è€Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œååé‡</li></ul><p>åœ¨ä¸€ä¸ªå¤åˆ¶çš„åˆ†å¸ƒå¼ç¯å¢ƒæˆ–è€…äº‘ç¯å¢ƒä¸­ï¼Œä¸å¯é¢„æœŸçš„ä¸€äº›æ•…éšœæ˜¯å¯èƒ½å‡ºç°çš„ï¼Œä¸ºæ­¤å¼ºçƒˆå»ºè®®ä½¿ç”¨Elasticsearchæå‡ºçš„æ•…éšœè½¬ç§»æœºåˆ¶ï¼Œä»¥é˜²æ­¢æŸä¸€ä¸ªèŠ‚ç‚¹å› ä¸ºå®•æœºæˆ–è€…å…¶å®ƒä¸€äº›åŸå› ä¸å¯ç”¨è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚Elasticsearchå…è®¸å¯¹æ¯ä¸€ä¸ªåˆ†ç‰‡éƒ½è¿›è¡Œå‰¯æœ¬å¤åˆ¶ï¼Œç§°ä¸ºåˆ†ç‰‡å‰¯æœ¬ã€‚</p><p>å‰¯æœ¬å¾ˆé‡è¦çš„åŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ul><li>å¯ä»¥åœ¨åˆ†ç‰‡æˆ–è€…èŠ‚ç‚¹å‡ºç°æ•…éšœçš„æ—¶å€™æä¾›ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œå› æ­¤éœ€è¦æ³¨æ„å‰¯æœ¬åˆ†ç‰‡éœ€è¦ä¸åŸå§‹åˆ†ç‰‡åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šé¢ã€‚</li><li>èƒ½å¤Ÿå®ç°æ‰©å±•çš„æœç´¢é‡å’Œååé‡ï¼Œå› ä¸ºå¯ä»¥åœ¨æ‰€æœ‰çš„å‰¯æœ¬ä¸Šé¢ï¼ˆåŒ…æ‹¬åŸå§‹åˆ†ç‰‡ï¼‰è¿›è¡Œå¹¶è¡Œæœç´¢ã€‚</li></ul><p>æ€»è€Œè¨€ä¹‹ï¼Œæ¯ä¸€ä¸ªindexï¼ˆç´¢å¼•ï¼‰çš„éƒ½å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†ç‰‡ï¼ŒåŒæ—¶é’ˆå¯¹æ¯ä¸€ä¸ªç´¢å¼•éƒ½å¯ä»¥ä¸ºå…¶åˆ†ç‰‡è¿›è¡Œå‰¯æœ¬å¤åˆ¶ï¼Œå¤åˆ¶ä¹‹åï¼Œæ¯ä¸ªç´¢å¼•éƒ½å°†å…·æœ‰æœ±åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ã€‚åœ¨åˆ›å»ºindexçš„æ—¶å€™å¯ä»¥ä¸ºæ¯ä¸€ä¸ªindexå®šä¹‰åˆ†ç‰‡å’Œå‰¯æœ¬çš„æ•°ç›®ï¼Œåˆ›å»ºç´¢å¼•ä¹‹åï¼Œç”¨æˆ·å¯ä»¥åŠ¨æ€åœ°æ›´æ”¹å‰¯æœ¬æ•°ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹åˆ†ç‰‡æ•°ç›®ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä¸­çš„æ¯ä¸ªç´¢å¼•éƒ½ä¼šæœ‰5ä¸ªä¸»åˆ†ç‰‡å’Œä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™å°±å› ä¸ºè¿™åœ¨é›†ç¾¤ä¸­è‡³å°‘éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆå‰¯æœ¬è¦å’Œä¸»åˆ†ç‰‡åœ¨ä¸åŒèŠ‚ç‚¹ï¼‰ï¼Œå³ç´¢å¼•ä¼šåŒ…å«5ä¸ªä¸»åˆ†ç‰‡å’Œ5ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œæ€»è®¡æ¯ä¸ªç´¢å¼•10ä¸ªåˆ†ç‰‡ã€‚</p><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>æœ¬äººåœ¨è¿›è¡Œå®éªŒçš„æ—¶å€™Elasticsearchçš„æœ€æ–°ç‰ˆæœ¬æ˜¯<code>7.3.2</code>ï¼Œè§†æƒ…å†µè€Œå®šä¸‹è½½å¯¹åº”çš„é•œåƒï¼Œå…·ä½“é•œåƒåœ¨<a href="https://www.docker.elastic.co/" target="_blank" rel="noopener">www.docker.elastic.co</a>ã€‚</p><p>è®¾ç½®é•œåƒçš„ç‰ˆæœ¬å·</p><pre><code>export ELK_VERSION=7.3.2</code></pre><h3 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h3><p>ç”¨dockeræ–¹å¼æ¥å®‰è£…ä¼šæ¯”è¾ƒå¿«æ·æ–¹ä¾¿ï¼Œæ¥ä¸‹æ¥ä¸»è¦é€šè¿‡<code>docker run</code>çš„æ–¹å¼æ¥éƒ¨ç½²ä¸€ä¸ªESé›†ç¾¤ã€‚</p><h4 id="Elasticsearch-1"><a href="#Elasticsearch-1" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h4><p><img src="/images/docker/docker-tiny.png" alt="image"></p><p>ä¸‹è½½é•œåƒ</p><pre><code class="bash">docker pull docker.elastic.co/elasticsearch/elasticsearch:${ELK_VERSION}</code></pre><p>ä½¿ç”¨docker runçš„æ–¹å¼å¯åŠ¨</p><pre><code class="bash">docker run -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -it -d --name es-node docker.elastic.co/elasticsearch/elasticsearch:7.3.2</code></pre><h4 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h4><p>Kibanaæ˜¯ELKçš„dashboardï¼Œå¯ä»¥é€šè¿‡Kibanaå®ç°æ•°æ®çš„å¯è§†åŒ–ï¼Œå¯¹æ•°æ®è¿›ä¸€æ­¥åˆ†æã€‚</p><p>æ‹‰å–Kibanaçš„é•œåƒ</p><pre><code class="bash">docker pull docker.elastic.co/kibana/kibana:${ELK_VERSION}</code></pre><p>å¯åŠ¨KibanaæœåŠ¡çš„æ–¹å¼ä¹Ÿæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡docker runçš„æ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡docker-composeçš„æ–¹å¼ã€‚</p><p>é¦–å…ˆä»‹ç»docker runçš„æ–¹å¼ã€‚</p><pre><code class="bash">docker run --link YOUR_ELASTICSEARCH_CONTAINER_NAME_OR_ID:elasticsearch -p 5601:5601 docker.elastic.co/kibana/kibana:${ELK_VERSION}</code></pre><p>è¿™é‡Œè¿è¡ŒæˆåŠŸçš„å‰ææ˜¯elasticsearchå®¹å™¨å¯åŠ¨çš„æ—¶å€™ç½‘ç»œç”¨çš„æ˜¯defaultï¼Œå¦åˆ™éœ€è¦åˆ¶å®šå¯¹åº”çš„ç½‘ç»œã€‚</p><p>åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºKibanaæœåŠ¡çš„å¯åŠ¨è¿‡ç¨‹ä¸­æœ‰å¾ˆå¤šå‚æ•°å¯ä»¥è®¾ç½®ï¼Œä¸ºæ­¤ä¸å»ºè®®é€šè¿‡ç¯å¢ƒå˜é‡ä¸€ä¸ªä¸€ä¸ªå†™ï¼Œå¯ä»¥é€šè¿‡æŒ‚è½½çš„æ–¹å¼å°†<code>kibana.yaml</code>çš„é…ç½®æ–‡ä»¶æŒ‚è½½è¿‡å»ï¼Œ<code>kibana.yaml</code>é…ç½®æ–‡ä»¶(7.3ç‰ˆæœ¬)çš„å…·ä½“é…ç½®è¦æ±‚åœ¨è¿™ä¸ª<a href="https://www.elastic.co/guide/en/kibana/7.3/settings.html" target="_blank" rel="noopener">é“¾æ¥</a></p><p>åˆ™å¯åŠ¨æ–¹å¼æ·»åŠ å‚æ•°</p><pre><code class="bash">docker run --link YOUR_ELASTICSEARCH_CONTAINER_NAME_OR_ID:elasticsearch -p 5601:5601 -v ./kibana.yml:/usr/share/kibana/config/kibana.yml docker.elastic.co/kibana/kibana:${ELK_VERSION}</code></pre><h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><h4 id="Elasticsearch-2"><a href="#Elasticsearch-2" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h4><p>å¯ä»¥é€šè¿‡docker-composeçš„æ–¹å¼å¯åŠ¨,docker-composeçš„yamlæ–‡ä»¶å¦‚ä¸‹</p><p><code>elasticsearch.yaml</code></p><pre><code class="yaml">version: &#39;3&#39;services:  es01:    image: docker.elastic.co/elasticsearch/elasticsearch:${ELK_VERSION}    container_name: es01    environment:      - node.name=es01      - discovery.seed_hosts=es02      - cluster.initial_master_nodes=es01,es02      - cluster.name=docker-cluster      - bootstrap.memory_lock=true      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;    ulimits:      memlock:        soft: -1        hard: -1    volumes:      - esdata01:/usr/share/elasticsearch/data    ports:      - 9200:9200    networks:      - esnet  es02:    image: docker.elastic.co/elasticsearch/elasticsearch:${ELK_VERSION}    container_name: es02    environment:      - node.name=es02      - discovery.seed_hosts=es01      - cluster.initial_master_nodes=es01,es02      - cluster.name=docker-cluster      - bootstrap.memory_lock=true      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;    ulimits:      memlock:        soft: -1        hard: -1    volumes:      - esdata02:/usr/share/elasticsearch/data    networks:      - esnetvolumes:  esdata01:    driver: local  esdata02:    driver: localnetworks:  esnet:</code></pre><p>å¦å¤–å°†é•œåƒçš„ç‰ˆæœ¬æ·»åŠ åˆ°<code>.env</code>æ–‡ä»¶ä¸­ï¼ˆå’Œelasticsearch.yamlæ–‡ä»¶åŒä¸€ä¸ªç›®å½•)</p><p><code>.env</code></p><pre><code class="ini">ELK_VERSION=7.3.2</code></pre><p>ç„¶åç›´æ¥æ‰§è¡Œ</p><pre><code class="bash">docker-compose -f elasticsearch.yaml up -d</code></pre><p>åˆ›å»ºå¥½ä¹‹åæŸ¥çœ‹dockerå®¹å™¨è¿è¡Œæƒ…å†µ</p><pre><code class="bash"># docker ps -aCONTAINER ID        IMAGE                                                              COMMAND                  CREATED             STATUS              PORTS                              NAMES4b8cc899cb3f        docker.elastic.co/elasticsearch/elasticsearch:7.3.2                &quot;/usr/local/bin/do...&quot;   6 minutes ago       Up 6 minutes        9200/tcp, 9300/tcp                 es02992ed17bfeb9        docker.elastic.co/elasticsearch/elasticsearch:7.3.2                &quot;/usr/local/bin/do...&quot;   6 minutes ago       Up 6 minutes        0.0.0.0:9200-&gt;9200/tcp, 9300/tcp   es01</code></pre><p>è®¿é—®Elasticsearchçš„æ¥å£</p><pre><code class="bash">$ curl http://127.0.0.1:9200/_cat/health1568624275 08:57:55 docker-cluster green 2 2 0 0 0 0 0 0 - 100.0%</code></pre><p>å®‰è£…æˆåŠŸ</p><h4 id="Kibana-1"><a href="#Kibana-1" class="headerlink" title="Kibana"></a>Kibana</h4><p>ç»“åˆä¹‹å‰çš„elasticsearchå®¹å™¨å¯åŠ¨ï¼Œè¿½åŠ å†…å®¹å¾—åˆ°</p><p><code>elasticsearch.yaml</code></p><pre><code class="yaml">version: &#39;3&#39;services:  es01:    image: docker.elastic.co/elasticsearch/elasticsearch:${ELK_VERSION}    container_name: es01    environment:      - node.name=es01      - discovery.seed_hosts=es02      - cluster.initial_master_nodes=es01,es02      - cluster.name=docker-cluster      - bootstrap.memory_lock=true      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;    ulimits:      memlock:        soft: -1        hard: -1    volumes:      - esdata01:/usr/share/elasticsearch/data    ports:      - 9200:9200    networks:      - esnet  es02:    image: docker.elastic.co/elasticsearch/elasticsearch:${ELK_VERSION}    container_name: es02    environment:      - node.name=es02      - discovery.seed_hosts=es01      - cluster.initial_master_nodes=es01,es02      - cluster.name=docker-cluster      - bootstrap.memory_lock=true      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;    ulimits:      memlock:        soft: -1        hard: -1    volumes:      - esdata02:/usr/share/elasticsearch/data    networks:      - esnet  kibana:    image: docker.elastic.co/kibana/kibana:${ELK_VERSION}    container_name: kibana    environment:      SERVER_NAME: testing-chenzhiling.loghub.netease.com      ELASTICSEARCH_HOSTS: http://es01:9200    ports:      - 5601:5601    links:      - &#39;es01:es01&#39;    networks:      - esnetvolumes:  esdata01:    driver: local  esdata02:    driver: localnetworks:  esnet:</code></pre><p>ç„¶åæ‰§è¡Œ</p><pre><code class="bash">docker-compose -f elacticsearch.yaml up -d</code></pre><p>å¯åŠ¨æˆåŠŸä¹‹åè®¿é—® <a href="http://127.0.0.1:5601" target="_blank" rel="noopener">http://127.0.0.1:5601</a> å¯ä»¥è¿›å…¥Kibanaçš„ç•Œé¢<br><img src="/images/bigdata/elk/kibana_dashboard.png" alt="image"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Elasticsearch&quot;&gt;&lt;a href=&quot;#Elasticsearch&quot; class=&quot;headerlink&quot; title=&quot;Elasticsearch&quot;&gt;&lt;/a&gt;Elasticsearch&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/images/bigdata/
      
    
    </summary>
    
    
      <category term="Big Data" scheme="https://banbanpeppa.github.io/tags/Big-Data/"/>
    
      <category term="ELK" scheme="https://banbanpeppa.github.io/tags/ELK/"/>
    
  </entry>
  
  <entry>
    <title>Linuxç©ºæ´æ–‡ä»¶</title>
    <link href="https://banbanpeppa.github.io/2019/08/21/linux/holefile/"/>
    <id>https://banbanpeppa.github.io/2019/08/21/linux/holefile/</id>
    <published>2019-08-21T06:43:00.000Z</published>
    <updated>2019-08-21T08:23:00.868Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>ä»€ä¹ˆæ˜¯ç©ºæ´æ–‡ä»¶(hole file)ï¼ŸğŸ’â€â™‚ï¸åœ¨Linuxä¸­ï¼Œlseekçš„ç³»ç»Ÿè°ƒç”¨æ˜¯å¯ä»¥æ”¹å˜åœ¨æ–‡ä»¶ä¸Šé¢çš„åç§»é‡çš„ï¼Œè€Œä¸”è¿˜å…è®¸å…¶è¶…å‡ºæ–‡ä»¶çš„é•¿åº¦ã€‚åç§»é‡ä¸€æ—¦è¶…å‡ºäº†æ–‡ä»¶çš„é•¿åº¦ï¼Œä¸‹ä¸€æ¬¡è¿›è¡Œæ–‡ä»¶IOå†™å…¥æ“ä½œæ–‡ä»¶çš„æ—¶å€™ä¾¿ä¼šå»¶ç»­åç§»é‡çš„ä½ç½®ç»§ç»­å†™å…¥ï¼Œè¿›è€Œåœ¨æ–‡ä»¶ä¸­é—´äº§ç”Ÿäº†ç©ºæ´çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†ä¼šä»¥â€\0â€å¡«å……ï¼Œè€Œä»åŸæ¥çš„æ–‡ä»¶ç»“å°¾åˆ°æ–°å†™å…¥æ•°æ®é—´çš„è¿™æ®µç©ºé—´å°±è¢«ç§°ä¸ºâ€œ<strong>æ–‡ä»¶ç©ºæ´</strong>â€ã€‚</p><p>åœ¨Linuxä¸­ï¼ŒEOFï¼ˆæ–‡ä»¶ç»“æŸç¬¦ï¼‰å¹¶ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œæ˜¯åœ¨è¯»å–åˆ°æ–‡ä»¶æœ«å°¾çš„æ—¶å€™è¿”å›çš„ä¸€ä¸ªä¿¡å·å€¼ï¼Œä¹Ÿå°±æ˜¯-1ã€‚</p><p>æ–‡ä»¶ç©ºæ´éƒ¨åˆ†å®é™…ä¸Šæ˜¯ä¸ä¼šå ç”¨ä»»ä½•çš„ç‰©ç†ç©ºé—´çš„ï¼Œç›´åˆ°åœ¨æŸä¸ªæ—¶åˆ»å¯¹ç©ºæ´éƒ¨åˆ†è¿›è¡Œå†™å…¥æ–‡ä»¶å†…å®¹çš„æ—¶å€™æ‰ä¼šä¸ºå®ƒåˆ†é…å¯¹åº”çš„ç©ºé—´ã€‚ä½†æ˜¯åœ¨ç©ºæ´æ–‡ä»¶å½¢æˆçš„æ—¶å€™ï¼Œé€»è¾‘ä¸Šé¢çš„æ–‡ä»¶å¤§å°æ˜¯åˆ†é…äº†ç©ºæ´éƒ¨åˆ†çš„å¤§å°çš„ã€‚</p><p>ğŸ‘¯â€â™€ï¸ğŸ‘¯â€â™‚ï¸ğŸ‘¯â€â™€ï¸ğŸ‘¯â€â™‚ï¸ğŸ‘¯â€â™€ï¸ğŸ‘¯â€â™‚ï¸ğŸ‘¯â€â™€ï¸ğŸ‘¯â€â™‚ï¸</p><h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p>æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡ä¸€ä¸ªå®éªŒæ¥éªŒè¯ç©ºæ´æ–‡ä»¶çš„å½¢æˆï¼Œå¹¶ä¸”ä½¿ç”¨catå’Œcpä¸¤ç§æ–¹å¼å¯¹ç©ºæ´æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œçœ‹çœ‹ä»–ä»¬å¯¹åº”çš„ä¸åŒæ•ˆæœã€‚</p><p>é¦–å…ˆä½¿ç”¨ddå‘½ä»¤äº§ç”Ÿä¸€ä¸ªç©ºæ´æ–‡ä»¶ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ddçš„ä½¿ç”¨æ–¹æ³•ã€‚</p><ul><li>if - è¾“å…¥æ–‡ä»¶</li><li>of - è¾“å‡ºæ–‡ä»¶</li><li>seek - è®¾ç½®è¾“å‡ºæ–‡ä»¶çš„åç§»é‡</li><li>skip - è®¾ç½®è¾“å…¥æ–‡ä»¶çš„åç§»é‡</li><li>bs - æ˜¯ibså’Œobsçš„åˆé›†</li></ul><p>æ¥ä¸‹æ¥ä»<code>/dev/urandom</code>ä¸­è¯»å–å†…å®¹ï¼Œå†™å…¥åˆ°<code>hole.file</code>æ–‡ä»¶ä¸­ï¼Œåœ¨å†™å…¥ä¹‹å‰ï¼Œå¯¹<code>hole.file</code>æ–‡ä»¶è®¾ç½®äº†999çš„åç§»é‡ï¼Œbsè®¾ç½®äº†4096çš„å¤§å°ï¼ŒåŒæ—¶è®¾ç½®å†™å…¥çš„blockæ•°é‡ä¸º1ï¼Œè¿™æ ·å°†ä¼šäº§ç”Ÿä¸€ä¸ªé€»è¾‘é•¿åº¦ä¸º1000æ•°æ®å—çš„æ–‡ä»¶ã€‚</p><pre><code>~$ dd if=/dev/urandom of=hole.file bs=4096 seek=999 count=11+0 records in1+0 records out4096 bytes (4.1 kB, 4.0 KiB) copied, 0.000449329 s, 9.1 MB/s</code></pre><p>äº§ç”Ÿä¹‹åï¼Œä½¿ç”¨lså‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å¤§å°æ˜¯4.0MB</p><pre><code>~$ ls -lh hole.file-rw-r--r-- 1 chenzhiling01 root 4.0M 8æœˆ  21 15:12 hole.file</code></pre><p>ä½¿ç”¨duå‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å¤§å°æ˜¯4.0KB</p><pre><code>~$ du -h hole.file4.0K    hole.file</code></pre><p>ç›¸å·®å¦‚æ­¤æ‚¬æ®Šï¼ï¼ğŸ§</p><p>ä½¿ç”¨odå‘½ä»¤æ¥æŸ¥çœ‹<code>hole.file</code>æ–‡ä»¶çš„äºŒè¿›åˆ¶å†…å®¹</p><pre><code>~$ od -c hole.file0000000  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0...</code></pre><p>ä¼šçœ‹åˆ°å…¶å®æ•´ä¸ª<code>hole.file</code>æ–‡ä»¶çš„å¼€å§‹æ˜¯ç”¨è®¸å¤šçš„â€\0â€æ¥å¡«å……çš„ï¼Œç”±äºä¸Šé¢è®¾ç½®äº†åç§»é‡æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è®¾ç½®å°ä¸€ç‚¹çš„seekæ¥è§‚å¯Ÿã€‚</p><p>æ¥ä¸‹æ¥ä½¿ç”¨catæ¥é‡å®šå‘æ–‡ä»¶åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶</p><pre><code>~$ cat hole.file &gt; hole.cat</code></pre><p>å†ä½¿ç”¨cpå‘½ä»¤å°†æ–‡ä»¶æ‹·è´ä¸€ä»½å‡ºæ¥</p><pre><code>~$ cp hole.file hole.cp</code></pre><p>ä½¿ç”¨lså‘½ä»¤æŸ¥çœ‹ä¸¤ä¸ªæ–°ç”Ÿæ–‡ä»¶çš„å¤§å°</p><pre><code>~$ ls -lh hole.cat hole.cp-rw-r--r-- 1 chenzhiling01 root 4.0M 8æœˆ  21 15:39 hole.cat-rw-r--r-- 1 chenzhiling01 root 4.0M 8æœˆ  21 15:40 hole.cp</code></pre><p>å†ä½¿ç”¨duæŸ¥çœ‹ä¸¤ä¸ªæ–°ç”Ÿæ–‡ä»¶çš„å¤§å°</p><pre><code>~$ du -h hole.cat hole.cp4.0M    hole.cat4.0K    hole.cp</code></pre><p>ä¼šçœ‹åˆ°ä½¿ç”¨caté‡å®šå‘å¾—åˆ°çš„æ–‡ä»¶çš„å¤§å°ä½¿ç”¨lså’Œduéƒ½æ˜¯4.0MBï¼Œè€Œä½¿ç”¨cpå‘½ä»¤å¾—åˆ°çš„æ–‡ä»¶å¤§å°ä¿¡æ¯å’ŒåŸæ¥çš„æ–‡ä»¶æ˜¯ä¸€æ ·çš„ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸ºä»€ä¹ˆlså’Œduå‘½ä»¤å¾—åˆ°çš„æ–‡ä»¶å¤§å°ä¼šç›¸å·®å¦‚æ­¤å·¨å¤§å‘¢ï¼Ÿæ˜¯å› ä¸ºlsè·å–å¾—åˆ°çš„æ˜¯æ–‡ä»¶çš„é€»è¾‘å¤§å°ï¼Œè€Œduè·å–å¾—åˆ°çš„æ˜¯æ–‡ä»¶çš„å®é™…å ç”¨ç‰©ç†å—çš„å¤§å°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“äº§ç”Ÿç©ºæ´æ–‡ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶ç³»ç»Ÿå¹¶ä¸ä¼šå°†ç©ºæ´æ–‡ä»¶éƒ¨åˆ†å¯¹åº”ä¹Ÿåˆ†é…å¥½ç©ºé—´ï¼Œé‚£æ ·æ˜¯ç›¸å½“æµªè´¹çš„ï¼Œè€Œä¸”è¿˜ä¼šè¢«ä¸€äº›é»‘å®¢åˆ©ç”¨ï¼Œåœ¨ç³»ç»Ÿä¸­äº§ç”Ÿå¤§é‡çš„ç©ºæ´æ–‡ä»¶æ¥è€—å°½ç³»ç»Ÿçš„å­˜å‚¨èµ„æºã€‚</p><p>ğŸ¦ä¸€ä¸ªå°æ’æ›²ï¼Œæˆ‘å‘ç°ls -shåˆ—å‡ºæ¥çš„å¤§å°å’Œduå‡ºæ¥çš„å¤§å°æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºls -sæ‰€è·å–å¾—åˆ°çš„æ˜¯æ–‡ä»¶å®é™…å ç”¨çš„å­˜å‚¨å—çš„å¤§å°ã€‚</p><p>å› æ­¤åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šé¢è§‚å¯Ÿï¼Œå¯¹åº”çš„æ–‡ä»¶çœ‹ä¸Šå»æ˜¯å’Œæ™®é€šæ–‡ä»¶ä¸€æ ·ï¼Œè¯¥å¤šå¤§å°±å¤šå¤§ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸ä¼šé©¬ä¸Šä¸ºæ–‡ä»¶åˆ†é…å¯¹åº”å¤§å°çš„å­˜å‚¨ã€‚</p><p>è€Œæˆ‘ä»¬ä½¿ç”¨catå’Œcpå‘½ä»¤å¾—åˆ°çš„æ–‡ä»¶å¤§å°ç«Ÿç„¶æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´cpå‘½ä»¤å’Œé‡å®šå‘çš„è¿‡ç¨‹æ˜¯è¿›è¡Œäº†ä¸ä¸€æ ·çš„æ“ä½œçš„ã€‚</p><p>catå‘½ä»¤é‡å®šå‘å†…å®¹åˆ°æ–°çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œå…¶é‡åˆ°äº†ç©ºæ´éƒ¨åˆ†ï¼Œä¼šç”¨0æ¥å¡«å……ï¼Œè¿™æ ·ç©ºæ´éƒ¨åˆ†å…¶å®ä¹Ÿå°±æœ‰äº†å†…å®¹äº†ï¼Œå¯¹åº”éœ€è¦ä¸ºä»–åˆ†é…ç‰©ç†å­˜å‚¨blockï¼Œè¿™æ ·æ–‡ä»¶çš„çœŸæ˜¯å¤§å°å…¶å®å°±æ˜¯4MBï¼Œä½†æ˜¯cpå‘½ä»¤åœ¨é‡åˆ°ç©ºæ´éƒ¨åˆ†çš„æ—¶å€™ï¼Œä¼šæ¨¡æ‹Ÿæºæ–‡ä»¶çš„ç©ºæ´è°ƒç”¨seekï¼Œè¿›è¡Œåç§»ä¹‹åå†è¿›è¡Œå†…å®¹æ‹·è´ï¼Œè¿™æ ·å…¶å®ç”Ÿæˆçš„æ–°æ–‡ä»¶å’Œæºæ–‡ä»¶æ˜¯ä¸€æ ·çš„ï¼Œç©ºæ´éƒ¨åˆ†éƒ½æ˜¯ä¸è¢«åˆ†é…çœŸæ˜¯å­˜å‚¨ç©ºé—´çš„ã€‚</p><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><p>ç©ºæ´æ–‡ä»¶çœ‹ä¸Šå»å¥½åƒæ˜¯ä¸€ä¸ªä¸å¤ªé è°±ä¸å¤ªå®‰å…¨çš„æ“ä½œï¼Œä½†å…¶å®åœ¨å¾ˆå¤šæƒ…å†µéƒ½å¾ˆæœ‰ç”¨ï¼š</p><ul><li>åƒåœ¨æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨è¿…é›·ä¸‹è½½çš„æ—¶å€™ï¼Œåˆšå¼€å§‹ä¸‹è½½ä½†æ˜¯æœ¬åœ°çš„ä¸‹è½½æ–‡ä»¶å°±å·²ç»å¥½å‡ ç™¾å…†äº†ï¼Œè¿™å°±åˆ©ç”¨äº†ç©ºæ´æ–‡ä»¶ã€‚ä¸ºäº†èƒ½å¤Ÿå¹¶è¡Œä¸‹è½½ï¼Œåˆ›å»ºç©ºæ´æ–‡ä»¶å¯ä»¥è®©å¤šçº¿ç¨‹åœ¨ä¸åŒçš„seekä¸Šé¢å¼€å§‹å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯ç©ºæ´æ–‡ä»¶å°±åªèƒ½ä¸²è¡Œå†™å…¥äº†ã€‚</li><li>åœ¨åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨imgå·¥å…·ç”Ÿæˆä¸€ä¸ªä¾‹å¦‚50GBå¤§å°çš„é•œåƒæ–‡ä»¶ï¼Œä½†æ˜¯å…¶å®åœ¨å®‰è£…å®Œç³»ç»Ÿä¹‹åï¼Œé•œåƒçš„å¤§å°å¯èƒ½åªæœ‰4GBï¼Œä¹Ÿå°±æ˜¯è¯´imgå¹¶ä¸ä¼šé©¬ä¸Šå°±å ç”¨æ‰ç‰©ç†å­˜å‚¨ç©ºé—´çš„50GBï¼Œè€Œæ˜¯åœ¨æœªæ¥ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­å¢åŠ çš„ã€‚</li></ul><p>ğŸ¤“ğŸ¤“ğŸ¤“</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://blog.csdn.net/shenlanzifa/article/details/44016537" target="_blank" rel="noopener">å­¦ä¹ ç¬”è®°ï¼šlinuxä¹‹æ–‡ä»¶ç©ºæ´</a></li><li><a href="https://blog.csdn.net/clamercoder/article/details/38361815" target="_blank" rel="noopener">æµ…æç©ºæ´æ–‡ä»¶</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚å¿µ&quot;&gt;&lt;/a&gt;æ¦‚å¿µ&lt;/h2&gt;&lt;p&gt;ä»€ä¹ˆæ˜¯ç©ºæ´æ–‡ä»¶(hole file)ï¼ŸğŸ’â€â™‚ï¸åœ¨Linuxä¸­ï¼Œlseekçš„ç³»ç»Ÿè°ƒç”¨æ˜¯å¯ä»¥æ”¹å˜åœ¨æ–‡ä»¶ä¸Šé¢çš„åç§»é‡çš„ï¼Œè€Œä¸”è¿˜å…è®¸å…¶è¶…å‡ºæ–‡ä»¶çš„é•¿
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://banbanpeppa.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå‘½ä»¤ - find</title>
    <link href="https://banbanpeppa.github.io/2019/08/15/linux/cmd/find/"/>
    <id>https://banbanpeppa.github.io/2019/08/15/linux/cmd/find/</id>
    <published>2019-08-15T08:23:00.000Z</published>
    <updated>2019-08-23T06:38:10.309Z</updated>
    
    <content type="html"><![CDATA[<p>findå‘½ä»¤è®©ç”¨æˆ·èƒ½å¤Ÿåœ¨ç³»ç»Ÿä¸Šæ ¹æ®ç›®å½•æ‰§è¡Œæ–‡ä»¶æœç´¢ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¯¹ç»“æœè¿›è¡Œä¸€äº›åç»­æ“ä½œã€‚å®ƒæ˜¯GNUçš„findutilså·¥å…·çš„ä¸€ä¸ªå­æ¨¡å—ï¼Œå¹¶ä¸”å’Œå…¶ä»–çš„å·¥å…·ä¸€åŒå½¢æˆäº†å¼ºå¤§çš„æ–‡ä»¶æœç´¢åŠŸèƒ½ã€‚findå·¥å…·å…·æœ‰å¾ˆå¼ºçš„çµæ´»æ€§ï¼Œå¯ä»¥æ ¹æ®ä¸€äº›ç‰¹å®šçš„æ¡ä»¶æ¥æœç´¢æ–‡ä»¶æˆ–è€…ç›®å½•ï¼ŒåŒæ—¶è¿˜å¯ä»¥æ ¹æ®ä¸€äº›æ¡ä»¶å‚æ•°æ¥å¤„ç†è·å–åˆ°çš„ç»“æœã€‚</p><h2 id="FindUtils"><a href="#FindUtils" class="headerlink" title="FindUtils"></a>FindUtils</h2><p>GNU Find Utilitiesæ˜¯ä¸€ä¸ªåœ¨GNUæ“ä½œç³»ç»Ÿä¸‹åŸºæœ¬çš„æ–‡ä»¶ç›®å½•æœç´¢å·¥å…·é›†åˆï¼Œè¿™äº›ç¨‹å¼é€šå¸¸ç”¨äºä¸å…¶ä»–çš„ä¸€äº›ç¨‹å¼ç»“åˆä¸€èµ·ä½¿ç”¨ï¼Œè¿›è€Œå®ç°æ¨¡å—åŒ–çš„å¼ºå¤§çš„æ–‡ä»¶ç›®å½•æœç´¢èƒ½åŠ›ã€‚</p><p>Find Utilitieså·¥å…·ä¸»è¦åŒ…å«äº†å¦‚ä¸‹ï¼š</p><ul><li>find - åœ¨å¯¹åº”ç›®å½•ä¸‹é¢æœç´¢å¯¹åº”çš„æ–‡ä»¶</li><li>locate - æŠŠåœ¨æ•°æ®åº“ä¸­ç¬¦åˆä¸€å®šæ ¼å¼çš„æ–‡ä»¶åˆ—å‡ºæ¥</li><li>updatedb - æ›´æ–°ä¸€ä¸ªæ–‡ä»¶åæ•°æ®åº“</li><li>xargs - æ ¹æ®æ ‡å‡†è¾“å…¥æ¥æ„å»ºä¸€ä¸ªå¯æ‰§è¡Œå‘½ä»¤</li></ul><p>findå·¥å…·åœ¨ä¸€ä¸ªç›®å½•æ ‘ä¸‹å»å¯»æ‰¾ä¸€ç³»åˆ—çš„æ–‡ä»¶ï¼Œå®ƒä¼šæœå¯»å¯¹åº”çš„ç›®å½•æ ‘å¹¶ä¸”å¤„ç†å¾—åˆ°é‚£äº›ç¬¦åˆç”¨æˆ·é¢„è®¾å¥½æ¡ä»¶çš„æ–‡ä»¶ã€‚</p><p>locateå·¥å…·ä¼šæœç´¢ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶åçš„æ•°æ®åº“ï¼Œå¹¶ä¸”å°†ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶åæ‰“å°å‡ºæ¥ï¼Œé€šå¸¸locateå‘½ä»¤ä¼šç»“åˆupdatedbå‘½ä»¤ä½¿ç”¨ï¼Œupdatedbä¼šæ›´æ–°æ•´ä¸ªç³»ç»Ÿçš„æ–‡ä»¶ä¿¡æ¯ï¼Œä¹‹ålocateå‘½ä»¤å¯ä»¥å®šä½åˆ°å¯¹åº”çš„æ–‡ä»¶å†…å®¹ã€‚locateçš„æŸ¥è¯¢æ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œåªè¦å¯¹åº”çš„databaseæ›´æ–°äº†ï¼Œå°±èƒ½å¿«é€Ÿå®šä½åˆ°æ–‡ä»¶ã€‚</p><p>updatedbç¨‹åºå°±æ˜¯ç»´æŠ¤ä¸€ä¸ªæ–‡ä»¶åæ•°æ®åº“ï¼Œè¿™ä¸ªæ•°æ®åº“ä¼šè¢«locateç¨‹åºä½¿ç”¨ï¼Œè¿™ä¸ªæ–‡ä»¶åæ•°æ®åº“ä¼šç»´æŠ¤ä¸€ç³»åˆ—çš„ç›®å½•æ ‘ç»„æˆçš„æ–‡ä»¶åˆ—è¡¨ï¼Œupdatedbå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™ä¼šæ›´æ–°å¯¹åº”çš„ç›®å½•æ ‘ï¼Œè¿™ä¸ªç¨‹åºå¯ä»¥äº¤ç»™cronæ¥åšå®šæ—¶æ›´æ–°ï¼Œæ¯å¤©è·Ÿæ–°ä»¥æ­¤å³å¯ã€‚å¦‚æœå†å¹³æ—¶ä½¿ç”¨çš„æ—¶å€™æƒ³è¦ç”¨æœ€æ–°çš„æ•°æ®åº“ï¼Œæ‰‹åŠ¨æ‰§è¡Œupdatedbå³å¯ã€‚</p><p>xargs ç¨‹åºä»æ ‡å‡†è¾“å…¥æµä¸­è·å–å¾—åˆ°ä¸€äº›åˆ—å†…å®¹ä½œä¸ºå‚æ•°ï¼Œå¹¶æä¾›ç»™åç»­çš„å‘½ä»¤æˆ–ç¨‹åºä½¿ç”¨ï¼Œä¾‹å¦‚ä¸€ä¸ªéå¸¸å¸¸è§çš„ä¾‹å­å°±æ˜¯è®²findå‘½ä»¤å¾—åˆ°çš„æ–‡ä»¶åæ”¶é›†åœ¨ä¸€èµ·ä½œä¸ºå‚æ•°ï¼Œæä¾›åç»­çš„åˆ é™¤æ“ä½œç­‰ç­‰ï¼š</p><pre><code>find . -type f | xargs ls -lkh</code></pre><p>å…·ä½“çš„FileUtilsåŠŸèƒ½å¯ä»¥æŸ¥çœ‹<a href="https://www.gnu.org/software/findutils/" target="_blank" rel="noopener">Findutils</a></p><h2 id="findçš„ä½¿ç”¨"><a href="#findçš„ä½¿ç”¨" class="headerlink" title="findçš„ä½¿ç”¨"></a>findçš„ä½¿ç”¨</h2><p>æ¥ä¸‹æ¥ä»‹ç»findå‘½ä»¤çš„ä½¿ç”¨ï¼ŒåŒæ—¶ä¼šæ ¹æ®å…¶æä¾›çš„å‚æ•°ä¸¾ä¾‹å­ã€‚</p><p>findå‘½ä»¤çš„åŸºç¡€ç”¨æ³•æ˜¯</p><pre><code class="bash">find [paths] [expression] [actions]</code></pre><p>findå‘½ä»¤å…è®¸ç”¨æˆ·ä¼ å…¥å¤šä¸ªpathsï¼Œå…¶ä¼šæ ¹æ®ä¸åŒçš„pathé€’å½’çš„å»åœ¨æ¯ä¸€ä¸ªpathä¸‹é¢å¯»æ‰¾ç”¨æˆ·æƒ³è¦çš„æ–‡ä»¶ï¼ŒçŸ¥é“å…¨éƒ¨æ‰¾å®Œã€‚é»˜è®¤findå‘½ä»¤ä¼šæŠŠpathsä¸‹é¢çš„æ‰€æœ‰pathséƒ½èµ°ä¸€éå› ä¸ºä¸ºäº†èƒ½å¤Ÿå¯»æ‰¾å¯¹åº”æ»¡è¶³ä¸€å®šè¦æ±‚çš„pathä¸‹é¢çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¡¨ç¤ºå¯¹åº”çš„pathã€‚</p><p>åŒæ—¶findå‘½ä»¤ä¹Ÿå¯ä»¥å¯¹å¯»æ‰¾å¾—åˆ°çš„ç»“æœè¿›è¡Œä¸€äº›å¤„ç†ï¼Œé»˜è®¤æ˜¯ç›´æ¥è¾“å‡ºæ‰¾åˆ°çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸ºäº†èƒ½å¤Ÿæ ¹æ®ä¸€å®šçš„è¦æ±‚æ¥å¯»æ‰¾å¯¹åº”çš„æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å¯¹åº”çš„ä¸€äº›actionæ¥è¿‡æ»¤æˆ–è€…å¤„ç†æ–‡ä»¶ã€‚</p><p>æ¥ä¸‹æ¥æ ¹æ®å‡ ä¸ªä¾‹å­æ¥åŠ å¼ºå¯¹findå‘½ä»¤çš„ç†è§£</p><h3 id="find-æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•"><a href="#find-æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•" class="headerlink" title="find æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•"></a>find æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•</h3><p>æœ‰æ—¶å€™ç”¨æˆ·æƒ³è¦å°†æŸä¸€ä¸ªç›®å½•ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œfindå‘½ä»¤é»˜è®¤èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä¾‹å¦‚å°†/usr/binä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶æ‰¾å‡ºæ¥</p><pre><code class="bash">$ find /usr/bin//usr/bin//usr/bin/dpkg/usr/bin/dpkg-deb/usr/bin/dpkg-divert/usr/bin/dpkg-maintscript-helper/usr/bin/dpkg-query/usr/bin/dpkg-split/usr/bin/dpkg-statoverride/usr/bin/dpkg-trigger/usr/bin/update-alternatives/usr/bin/debconf/usr/bin/debconf-apt-progress/usr/bin/debconf-communicate/usr/bin/debconf-copydb/usr/bin/debconf-escape/usr/bin/debconf-set-selections/usr/bin/debconf-show/usr/bin/deb-systemd-helper/usr/bin/deb-systemd-invoke/usr/bin/ischroot...</code></pre><p>ä¼šçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶åˆ—è¡¨éå¸¸å¤§ï¼Œå› ä¸ºå®ƒæŠŠ<code>/usr/bin</code>ç›®å½•ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•éƒ½æ˜¾ç¤ºå‡ºæ¥äº†ï¼ŒåŒ…æ‹¬<code>/usr/bin</code>ç›®å½•æœ¬èº«ã€‚</p><p>å¦‚æœæƒ³è¦ä»ä¸€å †çš„æ–‡ä»¶ç›®å½•ä¸­å¯»æ‰¾å‡ºæ‰€æœ‰çš„æ–‡ä»¶ï¼Œåˆ™å¯ä»¥åœ¨findåé¢è¿½åŠ ä¸åŒçš„path</p><pre><code class="bash">find /usr/share /bin /usr/lib</code></pre><p>å¦‚æœæƒ³è¦æŠŠå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ‰¾å‡ºæ¥</p><pre><code class="bash">find .</code></pre><p>æˆ–è€…</p><pre><code class="bash">find</code></pre><h3 id="find-by-name"><a href="#find-by-name" class="headerlink" title="find by name"></a>find by name</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬åªæƒ³æ ¹æ®æ–‡ä»¶çš„åå­—æ¥å¯»æ‰¾å¯¹åº”çš„æ–‡ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>-name</code>çš„actionæ¥å®ç°</p><pre><code class="bash">find . -name hello.txt</code></pre><p>è¿™ç§æ–¹å¼æ˜¯æ ¹æ®æ–‡ä»¶çš„å…¨åæ¥å¯»æ‰¾çš„ï¼Œä¹Ÿå°±æ˜¯è¯´<code>-name</code>çš„é»˜è®¤è¡Œä¸ºå°±æ˜¯æ ¹æ®æ–‡ä»¶çš„å…¨åæ¥å¯»æ‰¾ã€‚</p><p>å¦‚æœè¯´ç”¨æˆ·ä¸èƒ½ç¡®å®šæ–‡ä»¶çš„å¤§å°å†™ï¼Œå¯ä»¥ç”¨<code>-iname</code>æ¥å¯»æ‰¾</p><pre><code class="bash">find /usr -iname hello.txt</code></pre><p>å¦‚æœç”¨æˆ·è¿æ–‡ä»¶çš„å®Œæ•´åå­—ä¹Ÿæ— æ³•ç¡®å®šï¼Œåªæƒ³é€šè¿‡æ¨¡ç³ŠåŒ¹é…çš„å½¢å¼æ¥å¯»æ‰¾æ–‡ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å¯»æ‰¾</p><pre><code class="bash">find /usr -name &#39;*.txt&#39;</code></pre><p>å¦‚æœæƒ³æ ¹æ®æ–‡ä»¶åçš„é•¿åº¦æ¥å¯»æ‰¾æ–‡ä»¶ï¼Œä¾‹å¦‚æƒ³å¯»æ‰¾è·¯å¾„ä¸‹æ–‡ä»¶çš„å­—ç¬¦æ•°ç›®æ˜¯4çš„æ–‡ä»¶</p><pre><code class="bash">find /usr -name &#39;????&#39;</code></pre><p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·æƒ³è¦å¯»æ‰¾æŸä¸€ä¸ªç‰¹å®šçš„ç›®å½•ä¸‹é¢çš„ç¬¦åˆè¦æ±‚çš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ªç›®å½•ä¸­çš„æ‰€æœ‰ç¬¦åˆè¦æ±‚çš„æ–‡ä»¶éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>-path</code>ã€‚ä¾‹å¦‚ä¸€ä¸ªç›®å½•ä¸‹é¢æœ‰å¾ˆå¤šç›®å½•ï¼Œç°åœ¨æƒ³è¦åœ¨tmpç›®å½•ä¸‹é¢å¯»æ‰¾å‡ºæ–‡ä»¶åå­—ç¬¦æ•°ä¸º3çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œåˆ™å¯ä»¥æ‰§è¡Œ</p><pre><code class="bash">find . -path &#39;*tmp/???&#39;</code></pre><p>åŒæ—¶ä¹Ÿæœ‰ä¸€ä¸ª<code>-ipath</code>çš„actionæ¥å¿½ç•¥æ‰å¤§å°å†™çš„æ“ä½œ</p><h3 id="find-æ–‡ä»¶ç±»å‹"><a href="#find-æ–‡ä»¶ç±»å‹" class="headerlink" title="find æ–‡ä»¶ç±»å‹"></a>find æ–‡ä»¶ç±»å‹</h3><p>åœ¨Linuxç³»ç»Ÿä¸‹é¢ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ã€‚</p><p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¸æƒ³æ‰¾å‡ºç›®å½•ï¼Œåªæƒ³æ‰¾å‡ºå¯¹åº”è·¯å¾„ä¸‹æ»¡è¶³æ¡ä»¶çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨<code>-type</code>çš„actionæ¥å¯»æ‰¾ã€‚</p><p><code>-type</code>çš„ç±»å‹æ¯”è¾ƒå¸¸è§çš„æœ‰</p><ul><li>f: æ–‡ä»¶</li><li>d: ç›®å½•</li><li>l: è½¯é“¾æ¥</li></ul><p>ä¾‹å¦‚ï¼Œæ‰¾å‡ºtmpç›®å½•ä¸‹é¢å‡ºäº†ç›®å½•çš„æ–‡ä»¶</p><pre><code class="bash">find tmp -type f</code></pre><p>è‡ªç„¶ï¼Œç”¨æˆ·å¯ç»„åˆä¸åŒçš„actionsæ¥å¯»æ‰¾æ–‡ä»¶ï¼Œä¾‹å¦‚åªæ‰¾å‡ºtxtåç¼€çš„æ–‡ä»¶</p><pre><code class="bash">find tmp -type f -name &#39;*.txt&#39;</code></pre><h3 id="find-ç©ºæ–‡ä»¶æˆ–è€…ç©ºç›®å½•"><a href="#find-ç©ºæ–‡ä»¶æˆ–è€…ç©ºç›®å½•" class="headerlink" title="find ç©ºæ–‡ä»¶æˆ–è€…ç©ºç›®å½•"></a>find ç©ºæ–‡ä»¶æˆ–è€…ç©ºç›®å½•</h3><p>findå‘½ä»¤æ”¯æŒå¯»æ‰¾ç©ºçš„æ–‡ä»¶æˆ–è€…ç©ºçš„ç›®å½•</p><pre><code class="bash">find /tmp -empty</code></pre><h3 id="å¦å®šaction"><a href="#å¦å®šaction" class="headerlink" title="å¦å®šaction"></a>å¦å®šaction</h3><p>findå‘½ä»¤å¯ä»¥æ ¹æ®actionçš„å¦å®šæ¥å¤„ç†å¯»æ‰¾çš„æ–‡ä»¶ç»“æœã€‚</p><p>ä¾‹å¦‚å¯ä»¥å¯»æ‰¾å‡ºäº†åç¼€ä¸º<code>.txt</code>çš„æ–‡ä»¶</p><pre><code class="bash">find . ! -name &#39;*.txt&#39;</code></pre><p>æˆ–è€…å¯»æ‰¾å‡ºäº†ç©ºæ–‡ä»¶æˆ–è€…ç©ºç›®å½•ä»¥å¤–çš„æ–‡ä»¶</p><pre><code class="bash">find . ! -empty</code></pre><h3 id="æ ¹æ®æ–‡ä»¶å±ä¸»å¯»æ‰¾"><a href="#æ ¹æ®æ–‡ä»¶å±ä¸»å¯»æ‰¾" class="headerlink" title="æ ¹æ®æ–‡ä»¶å±ä¸»å¯»æ‰¾"></a>æ ¹æ®æ–‡ä»¶å±ä¸»å¯»æ‰¾</h3><p>findå‘½ä»¤å¯ä»¥æ ¹æ®æ–‡ä»¶çš„å±ä¸»æ¥å¯»æ‰¾ã€‚ä¾‹å¦‚æƒ³è¦å¯»æ‰¾æ–‡ä»¶å±ä¸»ä¸ºchenzhilingçš„æ–‡ä»¶</p><pre><code class="bash">find . -username chenzhiling</code></pre><p><code>-username</code>æ¥å—çš„å‚æ•°å€¼å¯ä»¥ä½¿usernameæˆ–è€…UIDï¼Œæƒ³è¦è·å–å¯¹åº”ç”¨æˆ·çš„UIDå¯ä»¥é€šè¿‡</p><pre><code class="bash">id -u chenzhiling</code></pre><p>åŒæ—¶ä¹Ÿå¯ä»¥æ ¹æ®ç”¨æˆ·æ‰€åœ¨çš„ç»„æˆ–è€…GIDæ¥å¯»æ‰¾å¯¹åº”çš„æ–‡ä»¶</p><pre><code class="bash">find . -group root</code></pre><p>å¦‚æœæƒ³è¦ä½¿ç”¨GIDæ¥å¯»æ‰¾ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è·å–å¯¹åº”çš„GID</p><pre><code>id -g chenzhiling</code></pre><h3 id="æ ¹æ®æ–‡ä»¶çš„æ—¶é—´å¯»æ‰¾"><a href="#æ ¹æ®æ–‡ä»¶çš„æ—¶é—´å¯»æ‰¾" class="headerlink" title="æ ¹æ®æ–‡ä»¶çš„æ—¶é—´å¯»æ‰¾"></a>æ ¹æ®æ–‡ä»¶çš„æ—¶é—´å¯»æ‰¾</h3><p>æ–‡ä»¶åœ¨åˆ›å»ºä¹‹åå°±ä¼šæœ‰ä¸‰ä¸ªæ—¶é—´è·Ÿéšç€æ–‡ä»¶ã€‚ç€ä¸‰ä¸ªæ—¶é—´åˆ†åˆ«æ˜¯mtimeã€atimeã€ctimeã€‚ä»–ä»¬åˆ†åˆ«è¡¨ç¤º</p><ul><li>mtime - æ–‡ä»¶çš„å†…å®¹è¢«ä¿®æ”¹çš„æ—¶å€™æ›´æ–°çš„æ—¶é—´</li><li>atime - æ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™è¢«æ›´æ–°çš„æ—¶é—´</li><li>ctime - æ–‡ä»¶çš„å…ƒä¿¡æ¯è¢«ä¿®æ”¹ï¼ˆä¾‹å¦‚æƒé™ï¼‰çš„æ—¶å€™æ›´æ–°çš„æ—¶é—´</li></ul><p>ä¸ºæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>-mtime</code>ã€<code>-atime</code>ã€<code>-ctime</code>çš„actionæ¥å¯»æ‰¾å¯¹åº”çš„æ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚å¯»æ‰¾åœ¨äº”å¤©å†…è¢«ä¿®æ”¹çš„æ–‡ä»¶</p><pre><code class="bash">find . -mtime -5 -type f</code></pre><p>å¯»æ‰¾åœ¨äº”å¤©ä»¥å‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</p><pre><code class="bash">find . -mtime +5 -type f</code></pre><p>å¯»æ‰¾æ–‡ä»¶åœ¨äº”å¤©å‰ï¼ˆå°±åœ¨ç¬¬äº”å¤©å‰ï¼‰è¢«ä¿®æ”¹çš„æ–‡ä»¶</p><pre><code class="bash">find . -mtime 5 -type f</code></pre><p>ä»¥æ­¤ç±»æ¨å¦å¤–ä¸¤ä¸ªactionçš„ç”¨æ³•ç±»ä¼¼ã€‚</p><p>å¦‚æœè§‰å¾—ä½¿ç”¨å¤©æ¥å¯»æ‰¾å¤ªé•¿äº†ï¼Œ findè¿˜æä¾›äº†ä½¿ç”¨<code>mmin</code>ã€<code>amin</code>ã€<code>cmin</code>è¿™ç§åˆ†é’Ÿçº§åˆ«çš„actionæ¥å¯»æ‰¾ï¼Œä¾‹å¦‚å¯»æ‰¾åœ¨5åˆ†é’Ÿä»¥å†…è¢«è®¿é—®çš„æ–‡ä»¶</p><pre><code class="bash">find . -type f -amin -5</code></pre><h3 id="æ ¹æ®æ–‡ä»¶å¤§å°æ¥å¯»æ‰¾"><a href="#æ ¹æ®æ–‡ä»¶å¤§å°æ¥å¯»æ‰¾" class="headerlink" title="æ ¹æ®æ–‡ä»¶å¤§å°æ¥å¯»æ‰¾"></a>æ ¹æ®æ–‡ä»¶å¤§å°æ¥å¯»æ‰¾</h3><p>åœ¨ä¸€äº›æ—¶å€™ï¼Œç”¨æˆ·æƒ³è¦å¯»æ‰¾ä¸€äº›å¤§äºæŸä¸ªå¤§å°æˆ–è€…å°äºæŸä¸€ä¸ªå¤§å°çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨<code>-size</code>æ¥å¯»æ‰¾</p><pre><code>find . -type f -size -10M</code></pre><p>ä»¥ä¸Šå‘½ä»¤æŠŠç›®å½•ä¸‹é¢å°äº10MBçš„æ–‡ä»¶éƒ½æ‰¾å‡ºæ¥ã€‚</p><p>æ–‡ä»¶çš„å¤§å°ä¸»è¦åˆ†ä¸ºäº†4ç±»</p><ul><li>c - bytes</li><li>k - kb</li><li>M - MB</li><li>G - GB</li></ul><h3 id="æ ¹æ®æ–‡ä»¶æƒé™æ¥å¯»æ‰¾"><a href="#æ ¹æ®æ–‡ä»¶æƒé™æ¥å¯»æ‰¾" class="headerlink" title="æ ¹æ®æ–‡ä»¶æƒé™æ¥å¯»æ‰¾"></a>æ ¹æ®æ–‡ä»¶æƒé™æ¥å¯»æ‰¾</h3><p>æ ¹æ®æ–‡ä»¶æƒé™æ¥å¯»æ‰¾æ–‡ä»¶ä½¿ç”¨<code>-perm</code>ï¼Œä»–æœ‰ä¸¤ç§æ–¹å¼æ¥å¯»æ‰¾ï¼Œä¸€ç§æ˜¯æ ¹æ®æƒé™çš„æ ‡è¯†ï¼Œå¦ä¸€ç§ç”¨æƒé™çš„æ•°å­—ã€‚</p><p>æˆ‘ä»¬çŸ¥é“åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶çš„æƒé™ä¸»è¦åˆ†ä¸ºäº†Userã€Groupå’ŒOtherçº§åˆ«çš„æƒé™ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="/images/linux/permissions.jpg" alt="image"></p><p>ä¾‹å¦‚è¦å¯»æ‰¾æ–‡ä»¶æƒé™ä¸º<code>rwxr-xr-x</code>çš„æ–‡ä»¶ï¼Œ</p><pre><code class="bash">find . -type f -perm u=rwx,g=rx,o=x</code></pre><p>åŒæ—¶ä¸ºäº†å¯»æ‰¾å¯¹äºæ‰€æœ‰çš„ç”¨æˆ·æƒé™éƒ½æ˜¯ä¸€æ ·çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨aæ¥è¡¨ç¤ºï¼Œä¾‹å¦‚å¯»æ‰¾æ–‡ä»¶æƒé™ä¸º<code>r-xr-xr-x</code>çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯¹äºæ‰€æœ‰çš„ç”¨æˆ·çš„æƒé™éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨</p><pre><code class="bash">find . -type f -perm a=rx</code></pre><p>ä¸ºäº†å¯»æ‰¾æŸä¸€ç±»æ–‡ä»¶ï¼Œåªæƒ³å…³å¿ƒå®ƒæœ‰æ‰§è¡Œæƒé™<code>x</code>ï¼Œå…¶ä»–çš„æƒé™å¯ä»¥è®¾ç½®ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œè¿™ä¸ªæ—¶å€™ä¸èƒ½åªæ˜¯ç®€å•çš„è®¾ç½®<code>-perm a=x</code>ï¼Œå› ä¸ºè¿™è¡¨ç¤ºçš„æ˜¯è¦å¯»æ‰¾çš„æ–‡ä»¶å¯¹äºæ‰€æœ‰çš„ç”¨æˆ·éƒ½åªæœ‰æ‰§è¡Œæƒé™ï¼Œå³<code>--x--x--x</code>ï¼Œè¿™æ—¶å€™å¯ä»¥ç”¨<code>-perm /a=x</code>çš„å½¢å¼æ¥å¯»æ‰¾é‚£äº›åŒ…å«äº†æ‰§è¡Œæƒé™çš„æ–‡ä»¶ï¼Œä½†æ˜¯åˆ«çš„æƒé™ä¸ºå¯ä»¥æ˜¯æœ‰æˆ–è€…æ— </p><pre><code class="bash">find . -type f -perm /a=x</code></pre><p>ä½¿ç”¨æƒé™æ•°å­—æ¥å¯»æ‰¾æ–‡ä»¶ï¼Œåˆ™ç›´æ¥åœ¨<code>-perm</code>åé¢è¿½åŠ æ•°å­—ä¸ºå‚æ•°å³å¯ã€‚ä¾‹å¦‚æŸä¸€ä¸ªæ–‡ä»¶çš„æƒé™æ˜¯<code>rwxr-xr-x</code>ï¼Œè¿™ä¸ªæƒé™å¯¹åº”çš„æ•°å­—è¡¨ç¤ºæ¨¡å¼ä¸º644ï¼Œåˆ™å¯»æ‰¾æ–‡ä»¶çš„æ—¶å€™å¯ä»¥</p><pre><code class="bash">find . -type f -perm 644</code></pre><p>åŒæ ·çš„ï¼Œåœ¨åªæƒ³å…³å¿ƒæŸä¸€ä¸ªæƒé™ä½çš„æ—¶å€™ï¼Œfindä¹Ÿæœ‰ä¸€ä¸ªè¡¨ç¤ºçš„æ–¹å¼ã€‚ä¾‹å¦‚ä¸Šé¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦æ‰¾ä¸€ç³»åˆ—æ–‡ä»¶ï¼Œå€¼å…³å¿ƒè¿™ä¸ªæ–‡ä»¶æ˜¯å¦æœ‰æ‰§è¡Œæƒé™<code>x</code>ï¼Œé‚£ä¹ˆæ¯ä¸ªæƒé™ä½ç½®çš„xä½ç½®éƒ½è®¾ç½®ä¸º1ï¼Œå…¶å®ƒä¸å…³å¿ƒçš„è®¾ç½®ä¸º0ï¼Œä¹Ÿå°±æ˜¯111ã€‚è¿™æ—¶å€™åœ¨111å‰é¢åŠ ä¸Š<code>-</code>å°±å¯ä»¥å®ç°åªå¤„ç†æƒé™çš„å­é›†äº†ã€‚</p><pre><code class="bash">find . -type f -perm -111</code></pre><p>é‚£ä¹ˆå¦‚æœè¯´ä½¿ç”¨</p><pre><code>find . -type f -perm -000</code></pre><p>åˆ™å…¶å®-permçš„æ•ˆæœå°±å¤±æ•ˆäº†ã€‚</p><h3 id="å¯»æ‰¾SUIDæ–‡ä»¶"><a href="#å¯»æ‰¾SUIDæ–‡ä»¶" class="headerlink" title="å¯»æ‰¾SUIDæ–‡ä»¶"></a>å¯»æ‰¾SUIDæ–‡ä»¶</h3><p>åœ¨ä¸Šé¢å­¦ä¼šäº†ä½¿ç”¨æ•°å­—æ¨¡å¼çš„æƒé™å¯»æ‰¾æ–‡ä»¶äº†ï¼Œé‚£ä¹ˆå¦‚æœæƒ³è¦å¯»æ‰¾å…·æœ‰SUIDæƒé™çš„æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸€æ ·çš„åšæ³•ï¼Œåªå…³å¿ƒSUIDçš„æƒé™ä½ç½®ï¼Œå…¶ä½™æƒé™éƒ½ä¸ç®¡</p><pre><code class="bash">find .  -type f -perm -4000</code></pre><p>åŒæ ·çš„ï¼Œå…ˆåˆšæŸ¥çœ‹æœ‰setuidçš„æƒé™æ–‡ä»¶çš„åŒæ—¶æƒ³æŸ¥çœ‹å…·æœ‰æ‰§è¡Œæƒé™çš„æ–‡ä»¶</p><pre><code class="bash">find . -type f -perm -4111</code></pre><p>æŸ¥çœ‹è®¾ç½®äº†setgidçš„æ–‡ä»¶</p><pre><code class="bash">find . -type -f -perm -2000</code></pre><p>æŸ¥çœ‹è®¾ç½®äº†ç²˜æ»ä½çš„æ–‡ä»¶</p><pre><code class="bash">find . -type -f -perm -1000</code></pre><p>è¿™ä¸ªstickyä½æ¯”è¾ƒç¥å¥‡ï¼Œæœ‰å…´è¶£å¯ä»¥Googleä¸€ä¸‹ã€‚</p><p>æŸ¥çœ‹è®¾ç½®äº†setuidå’Œstickyçš„è¯¥æ€ä¹ˆæ‰¾å‘¢ï¼Œå½“ç„¶è¿™ä¸ªå±äºæ¯”è¾ƒå°‘è§åˆ°çš„æ–‡ä»¶äº†ï¼Œæƒé™çš„æ ¼å¼ç±»ä¼¼äº<code>--s-----t</code>ï¼Œfindå‘½ä»¤åªè¦æ±‚å°†è¿™é‡Œä¸¤ä¸ªæƒé™æ•°å­—æ¨¡å¼ç›¸åŠ å³å¯ï¼Œä¹Ÿå°±æ˜¯5000</p><pre><code class="bash">find . -type f -perm -5000</code></pre><p>å¦‚æœæƒ³è¦ä½¿ç”¨æƒé™æ ‡è¯†æ¥è¡¨ç¤ºï¼Œåˆ™å¯ä»¥</p><pre><code class="bash">find . -type f -perm /u=sfind . -type f -perm /g=sfind . -type f -perm /o=t</code></pre><h3 id="è®¾ç½®æŸ¥è¯¢æ·±åº¦"><a href="#è®¾ç½®æŸ¥è¯¢æ·±åº¦" class="headerlink" title="è®¾ç½®æŸ¥è¯¢æ·±åº¦"></a>è®¾ç½®æŸ¥è¯¢æ·±åº¦</h3><p>å‰é¢æåˆ°äº†findå¯»æ‰¾æ–‡ä»¶æ˜¯é€šè¿‡è·¯å¾„å»é€’å½’æŸ¥è¯¢çš„ï¼Œé‚£ä¹ˆæœ‰æ—¶å€™æœ‰äº›ç›®å½•ä¸‹é¢çš„æ–‡ä»¶æ·±åº¦éå¸¸æ·±ï¼Œåˆ™ä¼šå¯¼è‡´æœç´¢çš„ç»“æœéå¸¸åºå¤§ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>-maxdepth</code>æ¥é™åˆ¶æœç´¢çš„æ·±åº¦</p><pre><code class="bash">find . -type f -maxdepth 3</code></pre><p>åè¿‡æ¥ä¹Ÿå¯ä»¥è®¾ç½®æœ€å°çš„æœç´¢æ·±åº¦</p><pre><code class="bash">find . -type f -mindepth 3</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://www.booleanworld.com/guide-linux-find-command/" target="_blank" rel="noopener">A Guide to the Linux â€œFindâ€ Command</a></li><li><a href="http://man7.org/linux/man-pages/man1/find.1.html" target="_blank" rel="noopener">man find</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;findå‘½ä»¤è®©ç”¨æˆ·èƒ½å¤Ÿåœ¨ç³»ç»Ÿä¸Šæ ¹æ®ç›®å½•æ‰§è¡Œæ–‡ä»¶æœç´¢ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¯¹ç»“æœè¿›è¡Œä¸€äº›åç»­æ“ä½œã€‚å®ƒæ˜¯GNUçš„findutilså·¥å…·çš„ä¸€ä¸ªå­æ¨¡å—ï¼Œå¹¶ä¸”å’Œå…¶ä»–çš„å·¥å…·ä¸€åŒå½¢æˆäº†å¼ºå¤§çš„æ–‡ä»¶æœç´¢åŠŸèƒ½ã€‚findå·¥å…·å…·æœ‰å¾ˆå¼ºçš„çµæ´»æ€§ï¼Œå¯ä»¥æ ¹æ®ä¸€äº›ç‰¹å®šçš„æ¡ä»¶æ¥æœç´¢æ–‡ä»¶æˆ–è€…ç›®å½•ï¼ŒåŒæ—¶è¿˜å¯ä»¥æ ¹æ®ä¸€äº›æ¡ä»¶
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://banbanpeppa.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå‘½ä»¤ â€” grep</title>
    <link href="https://banbanpeppa.github.io/2019/08/15/linux/cmd/grep/"/>
    <id>https://banbanpeppa.github.io/2019/08/15/linux/cmd/grep/</id>
    <published>2019-08-15T08:23:00.000Z</published>
    <updated>2019-08-21T08:08:10.111Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨Linuxçš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°åœ¨å¤§é‡æ–‡ä»¶ä¸­æŸ¥æ‰¾æŸä¸€äº›æ–‡ä»¶æ˜¯å¦åŒ…å«äº†æŸäº›æ–‡ä»¶å†…å®¹çš„æƒ…å†µã€‚ä¾‹å¦‚åœ¨ä¸€å †çš„æ—¥å¿—æ–‡ä»¶é‡Œé¢æŠŠå‡ºç°â€œmemoryâ€å­—çœ¼çš„æ–‡ä»¶è¿‡æ»¤å‡ºæ¥ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ç”¨findå‘½ä»¤å¯ä»¥ä½¿ç”¨ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼æ¥å¯»æ‰¾æŸä¸€äº›æ–‡ä»¶ï¼Œä½†æ˜¯å´ä¸èƒ½å¤Ÿç”¨æ¥å¯»æ‰¾æ–‡ä»¶å†…æ˜¯å¦åŒ…å«æŸä¸€äº›å†…å®¹ã€‚</p><p>grepå¯ä»¥å¸®æˆ‘ä»¬å®ç°è¿™ç§æ•ˆæœã€‚</p><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>grepçš„ä¸­æ–‡å…¨ç§°æ˜¯â€œå…¨é¢æœç´¢æ­£åˆ™è¡¨è¾¾å¼å¹¶æŠŠè¡Œæ‰“å°å‡ºæ¥â€ï¼Œå®ƒèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æœç´¢æ–‡æœ¬å¹¶ä¸”å°†åŒ¹é…çš„è¡Œæ‰“å‡ºæ¥ã€‚</p><h2 id="å¸¸ç”¨å‚æ•°"><a href="#å¸¸ç”¨å‚æ•°" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h2><p>é¦–å…ˆç”¨grepç›´æ¥æœç´¢æŸä¸ªæ–‡ä»¶å¾ˆç®€å•</p><pre><code>$ grep &quot;import&quot; setup.pyimport ioimport refrom setuptools import setup</code></pre><p>è¿™ç§è¾“å‡ºæ˜¯æœ€å¿«æ·æ–¹ä¾¿çš„</p><h3 id="r-amp-R"><a href="#r-amp-R" class="headerlink" title="-r &amp; -R"></a>-r &amp; -R</h3><p>å¦‚æœæƒ³å†ä¸€ä¸ªç›®å½•ä¸‹æœç´¢æ‰€æœ‰çš„åŒ…å«â€œimportâ€å†…å®¹çš„æ–‡ä»¶å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨-ræˆ–è€…-Rï¼Œå½“ç„¶ä»–ä»¬æœ‰ä¸€ç‚¹ç‚¹ä¸ä¸€æ ·</p><p>é¦–å…ˆåœ¨ä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•ç›®å½•ä¸‹é¢åˆ›å»ºaã€bã€cã€dæ–‡ä»¶ï¼Œè¿™å†™æ–‡ä»¶çš„å†…å®¹åˆ†åˆ«å¦‚ä¸‹</p><pre><code>$ for file in {a..d}; do echo &quot;$file:&quot;;cat $file; donea:importb:import testc:import test importimportd:IMPORTimport</code></pre><p>ç°åœ¨åˆ†åˆ«å¯¹dæ–‡ä»¶åˆ›å»ºä¸€ä¸ªç¡¬é“¾æ¥å’Œè½¯é“¾æ¥</p><pre><code>$ ln d e$ ln -s d f</code></pre><p>äºæ˜¯ç›®å½•ä¸‹çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹</p><pre><code>$ ls -alktotal 20drwxr-xr-x 2 chenzhiling01 root          60 8æœˆ  15 17:28 .drwxr-xr-x 6 chenzhiling01 chenzhiling01 93 8æœˆ  15 17:15 ..-rw-r--r-- 1 chenzhiling01 root           7 8æœˆ  15 16:55 a-rw-r--r-- 1 chenzhiling01 root          12 8æœˆ  15 17:27 b-rw-r--r-- 1 chenzhiling01 root          26 8æœˆ  15 17:28 c-rw-r--r-- 2 chenzhiling01 root          14 8æœˆ  15 17:19 d-rw-r--r-- 2 chenzhiling01 root          14 8æœˆ  15 17:19 elrwxrwxrwx 1 chenzhiling01 root           1 8æœˆ  15 16:57 f -&gt; d</code></pre><p>å…ˆæ¥çœ‹</p><pre><code>$ grep -r &#39;import&#39; ././a:import./b:import test./d:import./e:import./c:import test import./c:import</code></pre><p>å†ä½¿ç”¨-R</p><pre><code>$ grep -R &#39;import&#39; ././a:import./b:import test./d:import./e:import./f:import./c:import test import./c:import</code></pre><p>ä¼šçœ‹åˆ°-Rå¾—åˆ°çš„ç»“æœä¼šæ¯”-rå¤šä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯fï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯è½¯é“¾æ¥åˆ°dæ–‡ä»¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´-Rä¼šé€’å½’å¯»æ‰¾ï¼ŒåŒæ—¶ä¸ä¼šå¿½ç•¥æ‰è½¯é“¾æ¥çš„æ–‡ä»¶ã€‚</p><h3 id="h-amp-H"><a href="#h-amp-H" class="headerlink" title="-h &amp; -H"></a>-h &amp; -H</h3><p>å¦‚æœåªæƒ³çœ‹çœ‹å¯¹åº”æŸä¸€ä¸ªæ–‡ä»¶å†…å®¹å‡ºç°çš„å…·ä½“è¡Œï¼Œè€Œä¸åƒè¦çœ‹åˆ°å¯¹åº”çš„æ–‡ä»¶åï¼Œåˆ™å¯ä»¥ä½¿ç”¨-hï¼Œè€Œ-Håˆ™æ˜¯è¾“å‡ºæ–‡ä»¶å</p><pre><code>$ grep -r -h &quot;import&quot; ./importimport testimportimportimport test importimport</code></pre><pre><code>$ grep -r -H &quot;import&quot; ././a:import./b:import test./d:import./e:import./c:import test import./c:import</code></pre><p>æ‰€ä»¥å¦‚æœæƒ³å€¼çœ‹åˆ°æ–‡ä»¶åï¼Œå¯ä»¥ç»“åˆç®¡é“å’Œcut</p><pre><code>$ grep -r -H &quot;import&quot; ./ | cut -d: -f1./a./b./d./e./c./c</code></pre><h3 id="egrepæŸ¥æ‰¾"><a href="#egrepæŸ¥æ‰¾" class="headerlink" title="egrepæŸ¥æ‰¾"></a>egrepæŸ¥æ‰¾</h3><p>åœ¨ä¸€äº›æƒ…å†µä¸‹å¯èƒ½ä¼šæƒ³æ‰¾å¤šä¸ªå†…å®¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨egrep</p><pre><code>egrep -w -R &#39;word1|word2&#39; ./</code></pre><h3 id="è§£å†³é”™è¯¯"><a href="#è§£å†³é”™è¯¯" class="headerlink" title="è§£å†³é”™è¯¯"></a>è§£å†³é”™è¯¯</h3><p>åœ¨ä¸€äº›æ—¶å€™å¯èƒ½ä¼šå‡ºç°æƒé™é—®é¢˜æˆ–è€…æ–‡ä»¶ä¸å­˜åœ¨ç­‰é—®é¢˜ï¼Œä½†æ˜¯grepé»˜è®¤æ˜¯ä¸ä¼šå¤„ç†è¿™ä¸ªé”™è¯¯ä¿¡æ¯çš„ï¼Œå¯ä»¥å°†é”™è¯¯ä¿¡æ¯é€šè¿‡é‡å®šå‘æˆ–è€…æŠ‘åˆ¶ï¼ˆ-sï¼‰çš„æ–¹å¼</p><pre><code>grep -r -H &quot;import&quot; ./ 2&gt;/dev/nullgrep -r -H -s &quot;import&quot; ./</code></pre><h2 id="å‚æ•°åˆ—è¡¨"><a href="#å‚æ•°åˆ—è¡¨" class="headerlink" title="å‚æ•°åˆ—è¡¨"></a>å‚æ•°åˆ—è¡¨</h2><p>grepå¾ˆå¼ºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥è¿‡æ»¤è‡ªå·±æƒ³è¦çš„ä¿¡æ¯ï¼Œå¾ˆå¤šäººæœ€å¸¸ç”¨çš„å°±æ˜¯<code>ps -aux | grep xxx</code>ï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­å¯ä»¥å°½å¯èƒ½æŒ–æ˜ä»–çš„åŠŸèƒ½ã€‚</p><p>grepçš„å¸¸ç”¨å‚æ•°</p><pre><code>-r â€“ é€’å½’æœç´¢-R â€“ åœ¨æ¯ä¸€ä¸ªç›®å½•ä¸‹é¢é€’å½’æœç´¢ï¼ŒåŒæ—¶ä¼šæœç´¢é“¾æ¥çš„æ–‡ä»¶ã€‚-n â€“ æ‰“å°å‡ºæœç´¢åˆ°çš„å†…å®¹åœ¨æ–‡ä»¶ä¸­çš„è¡Œ-s â€“ æŠ‘åˆ¶é”™è¯¯çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…ä¸å¯è¯»çš„æ–‡ä»¶-w â€“ åªæ ¹æ®æ•´ä¸ªæœç´¢è¯æ±‡çš„å€¼æ¥æœç´¢ï¼Œè€Œä¸æ˜¯ä»¥æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å½¢å¼-i â€“ å¿½ç•¥å¤§å°å†™å»æœç´¢-a - å°† binary æ–‡ä»¶ä»¥ text æ–‡ä»¶çš„æ–¹å¼æœå¯»æ•°æ®-c - è®¡ç®—æ‰¾åˆ° &#39;æœå¯»å­—ç¬¦ä¸²&#39; çš„æ¬¡æ•°-v - åå‘é€‰æ‹©ï¼Œäº¦å³æ˜¾ç¤ºå‡ºæ²¡æœ‰ &#39;æœå¯»å­—ç¬¦ä¸²&#39; å†…å®¹çš„é‚£ä¸€è¡Œ-E - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼-A - åé¢è·Ÿæ•°å­—nï¼Œè¡¨ç¤ºæ˜¾ç¤ºæœç´¢å¾—åˆ°çš„ç»“æœä»¥åŠå‰nè¡Œ-B - åé¢è·Ÿæ•°å­—nï¼Œè¡¨ç¤ºæ˜¾ç¤ºæœç´¢å¾—åˆ°çš„ç»“æœä»¥åŠånè¡Œ-C - åé¢è·Ÿæ•°å­—nï¼Œè¡¨ç¤ºæ˜¾ç¤ºæœç´¢å¾—åˆ°çš„ç»“æœä»¥åŠå‰ånè¡Œ--color - å¯¹grepå‡ºçš„ç»“æœè¿›è¡Œé¢œè‰²åŒºåˆ†</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨ä½¿ç”¨Linuxçš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°åœ¨å¤§é‡æ–‡ä»¶ä¸­æŸ¥æ‰¾æŸä¸€äº›æ–‡ä»¶æ˜¯å¦åŒ…å«äº†æŸäº›æ–‡ä»¶å†…å®¹çš„æƒ…å†µã€‚ä¾‹å¦‚åœ¨ä¸€å †çš„æ—¥å¿—æ–‡ä»¶é‡Œé¢æŠŠå‡ºç°â€œmemoryâ€å­—çœ¼çš„æ–‡ä»¶è¿‡æ»¤å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ç”¨findå‘½ä»¤å¯ä»¥ä½¿ç”¨ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼æ¥å¯»æ‰¾æŸä¸€äº›æ–‡ä»¶ï¼Œä½†æ˜¯å´ä¸èƒ½å¤Ÿç”¨æ¥å¯»æ‰¾æ–‡ä»¶å†…æ˜¯å¦åŒ…å«æŸä¸€
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://banbanpeppa.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>MySQLæ‚è®°</title>
    <link href="https://banbanpeppa.github.io/2019/08/14/linux/mysql/"/>
    <id>https://banbanpeppa.github.io/2019/08/14/linux/mysql/</id>
    <published>2019-08-14T06:23:00.000Z</published>
    <updated>2019-08-21T06:38:19.382Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸çš„åº”ç”¨å¼€å‘ä¸­ï¼Œmysqlå¯ä»¥è¯´æ˜¯å¾ˆå¤§éƒ¨åˆ†åº”ç”¨å¼€å‘è€…çš„é¦–é€‰ï¼Œå¤§å®¶éƒ½çœ‹é‡ä»–å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚äº‹åŠ¡ã€å¿«é€Ÿæ£€ç´¢çš„èƒ½åŠ›ç­‰ã€‚</p><p>ä¾‹ 1ï¼šåˆ—å‡ºæ‰€æœ‰æ•°æ®åº“</p><pre><code>mysql -h host_name -P3306 -u user_name -p&#39;password&#39; -se &quot;show databases;&quot;</code></pre><p>ä¾‹ 2ï¼šåˆ—å‡º database ä¸‹çš„æ‰€æœ‰è¡¨</p><pre><code>mysql -h host_name -P3306 -u user_name -p&#39;password&#39; -D database -se &quot;show tables;&quot;</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨æ—¥å¸¸çš„åº”ç”¨å¼€å‘ä¸­ï¼Œmysqlå¯ä»¥è¯´æ˜¯å¾ˆå¤§éƒ¨åˆ†åº”ç”¨å¼€å‘è€…çš„é¦–é€‰ï¼Œå¤§å®¶éƒ½çœ‹é‡ä»–å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚äº‹åŠ¡ã€å¿«é€Ÿæ£€ç´¢çš„èƒ½åŠ›ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹ 1ï¼šåˆ—å‡ºæ‰€æœ‰æ•°æ®åº“&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mysql -h host_name -P3306 -u user_name -p&amp;#3
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://banbanpeppa.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹</title>
    <link href="https://banbanpeppa.github.io/2019/08/06/linux/arp-and-attack/"/>
    <id>https://banbanpeppa.github.io/2019/08/06/linux/arp-and-attack/</id>
    <published>2019-08-06T11:18:00.000Z</published>
    <updated>2019-08-09T03:22:55.551Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹"><a href="#ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹" class="headerlink" title="ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹"></a>ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹</h2><p>åœ¨å±€åŸŸç½‘ç¯å¢ƒä¸‹ï¼Œä¸»æœºä¹‹é—´æ˜¯é€šè¿‡ARPåè®®è·å–å¯¹åº”æœºå™¨çš„MACåœ°å€çš„ï¼ŒARPäº¤æ¢æ˜¯åœ¨äºŒå±‚ç½‘ç»œä¸Šé¢çš„åè®®ã€‚IPæ•°æ®åŒ…åœ¨ä»¥å¤ªç½‘ä¸­ä¼ é€’ï¼Œä½†æ˜¯å¯¹äºä»¥å¤ªç½‘è®¾å¤‡æ˜¯ä¸èƒ½è¯†åˆ«32ä½çš„IPåœ°å€çš„ï¼Œå®ƒåªèƒ½è¯†åˆ«48çš„ç‰©ç†MACåœ°å€ï¼Œä¸ºæ­¤åœ¨æ¯ä¸€å°ä¸»æœºä¸Šé¢éƒ½ä¼šç»´æŠ¤ä¸€å¼ ä»IPåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„è¡¨ï¼Œè€Œä¸æ–­æ›´æ–°è¿™ä¸ªæ˜ å°„è¡¨å°±æ˜¯ARPï¼ˆåœ°å€è§£æåè®®ï¼‰æ‰€éœ€è¦åšçš„äº‹æƒ…ï¼ŒARPåè®®ä½äºTCP-IPåè®®çš„åº•å±‚ã€‚</p><p>ARPåè®®çš„ä¸»è¦æµç¨‹æ˜¯</p><ul><li>1. å½“ç½‘ç»œå±‚çš„TCP-IPåè®®å°è£…çš„æ•°æ®åŒ…ä¼ æ¥æ—¶ï¼Œä¸»æœºAè§£å¼€å¯¹åº”çš„æ•°æ®åŒ…ï¼Œå¾—åˆ°å¯¹åº”çš„ä¸»æœºBçš„ç›®çš„IPåœ°å€</li><li>2. æ ¹æ®å°åŒ…ä¸­çš„ç›®çš„IPåœ°å€å»æ£€ç´¢æœ¬åœ°çš„ARPè¡¨ï¼Œåˆ†ä¸‰ç§æƒ…å†µå¤„ç†<ul><li>å¦‚æœæ‰¾åˆ°äº†å¯¹åº”çš„è®°å½•åˆ™å°†å¯¹åº”çš„ç›®çš„MACåœ°å€è£…å…¥åˆ°å¸§æ•°æ®åŒ…ï¼ŒåŒæ—¶å°†æ•°æ®åŒ…å‘é€è‡³å¯¹åº”çš„ä¸»æœºï¼›</li><li>å¦‚æœåœ¨æœ¬åœ°çš„ARPè¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„æ˜ å°„è®°å½•ï¼Œä¸»æœºAéœ€è¦ç¡®å®šå¯¹åº”çš„ç›®çš„IPåœ°å€å’Œè‡ªå·±æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ä¸‹ï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªå­ç½‘ä¸‹é¢ï¼Œåˆ™ä¸»æœºAä¼šå‘èµ·ä¸€ä¸ªARP Replyçš„å¹¿æ’­å°åŒ…è¯·æ±‚ï¼Œè¿™ä¸ªå°åŒ…ä¼šå‘é€è‡³å±€åŸŸç½‘ä¸­çš„æ¯ä¸€å°æœºå™¨ï¼›è¿›å…¥3</li><li>å¦‚æœä¸åœ¨åŒä¸€ä¸ªå­ç½‘ä¸‹ï¼Œåˆ™ä¸»æœºAä¼šå°†ARP Replyå°åŒ…å‘ç»™é»˜è®¤ç½‘å…³è¯¢é—®å¯¹åº”çš„MACåœ°å€</li></ul></li><li>3. å½“æœºå™¨æ¥æ”¶åˆ°äº†ARP Replyå°åŒ…ä¹‹åï¼Œè§£å¼€å°åŒ…æŸ¥çœ‹ç›®çš„IPåœ°å€æ˜¯å¦ä¸ºè‡ªå·±çš„IPåœ°å€ï¼Œå¦‚æœæ˜¯åˆ™å°†æºMACåœ°å€å’ŒIPåœ°å€è®°å½•åœ¨æœ¬åœ°çš„ARPè¡¨ä¸­ï¼ˆå¦‚æœå·²ç»å­˜åœ¨åˆ™è¦†ç›–ï¼‰ï¼ŒåŒæ—¶å›åº”è‡ªå·±çš„MACåœ°å€å’ŒIPåœ°å€å“åº”ä¸»æœºAï¼›å¦‚æœè§£å¼€ä¹‹åçš„ç›®çš„IPåœ°å€ä¸æ˜¯è‡ªå·±çš„åœ°å€ï¼Œåˆ™å¿½ç•¥</li><li>4. åœ¨å‘é€ç«¯æ”¶åˆ°äº†å¯¹åº”çš„ARPå“åº”ä¹‹åï¼Œåˆ™å°†ARP Replyçš„è®°å½•æ·»åŠ åˆ°æœ¬åœ°çš„ARPè¡¨ä¸­ï¼ŒåŒæ—¶ç”¨è¿™ä¸ªç›®çš„åœ°å€å°†æ•°æ®å‘é€è‡³ç›®çš„ä¸»æœº</li></ul><p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹å›¾<br><img src="/images/linux/arp.jpg" alt="image"></p><ul><li>ä¸»æœºAæƒ³è¦è®¿é—®å…¬ç½‘ï¼Œæ‰§è¡Œäº†<code>ping 114.114.114.114</code>çš„æ“ä½œ</li><li>Aé»˜è®¤ä¼šå°†è¿™ä¸ªè¯·æ±‚åŒ…ä¹Ÿå°±æ˜¯pingåŒ…å‘ç»™ç½‘å…³192.168.10.1ï¼Œä½†æ˜¯ä¸»æœºAå¹¶ä¸çŸ¥é“ç½‘å…³çš„macåœ°å€ï¼Œäºæ˜¯è¿™ä¸ªæ—¶å€™Aä¼šå‘é€ä¸€ä¸ªARP Requestçš„å¹¿æ’­è¯·æ±‚ï¼Œè¯¢é—®åœ¨å±€åŸŸç½‘ä¸­IPåœ°å€ä¸º192.168.10.1çš„macåœ°å€ã€‚</li><li>å½“è·¯ç”±å™¨æ”¶åˆ°äº†è¿™ä¸ªARPè¯·æ±‚ä¹‹åï¼Œå‘ç°è¯·æ±‚ä¸­çš„ipåœ°å€æ˜¯è‡ªå·±çš„åœ°å€ï¼Œä¼šå›åº”Aï¼Œå‘é€ä¸€ä¸ªå›åº”å•æ’­åŒ…ç»™Aï¼Œå‘Šè¯‰å®ƒè‡ªå·±çš„macåœ°å€æ˜¯ä»€ä¹ˆã€‚</li><li>å½“Aæ‹¿åˆ°äº†ç½‘å…³çš„ç‰©ç†åœ°å€åï¼Œå°±å¯ä»¥å°†icmpçš„æ•°æ®åŒ…å°è£…å¹¶å‘é€åˆ°å¯¹åº”çš„è·¯ç”±å™¨ä¸­</li><li>è·¯ç”±å™¨è§£å¼€æ•°æ®åŒ…åˆ¤æ–­å¯¹åº”çš„ç›®çš„åœ°å€æ˜¯ä»€ä¹ˆï¼Œç„¶åæŸ¥çœ‹è‡ªå·±æœ¬åœ°çš„è·¯ç”±è¡¨è¿›è¡Œè·¯ç”±ï¼Œå°†è¯·æ±‚åŒ…è½¬å‘å‡ºå»ã€‚</li><li>è·¯ç”±å™¨åœ¨ä¹‹åæ¥å—åˆ°äº†å…¬ç½‘å›åº”çš„icmpå›æ˜¾åŒ…çš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°è¿™ä¸ªå›æ˜¾åŒ…çš„æºåœ°å€æ˜¯<code>114.114.114.114</code>ï¼Œç›®çš„åœ°å€æ˜¯<code>192.168.10.3</code>ï¼Œå› ä¸ºè·¯ç”±å™¨éœ€è¦æŸ¥çœ‹è‡ªå·±æœ¬åœ°çš„arpè¡¨å»æŸ¥çœ‹æ˜¯å¦æœ‰å¯¹åº”çš„ç›®çš„åœ°å€çš„åŒ¹é…è¡¨ï¼Œå¦‚æœæœ‰åˆ™å°†å›æ˜¾åŒ…å‘é€åˆ°å¯¹åº”çš„macåœ°å€çš„æœºå™¨Aï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±éœ€è¦åœ¨å±€åŸŸç½‘ä¸­å‘é€ä¸€ä¸ªarp requestçš„è¯·æ±‚ï¼Œè¯¢é—®Açš„macåœ°å€ã€‚</li><li>ä¸»æœºAæœ€åæ”¶åˆ°äº†icmpçš„å›æ˜¾åŒ…</li></ul><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šçœ‹åˆ°å‡è®¾è¯´ä¸»æœºAæˆ–è€…è·¯ç”±å™¨åœ¨è‡ªå·±æœ¬åœ°çš„arpè¡¨ä¸­å¦‚æœæ²¡æœ‰å¯¹åº”çš„è®°å½•çš„æ—¶å€™ï¼Œéƒ½éœ€è¦å»è¯¢é—®å¯¹åº”çš„macåœ°å€å¹¶ä¸”æ›´æ–°arpè¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´arpè¡¨ç¤ºä¼šä¸€è‡´åˆ·æ–°çš„ã€‚</p><p>é‚£ä¹ˆåœ¨linuxç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬çš„arpè¡¨åˆ°äº†ä»€ä¹ˆæƒ…å†µä¼šè¢«æ¸…ç†å‘¢ï¼Ÿ</p><p>åœ¨linuxç³»ç»Ÿä¸­ï¼Œarpè¡¨æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤åœ¨åˆ°äº†ä¸€å®šçš„é‡ä¹‹åï¼Œä¼šæœ‰å¯¹åº”çš„åƒåœ¾å›æ”¶å™¨æ¥å›æ”¶å¯¹åº”çš„arpè¡¨ã€‚å¯¹åº”çš„é…ç½®åœ¨ä¸€ä¸‹æ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°</p><pre><code>Debian 9/proc/sys/net/ipv4/neigh/default/gc_thresh1 /proc/sys/net/ipv4/neigh/default/gc_thresh2 /proc/sys/net/ipv4/neigh/default/gc_thresh3</code></pre><p>é»˜è®¤æ¥è¯´ä»–ä»¬çš„å€¼åˆ†åˆ«ä¸º128ã€512ã€1024ï¼Œç¬¬ä¸€ä¸ªå€¼çš„åƒåœ¾å›æ”¶å™¨è¿è¡Œçš„æœ€ä½è¦æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨arpæ•°ç›®è¾¾åˆ°äº†è¿™ä¸ªå€¼ä¹‹åæ‰ä¼šå¯åŠ¨å¯¹åº”çš„åƒåœ¾å›æ”¶è¿›ç¨‹ï¼Œç¬¬äºŒä¸ªå€¼æ˜¯ä¸€ä¸ªå¼€å§‹å›æ”¶çš„é˜ˆå€¼ï¼Œå½“arpè¡¨çš„æ•°ç›®è¶…è¿‡è¿™ä¸ªå€¼ä¸€å®šæ—¶é—´ï¼ˆ5ç§’ï¼‰ä¹‹åï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¼šå¯¹arpè¡¨è¿›è¡Œå›æ”¶ï¼Œè€Œç¬¬ä¸‰ä¸ªå€¼åˆ™æ˜¯ä¸€ä¸ªè§¦å‘é˜ˆå€¼ï¼Œå°±æ˜¯è¯´ä¸€æ—¦è¶…è¿‡è¿™ä¸ªå€¼åƒåœ¾å›æ”¶å™¨é©¬ä¸Šå°±è¿›è¡Œarpçš„æ¸…ç†ï¼Œå½“ç„¶åœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å…¨éƒ¨éƒ½åˆ·æ‰çš„ï¼Œè€Œæ˜¯ä¼šæ ¹æ®ä¸€å®šçš„ç­–ç•¥è¿›è¡Œå›æ”¶ã€‚</p><h2 id="ARPæ¬ºéª—"><a href="#ARPæ¬ºéª—" class="headerlink" title="ARPæ¬ºéª—"></a>ARPæ¬ºéª—</h2><p>å…¶å®åœ¨ARPçš„æ•´ä¸ªå·¥ä½œæµç¨‹ä¸­ä¸éš¾çœ‹å‡ºï¼Œå…¶å®æ˜¯å­˜åœ¨ä¸€å®šçš„å¯ä¹˜ä¹‹æœºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨å›¾ä¸­çš„Bä¸»æœºæ˜¯å¯ä»¥åŠ å…¥åˆ°æ•´ä¸ªarpå·¥ä½œæµç¨‹æ¥è¿›è¡Œarpæ¬ºéª—çš„ã€‚</p><p>å…·ä½“çš„åšæ³•å¦‚ä¸‹<br><img src="/images/linux/arp-cheat.jpg" alt="image"></p><ul><li>åœ¨Aéœ€è¦å¾€å¤–å‘é€icmpçš„ä¸€ä¸ªå›æ˜¾è¯·æ±‚æŠ¥æ–‡çš„æ—¶å€™ï¼Œä¸»æœºBå‘èµ·ARPæ”»å‡»ï¼Œé‡å¤å¾—å‘é€ä¸€ä¸ªARPå›åº”åŒ…ï¼ŒåŒ…çš„å†…å®¹ä¸º<code>mac:xx:xx:xx:yy:xx ip:192.168.10.1</code>ï¼Œä»¥æ­¤æ¥ä¼ªè£…è‡ªå·±å°±æ˜¯ç½‘å…³ï¼Œè®©Aå°†æ•°æ®å‘ç»™è‡ªå·±</li><li>äºæ­¤åŒæ—¶ï¼Œä¸»æœºBä¹Ÿé€šè¿‡å›åº”æŠ¥æ–‡çš„å½¢å¼å‘Šè¯‰ç½‘å…³ä¹Ÿå°±æ˜¯è·¯ç”±å™¨ï¼Œç§°è‡ªå·±æ˜¯ä¸»æœºAï¼Œå…·ä½“çš„æŠ¥æ–‡å†…å®¹ä¸º<code>max: xx:xx:xx:yy:xx ip: 192.168.10.3</code>ï¼Œè¿™æ ·ä¸»æœºBå°±è¾¾åˆ°äº†æ•°æ®åŒ…å—…æ¢çš„èƒ½åŠ›</li><li>ä¸»æœºAå…ˆå°†è‡ªå·±çš„æ•°æ®åŒ…å‘ç»™Bï¼Œå› ä¸ºå®ƒè¯¯ä»¥ä¸ºBæ˜¯ç½‘å…³ï¼ŒBå†å°†æ•°æ®è½¬å‘ç»™è·¯ç”±å™¨ï¼Œè¿™ä¸ªæ—¶å€™è·¯ç”±å™¨æ¥æ”¶äº†æ•°æ®ä¹‹åå°†æ•°æ®è½¬å‘åˆ°å…¬ç½‘</li><li>è¿™é‡Œä¸»æœºBæ˜¯å®Œå…¨å¯ä»¥ä¾¦å¬Açš„æ•°æ®åŒ…çš„ï¼Œç”šè‡³å»ç¯¡æ”¹Açš„æ•°æ®åŒ…</li></ul><p>ä¸‹é¢å¯ä»¥é€šè¿‡linuxæ¥æ¨¡æ‹Ÿè¿™ä¹ˆä¸€ä¸ªå®éªŒ</p><p>é¦–å…ˆå®‰è£…ä¸€ä¸ªarpæ”»å‡»çš„æ¨¡æ‹Ÿå·¥å…·åŒ…</p><pre><code>apt install dsniff</code></pre><p>åŒæ—¶åœ¨æ”»å‡»çš„æœºå™¨ä¸Šé¢æ‰“å¼€ipè½¬å‘</p><pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></pre><p>ç„¶åä½¿ç”¨ arpspoof å‘½ä»¤è¿›è¡Œæ¬ºéª—, å‘½ä»¤ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:</p><pre><code>arpspoof -i &lt;ç½‘å¡å&gt; -t &lt;æ¬ºéª—çš„ç›®æ ‡&gt; &lt;æˆ‘æ˜¯è°&gt;</code></pre><p>åˆ†åˆ«å¼€ä¸¤ä¸ªç»ˆç«¯:</p><p>ç»ˆç«¯1, æ¬ºéª—ä¸»æœº A æˆ‘æ˜¯ç½‘å…³</p><pre><code>arpspoof -i eth0 -t 192.168.10.3 192.168.10.1</code></pre><p>ç»ˆç«¯2, æ¬ºéª—ç½‘å…³æˆ‘æ˜¯ä¸»æœº A</p><pre><code>arpspoof -i eth0 -t 192.168.10.1 192.168.10.3</code></pre><p>è¿™æ ·ä¹‹åï¼Œåœ¨ä¸»æœºBä¸Šé¢å°±å¯ä»¥æ‰§è¡Œtcpdumpæˆ–è€…urlsnarfæ¥ä¾¦å¬æ•°æ®äº†</p><pre><code>apt install tcpdump snarf</code></pre><p>ä½¿ç”¨tcpdump</p><pre><code>tcpdump -nntvvv -i eth0 port 8080 </code></pre><p>ä½¿ç”¨urlsnarf</p><pre><code>urlsnarf -i eth0</code></pre><p>arpæ¬ºéª—çš„å½¢å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚æœ‰ï¼šä¸­é—´äººæ”»å‡»ã€è¢«åŠ¨å¼æ•°æ®å—…æ¢ã€‚</p><p>å¦‚ä½•é˜²å¾¡ ARP æ¬ºéª—æ”»å‡»?</p><ul><li>å¯ä»¥é€šè¿‡ç™»é™†åˆ°ç½‘å…³åœ°å€æ‰€åœ¨çš„æœºå™¨ä¸­ï¼ˆè·¯ç”±å™¨ï¼‰ä¸­ä¿®æ”¹é…ç½®ï¼Œå°†ipå’Œmacåœ°å€ç»‘å®šï¼Œç»‘å®šä¹‹åå°±ä¸ä¼šè®©arpæ”»å‡»è€…è‚†æ„æ›´æ”¹ç½‘å…³æ‰€åœ¨çš„arpè¡¨äº†ã€‚ç½‘ç»œè®¾å¤‡ä¾‹å¦‚äº¤æ¢æœºæœ‰ä¸€ç§å«åšåŠ¨æ€ARPé˜²å¾¡çš„æŠ€æœ¯å«åšDAIï¼Œäº¤æ¢æœºä¼šç»´æŠ¤ä¸€å¼ ip-mac-portçš„è¡¨ï¼Œå¦‚æœåœ¨arpè¯¢é—®è¿‡ç¨‹ä¸­å‡ºç°æœ‰å†²çªçš„å°±ä¼šä¸¢å¼ƒã€‚</li><li>å¯¹äºå®¢æˆ·æœºï¼Œå¯ä»¥åœ¨æœ¬åœ°è®°å½•mac-ipçš„å¯¹åº”å…³ç³»è¡¨ï¼Œå½“å‡ºç°æ¬ºéª—çš„æ—¶å€™åŠæ—¶å‘ç°å¹¶ä¸”ä¸¢å¼ƒã€‚è¿™æ–¹é¢å¯ä»¥ä½¿ç”¨ä¸€äº›è½¯ä»¶è¾…åŠ©ç”µè„‘ä¾‹å¦‚è…¾è®¯ç®¡å®¶ã€360ã€‚</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://segmentfault.com/a/1190000009562333" target="_blank" rel="noopener">å±€åŸŸç½‘ ARP æ¬ºéª—åŸç†è¯¦è§£</a></li><li><a href="https://www.anquanke.com/post/id/151762" target="_blank" rel="noopener">æµ…è°ˆArpæ”»å‡»å’Œåˆ©ç”¨Arpæ¬ºéª—è¿›è¡ŒMITM</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹&quot;&gt;&lt;a href=&quot;#ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹&quot; class=&quot;headerlink&quot; title=&quot;ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹&quot;&gt;&lt;/a&gt;ARPçš„åŸç†ä¸åŸºæœ¬æµç¨‹&lt;/h2&gt;&lt;p&gt;åœ¨å±€åŸŸç½‘ç¯å¢ƒä¸‹ï¼Œä¸»æœºä¹‹é—´æ˜¯é€šè¿‡ARPåè®®è·å–å¯¹åº”æœºå™¨çš„MACåœ°å€çš„ï¼Œ
      
    
    </summary>
    
    
      <category term="Linux" scheme="https://banbanpeppa.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>MACç»ˆç«¯ç¥å™¨iterm2</title>
    <link href="https://banbanpeppa.github.io/2019/07/20/essay/ohmyzsh/"/>
    <id>https://banbanpeppa.github.io/2019/07/20/essay/ohmyzsh/</id>
    <published>2019-07-20T04:00:00.000Z</published>
    <updated>2019-10-11T11:39:45.109Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MACç»ˆç«¯ç¥å™¨iterm2â€”â€”å‘Šåˆ«é»‘ç™½"><a href="#MACç»ˆç«¯ç¥å™¨iterm2â€”â€”å‘Šåˆ«é»‘ç™½" class="headerlink" title="MACç»ˆç«¯ç¥å™¨iterm2â€”â€”å‘Šåˆ«é»‘ç™½"></a>MACç»ˆç«¯ç¥å™¨iterm2â€”â€”å‘Šåˆ«é»‘ç™½</h1><blockquote><p>è½¬è½½ï¼š<a href="https://www.cnblogs.com/soyxiaobi/p/9695931.html" target="_blank" rel="noopener">https://www.cnblogs.com/soyxiaobi/p/9695931.html</a></p></blockquote><h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ:"></a>æœ€ç»ˆæ•ˆæœ:</h2><p><img src="/images/essay/ohmyzsh.png" alt="image"></p><h2 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h2><p><strong>1. ä¸‹è½½iTerm2</strong></p><p>å®˜ç½‘ä¸‹è½½ï¼š<a href="https://www.iterm2.com/" target="_blank" rel="noopener">https://www.iterm2.com/</a></p><p>å®‰è£…å®Œæˆåï¼Œåœ¨/binç›®å½•ä¸‹ä¼šå¤šå‡ºä¸€ä¸ªzshçš„æ–‡ä»¶ã€‚</p><p>Macç³»ç»Ÿé»˜è®¤ä½¿ç”¨dashä½œä¸ºç»ˆç«¯ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ä¿®æ”¹é»˜è®¤ä½¿ç”¨zshï¼š</p><pre><code>chsh -s /bin/zsh</code></pre><blockquote><p>zshå®Œç¾ä»£æ›¿bash,å…·ä½“åŒºåˆ«å¯æŸ¥çœ‹:<a href="https://www.xshell.net/shell/bash_zsh.html" target="_blank" rel="noopener">ã€ŠZshå’ŒBashåŒºåˆ«ã€‹</a></p></blockquote><p><strong>iterm2çš„åŸå§‹ç•Œé¢</strong></p><p><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/1.png" alt="image"></p><p><strong>2. æ›¿æ¢èƒŒæ™¯å›¾ç‰‡</strong></p><p>æ‰“å¼€è·¯å¾„:iterm2 -&gt; Preferences -&gt; Profiles -&gt; window -&gt; Background Image</p><p>é€‰æ‹©ä¸€å¼ è‡ªå·±å–œæ¬¢çš„å£çº¸å³å¯</p><p>å¯ä»¥é€šè¿‡Blendingè°ƒèŠ‚å£çº¸çš„é€æ˜åº¦: é€æ˜åº¦ä¸º0çš„æ—¶å€™,èƒŒæ™¯å˜ä¸ºçº¯è‰²(é»‘è‰²)</p><p>æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢æ‰å¹³åŒ–çš„å£çº¸,å–œæ¬¢çš„æœ‹å‹å¯ä»¥æ¥è¿™é‡Œçœ‹çœ‹:<br><a href="https://www.zhihu.com/question/37811449" target="_blank" rel="noopener">ã€Šæœ‰å“ªäº›ä¼˜é›…çš„ Windows 10 å£çº¸ï¼Ÿã€‹</a></p><p><strong>3. å®‰è£…Oh my zsh</strong></p><p>zshçš„åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œåªæ˜¯é…ç½®è¿‡äºå¤æ‚,é€šè¿‡<em>Oh my zsh</em>å¯ä»¥å¾ˆå¿«é…ç½®zshã€‚</p><p>è¿™é‡Œåªåšç®€å•çš„é…ç½®,å¦‚éœ€è¦æ·±å…¥äº†è§£,å¯ä»¥æŸ¥çœ‹:<a href="https://www.jianshu.com/p/d194d29e488c?open_source=weibo_search" target="_blank" rel="noopener">ã€Šoh-my-zsh,è®©ä½ çš„ç»ˆç«¯ä»æœªè¿™ä¹ˆçˆ½è¿‡ã€‹</a></p><p>å®‰è£…æ–¹æ³•æœ‰ä¸¤ç§ï¼Œå¯ä»¥ä½¿ç”¨curlæˆ–wgetï¼Œçœ‹è‡ªå·±ç¯å¢ƒæˆ–å–œå¥½ï¼š</p><pre><code># curl å®‰è£…æ–¹å¼sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</code></pre><pre><code># wget å®‰è£…æ–¹å¼sh -c &quot;$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)&quot;oh-my-zshå¼€æºåœ°å€ï¼šã€Šoh-my-zshã€‹</code></pre><p><strong>4. å®‰è£…PowerLine</strong></p><p>å®‰è£…powerline:</p><pre><code>pip install powerline-status --user</code></pre><p><strong>5. å®‰è£…PowerFonts</strong></p><p>åœ¨å¸¸ç”¨çš„ä½ç½®æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚ï¼š~/Desktop/OpenSource/</p><p>åœ¨OpenSourceæ–‡ä»¶å¤¹ä¸‹ä¸‹è½½PorweFonts:</p><pre><code># git clonegit clone https://github.com/powerline/fonts.git --depth=1# cd to foldercd fonts# run install shell./install.sh</code></pre><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š<br><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/6.png" alt="image"></p><p>å®‰è£…å¥½å­—ä½“åº“ä¹‹åï¼Œæˆ‘ä»¬æ¥è®¾ç½®iTerm2çš„å­—ä½“ï¼Œå…·ä½“çš„æ“ä½œæ˜¯:</p><pre><code>iTerm2 -&gt; Preferences -&gt; Profiles -&gt; Text</code></pre><p>åœ¨FontåŒºåŸŸé€‰ä¸­Change Fontï¼Œç„¶åæ‰¾åˆ°Meslo LGå­—ä½“ã€‚<br><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/7.png" alt="image"></p><p><strong>6. å®‰è£…é…è‰²æ–¹æ¡ˆ(å¯è·³è¿‡)</strong></p><p>åœ¨OpenSourceç›®å½•ä¸‹æ‰§è¡Œ<code>git clone</code>å‘½ä»¤:</p><pre><code>git clone https://github.com/altercation/solarizedcd solarized/iterm2-colors-solarized/open .</code></pre><p>åœ¨æ‰“å¼€çš„finderçª—å£ä¸­ï¼ŒåŒå‡»Solarized Dark.itermcolorså’ŒSolarized Light.itermcolorså³å¯å®‰è£…æ˜æš—ä¸¤ç§é…è‰²ï¼š<br><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/8.png" alt="image"></p><p>å†æ¬¡è¿›å…¥<code>iTerm2 -&gt; Preferences -&gt; Profiles -&gt; Colors -&gt; Color Presets</code>ä¸­æ ¹æ®ä¸ªäººå–œå¥½é€‰æ‹©.</p><p><strong>7. å®‰è£…ä¸»é¢˜</strong></p><p>åœ¨OpenSourceç›®å½•ä¸‹æ‰§è¡Œgit cloneå‘½ä»¤:</p><pre><code>git clone https://github.com/fcamblor/oh-my-zsh-agnoster-fcamblor.gitcd oh-my-zsh-agnoster-fcamblor/./install</code></pre><p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šå°†ä¸»é¢˜æ‹·è´åˆ°<code>oh my zsh</code>çš„themes.</p><p>æ‰§è¡Œå‘½ä»¤æ‰“å¼€<code>zshrc</code>é…ç½®æ–‡ä»¶ï¼Œå°†ZSH_THEMEåé¢çš„å­—æ®µæ”¹ä¸ºagnoster</p><pre><code>vi ~/.zshrc</code></pre><p><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/11.png" alt="image"></p><p>æ­¤æ—¶command+Qæˆ–sourceé…ç½®æ–‡ä»¶åï¼ŒiTerm2å˜äº†æ¨¡æ ·ï¼š<br><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/12.png" alt="image"></p><p><strong>8. å®‰è£…é«˜äº®æ’ä»¶</strong></p><p>è¿™æ˜¯oh my zshçš„ä¸€ä¸ªæ’ä»¶ï¼Œå®‰è£…æ–¹å¼ä¸themeå¤§åŒå°å¼‚ï¼š</p><pre><code>cd ~/.oh-my-zsh/custom/plugins/git clone https://github.com/zsh-users/zsh-syntax-highlighting.gitvi ~/.zshrc</code></pre><p>è¿™æ—¶æˆ‘ä»¬å†æ¬¡æ‰“å¼€zshrcæ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚æ‰¾åˆ°pluginsï¼Œæ­¤æ—¶pluginsä¸­åº”è¯¥å·²ç»æœ‰äº†gitï¼Œæˆ‘ä»¬éœ€è¦æŠŠé«˜äº®æ’ä»¶ä¹ŸåŠ ä¸Šï¼š<br><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/13.png" alt="image"></p><p>è¯·åŠ¡å¿…ä¿è¯æ’ä»¶é¡ºåºï¼Œzsh-syntax-highlightingå¿…é¡»åœ¨æœ€åä¸€ä¸ªã€‚</p><p>ç„¶ååœ¨æ–‡ä»¶çš„æœ€åä¸€è¡Œæ·»åŠ ï¼š</p><pre><code>source ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</code></pre><p>æ‰§è¡Œå‘½ä»¤ä½¿åˆšæ‰çš„ä¿®æ”¹ç”Ÿæ•ˆï¼š</p><pre><code>source ~/.zshrc</code></pre><p><strong>9. å¯é€‰æ‹©ã€å‘½ä»¤è¡¥å…¨</strong></p><p>è·Ÿä»£ç é«˜äº®çš„å®‰è£…æ–¹å¼ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªzshçš„æ’ä»¶ï¼Œå«åš<code>zsh-autosuggestion</code>ï¼Œç”¨äºå‘½ä»¤å»ºè®®å’Œè¡¥å…¨ã€‚</p><pre><code>cd ~/.oh-my-zsh/custom/plugins/git clone https://github.com/zsh-users/zsh-autosuggestionsvi ~/.zshrc</code></pre><p>æ‰¾åˆ°pluginsï¼ŒåŠ ä¸Šè¿™ä¸ªæ’ä»¶å³å¯ï¼š<br><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/15.png" alt="image"></p><p>æ’ä»¶æ•ˆæœï¼š<br><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/16.png" alt="image"></p><p>æœ‰åŒå­¦è¯´è¡¥å…¨å‘½ä»¤çš„å­—ä½“ä¸å¤ªæ¸…æ™°ï¼Œä¸èƒŒæ™¯é¢œè‰²å¤ªè¿‡ç›¸è¿‘ï¼Œå…¶å®å¯ä»¥è‡ªå·±è°ƒæ•´ä¸€ä¸‹å­—ä½“é¢œè‰²ã€‚</p><p><code>Preferences -&gt; Profiles -&gt; Colors</code>ä¸­æœ‰Foregroundæ˜¯æ ‡å‡†å­—ä½“é¢œè‰²ï¼ŒANSI Colorsä¸­Brightçš„ç¬¬ä¸€ä¸ªæ˜¯è¡¥å…¨çš„å­—ä½“é¢œè‰²ã€‚</p><h2 id="Logo"><a href="#Logo" class="headerlink" title="Logo"></a>Logo</h2><p>ä¸ºäº†èƒ½å¤Ÿç¾åŒ–ç»ˆç«¯ï¼Œé€šå¸¸ä¼šç»™è‡ªå·±çš„ç»ˆç«¯åŠ ä¸Šä¸€ä¸ªlogoï¼Œå¹¶ä¸”è¿™ä¸ªlogoè¿˜ä¼šæ‰“å°ä¸€äº›ç³»ç»Ÿçš„åŸºæœ¬ä¿¡æ¯ã€‚æ•ˆæœå¦‚ä¸‹<br><img src="/images/essay/app_zsh_logo.png" alt="image"></p><p>ä»¥ä¸‹ä»‹ç»å‡ ç§ç»ˆç«¯Logo</p><ul><li>screenfetch</li><li>neofetch</li><li>archey</li></ul><p>å®‰è£…æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥æ‰§è¡Œ</p><pre><code>brew install screenfetch neofetch archey</code></pre><p>å®‰è£…å¥½ä¹‹ååˆ†åˆ«æ‰§è¡Œ</p><pre><code>chenzhiling@banban:blog master âœ— 10d â–² â–³ â—’ âœ screenfetch                                                -/+:.          chenzhiling@banban                :++++.          OS: 64bit Mac OS X 10.14 18A391               /+++/.           Kernel: x86_64 Darwin 18.0.0       .:-::- .+/:-``.::-       Uptime: 24d 6h 20m    .:/++++++/::::/++++++/:`    Packages: 171  .:///////////////////////:`   Shell: zsh 5.3  ////////////////////////`     Resolution: 2560x1600 ,1920x1080  -+++++++++++++++++++++++`      DE: Aqua /++++++++++++++++++++++/       WM: Quartz Compositor /sssssssssssssssssssssss.      WM Theme: Blue :ssssssssssssssssssssssss-     Disk: 128G / 251G (53%)  osssssssssssssssssssssssso/`  CPU: Intel Core i5-8259U @ 2.30GHz  `syyyyyyyyyyyyyyyyyyyyyyyy+`  GPU: Intel Iris Plus Graphics 655    `ossssssssssssssssssssss/    RAM: 4622MiB / 8192MiB     :ooooooooooooooooooo+.          `:+oo+/:-..-:/+o+/-                             </code></pre><p>neofetch</p><pre><code class="bash">chenzhiling@banban:blog master âœ— 10d â–² â–³ â—’ âœ neofetch                         &#39;c.          chenzhiling@banban                  ,xNMM.          ------------------                .OMMMMo           OS: macOS Mojave 10.14 18A391 x86_64                OMMM0,            Host: MacBookPro15,2      .;loddo:&#39; loolloddol;.      Kernel: 18.0.0    cKMMMMMMMMMMNWMMMMMMMMMM0:    Uptime: 24 days, 6 hours, 21 mins  .KMMMMMMMMMMMMMMMMMMMMMMMWd.    Packages: 103 (brew)  XMMMMMMMMMMMMMMMMMMMMMMMX.      Shell: zsh 5.3 ;MMMMMMMMMMMMMMMMMMMMMMMM:       Resolution: 1440x900@2x, 1920x1080@2x :MMMMMMMMMMMMMMMMMMMMMMMM:       DE: Aqua .MMMMMMMMMMMMMMMMMMMMMMMMX.      WM: Quartz Compositor  kMMMMMMMMMMMMMMMMMMMMMMMMWd.    WM Theme: Blue (Light)  .XMMMMMMMMMMMMMMMMMMMMMMMMMMk   Terminal: vscode   .XMMMMMMMMMMMMMMMMMMMMMMMMK.   CPU: Intel i5-8259U (8) @ 2.30GHz     kMMMMMMMMMMMMMMMMMMMMMMd     GPU: Intel Iris Plus Graphics 655      ;KMMMMMMMWXXWMMMMMMMk.      Memory: 6238MiB / 8192MiB        .cooc,.    .,coo:.</code></pre><p>archey</p><pre><code class="bash">chenzhiling@banban:blog master âœ— 10d â–² â–³ â—’ âœ archey                 ###                  User: chenzhiling               ####                   Hostname: banban               ###                    Distro: OS X 10.14       #######    #######             Kernel: Darwin     ######################           Uptime: 24 days    #####################             Shell: /bin/zsh    ####################              Terminal: xterm-256color vscode    ####################              CPU: Intel Core i5-8259U CPU @ 2.30GHz    #####################             Memory: 8 GB     ######################           Disk: 53%      ####################            Battery: 100%        ################              IP Address: 218.107.55.252         ####     #####               </code></pre><p>åŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥åœ¨Linuxç³»ç»Ÿä¸Šå®‰è£…ä¸Šé¢å‡ ç§Logoï¼Œæ•ˆæœå¦‚ä¸‹<br><img src="/images/essay/debian_bash_log.png" alt="image"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://github.com/sirius1024/iterm2-with-oh-my-zsh" target="_blank" rel="noopener">ã€ŠiTerm2 + Oh My Zsh æ‰“é€ èˆ’é€‚ç»ˆç«¯ä½“éªŒã€‹</a></li><li><a href="https://github.com/robbyrussell/oh-my-zsh/wiki/themes" target="_blank" rel="noopener">ä¸»é¢˜åˆ—è¡¨</a></li><li><a href="https://fossbytes.com/linux-distribution-logo-ascii-art-terminal/" target="_blank" rel="noopener">4 Best Tools To Display Linux Distribution Logo Art In Terminal</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;MACç»ˆç«¯ç¥å™¨iterm2â€”â€”å‘Šåˆ«é»‘ç™½&quot;&gt;&lt;a href=&quot;#MACç»ˆç«¯ç¥å™¨iterm2â€”â€”å‘Šåˆ«é»‘ç™½&quot; class=&quot;headerlink&quot; title=&quot;MACç»ˆç«¯ç¥å™¨iterm2â€”â€”å‘Šåˆ«é»‘ç™½&quot;&gt;&lt;/a&gt;MACç»ˆç«¯ç¥å™¨iterm2â€”â€”å‘Šåˆ«é»‘ç™½&lt;/h1&gt;&lt;bloc
      
    
    </summary>
    
    
      <category term="éšç¬”" scheme="https://banbanpeppa.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>Spring-Boot + Spring Security + Thymeleaf</title>
    <link href="https://banbanpeppa.github.io/2019/05/05/java/spring/spring-boot-security-thymeleaf/"/>
    <id>https://banbanpeppa.github.io/2019/05/05/java/spring/spring-boot-security-thymeleaf/</id>
    <published>2019-05-05T08:56:00.000Z</published>
    <updated>2019-05-05T10:54:42.969Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Boot-Spring-Security-Thymeleaf"><a href="#Spring-Boot-Spring-Security-Thymeleaf" class="headerlink" title="Spring-Boot + Spring Security + Thymeleaf"></a>Spring-Boot + Spring Security + Thymeleaf</h1><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.mkyong.com/spring-boot/spring-boot-spring-security-thymeleaf-example/" target="_blank" rel="noopener">Spring Boot + Spring Security + Thymeleaf example</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Spring-Boot-Spring-Security-Thymeleaf&quot;&gt;&lt;a href=&quot;#Spring-Boot-Spring-Security-Thymeleaf&quot; class=&quot;headerlink&quot; title=&quot;Spring-Boot + Spri
      
    
    </summary>
    
    
      <category term="Java" scheme="https://banbanpeppa.github.io/tags/Java/"/>
    
      <category term="Spring Boot" scheme="https://banbanpeppa.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>Spring-Boot + Spring Security + Oauth2</title>
    <link href="https://banbanpeppa.github.io/2019/05/05/java/spring/spring-boot-security-oauth2/"/>
    <id>https://banbanpeppa.github.io/2019/05/05/java/spring/spring-boot-security-oauth2/</id>
    <published>2019-05-05T08:56:00.000Z</published>
    <updated>2019-05-15T11:03:17.992Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Boot2-0-Spring-Security-Oauth2"><a href="#Spring-Boot2-0-Spring-Security-Oauth2" class="headerlink" title="Spring-Boot2.0 + Spring Security + Oauth2"></a>Spring-Boot2.0 + Spring Security + Oauth2</h1><p>å¦‚æœå¯¹Spring Securityå’ŒOauth2æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡ç¬¬1ã€2éƒ¨åˆ†ï¼Œç›´æ¥åˆ°ç¬¬ä¸‰éƒ¨åˆ†ã€‚</p><h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><p>Spring Securityæ˜¯ä¸€ä¸ªå¼ºå¤§çš„é«˜åº¦å¯å®šåˆ¶åŒ–çš„èº«ä»½è®¤è¯ä¸è®¿é—®æ§åˆ¶æ¡†æ¶ï¼Œå®ƒç”¨äºä¸ºSpringæ¡†æ¶å¼€å‘çš„åº”ç”¨æä¾›æ ‡å‡†çš„å®‰å…¨ä¿éšœã€‚Spring Securityè¿™ä¸ªæ¡†æ¶ä¸“æ³¨äºä¸ºåº”ç”¨æä¾›æˆæƒå’Œè®¤è¯æœåŠ¡ï¼Œå®ƒçš„å¼ºå¤§åœ¨äºç”¨æˆ·å¯ä»¥éå¸¸çµæ´»åœ°è‡ªå®šä¹‰æƒé™è®¿é—®ã€‚</p><p>Spring Securityçš„ç‰¹æ€§</p><ul><li>å…¨é¢å¯æ‰©å±•åœ°æ”¯æŒäº†è®¤è¯å’Œæˆæƒ</li><li>å¯¹æŠ—Sessionå›ºå®šæ”»å‡»ã€ç‚¹å‡»åŠ«æŒã€ä¼ªè£…è·¨ç«™è®¿é—®ç­‰</li><li>æ•´åˆServlet API</li><li>å¯è‡ªç”±é€‰æ‹©æ˜¯å¦ä¸Spring MVCé›†æˆ</li></ul><h2 id="Oauth2-0"><a href="#Oauth2-0" class="headerlink" title="Oauth2.0"></a>Oauth2.0</h2><p>Oauth2å¾ˆæ˜¾ç„¶æ˜¯Oauthåè®®çš„ç‰ˆæœ¬2ï¼ŒOauthä¹Ÿå¯ä»¥ç§°ä¸ºæ˜¯æ¡†æ¶ï¼Œå…¶å…è®¸ç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹çš„åº”ç”¨æ¥å…¥åˆ°æŸä¸€ä¸ªåº”ç”¨ä¸­è®¿é—®è‡ªå·±çš„ä¿¡æ¯ï¼Œå¹¶æˆæƒä¸€å®šçš„HTTPæœåŠ¡è®¿é—®èƒ½åŠ›ï¼Œè€Œä¸éœ€è¦å°†è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹åº”ç”¨æˆ–è€…åˆ†äº«ä»–ä»¬æ•°æ®çš„å…¨éƒ¨å†…å®¹ã€‚Oauth2åˆ™æ˜¯Oauthçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œå…¶ç®€åŒ–äº†Oauthçš„ä¸€äº›æœºåˆ¶ï¼Œè®©ä¸åŒåº”ç”¨ä¹‹é—´çš„äº¤äº’æ›´åŠ å®‰å…¨æ–¹ä¾¿ã€‚Oauth2.0ä¸»è¦å…³æ³¨å®¢æˆ·ç«¯å¼€å‘è€…çš„ç®€æ˜“æ€§ï¼Œè¦ä¹ˆé€šè¿‡ç»„ç»‡åœ¨èµ„æºæ‹¥æœ‰è€…å’ŒHTTPæœåŠ¡å•†ä¹‹é—´çš„è¢«æ‰¹å‡†çš„äº¤äº’åŠ¨ä½œä»£è¡¨ç”¨æˆ·ï¼Œè¦ä¹ˆå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ä»£è¡¨ç”¨æˆ·è·å¾—è®¿é—®çš„æƒé™ã€‚</p><p>Oauth2ç›®å‰æ¥è¯´åœ¨å„ä¸ªå‚å•†çš„å„å¤§åº”ç”¨ä¸­è·å¾—äº†æ¯”è¾ƒå¥½çš„æ•ˆæœï¼Œä¾‹å¦‚Googleå’ŒFacebookã€‚</p><h3 id="Roles"><a href="#Roles" class="headerlink" title="Roles"></a>Roles</h3><p>Oauth2åŒ…å«äº†4ä¸ªè§’è‰²</p><ul><li>Resource Owner: èµ„æºæ‹¥æœ‰è€…ï¼Œé€šå¸¸å°±æ˜¯ç”¨æˆ·ä½ è‡ªå·±ï¼›</li><li>Resource Server: é‚£äº›ä¿ç®¡äº†ä½ ä¸ªäººèµ„æºä¿¡æ¯çš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚Googleä¼šç®¡ç†ä½ çš„ä¸ªäººèµ„æ–™å’Œä¿¡æ¯ï¼›</li><li>Client: éœ€è¦è®¿é—®Resource Serverçš„é‚£äº›åº”ç”¨ï¼Œä¾‹å¦‚å¯ä»¥æ˜¯ä¸€ä¸ªPHPç½‘ç«™ã€å®‰å“å®¢æˆ·ç«¯ã€æˆ–è€…JavaScriptåº”ç”¨ç­‰ï¼›</li><li>Authorization Server: ä¸ºClientåº”ç”¨æä¾›è®¿é—®tokençš„æœåŠ¡è€…ï¼Œè¿™äº›tokenä¼šç”¨äºClientè®¿é—®Resource Serverä¸­å¯¹åº”ç”¨æˆ·çš„èµ„æºä¿¡æ¯ã€‚è®¤è¯æœåŠ¡é€šå¸¸ä¼šå’Œèµ„æºæœåŠ¡(Resource Server)éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œåªæ˜¯è§’è‰²åˆ†å¼€ã€‚</li></ul><h3 id="Tokens"><a href="#Tokens" class="headerlink" title="Tokens"></a>Tokens</h3><p>Tokens æ˜¯ä¸€ç³»åˆ—ç”±è®¤è¯æœåŠ¡å™¨ç”Ÿæˆçš„éšæœºå­—ç¬¦ï¼Œæ¯å½“å®¢æˆ·ç«¯è¯·æ±‚è·å–å¯¹åº”çš„ç”¨æˆ·çš„tokenæ—¶è®¤è¯æœåŠ¡å™¨ä¼šä¸‹å‘å¯¹åº”çš„Tokenç»™å®¢æˆ·ç«¯ï¼Œé€šå¸¸åˆä¸¤ç§Tokenç±»å‹</p><ul><li>Access Token: è¿™ç§Tokenæ˜¯æœ€å¸¸ç”¨çš„Tokenï¼Œç¬¬ä¸‰æ–¹ç”¨æˆ·é€šå¸¸éƒ½æ˜¯ç”¨è¿™ä¸ªTokenä½œä¸ºè‡ªå·±è®¿é—®ç”¨æˆ·èµ„æºçš„é’¥åŒ™ï¼Œé€šå¸¸Clientå®¢æˆ·ç«¯ä¼šå°†è¿™ä¸ªTokenè¿½åŠ åˆ°è¯·æ±‚çš„å‚æ•°ä¸­æˆ–è€…æ·»åŠ åˆ°è¯·æ±‚çš„Headerä¸­æ¥è¯·æ±‚èµ„æºæœåŠ¡å™¨ï¼Œè¿™ç§Tokené€šå¸¸ä¼šæœ‰ä¸€å®šçš„æ—¶æ•ˆï¼Œèµ„æºæœåŠ¡å™¨ä¼šè®¾ç½®è¿™ä¸ªæ—¶æ•ˆï¼Œä¸€æ—¦è¿‡æœŸäº†å¯¹åº”çš„Tokenå°†ä¸å†å¯ç”¨ï¼Œå®¢æˆ·ç«¯å¿…é¡»é‡æ–°è·å–æ–°çš„Tokenè¿›è¡Œèµ„æºè®¿é—®ã€‚</li><li>Refresh Token: åˆ·æ–°Tokenæ˜¯ç›¸å¯¹äºAccess Tokenè€Œæå‡ºçš„ï¼Œç”±äºAccess Tokenä¸€èˆ¬éƒ½ä¼šæœ‰æ—¶æ•ˆï¼Œé‚£ä¹ˆå½“æŸä¸€ä¸ªAccess Tokenä¸å¯ç”¨çš„æ—¶å€™ä¾¿å¯ä»¥ç”¨åˆ·æ–°Tokenè·å–ä¸€ä¸ªæ–°çš„Access Tokenã€‚ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå®¢æˆ·ç«¯å¹¶ä¸æ˜¯æ€»èƒ½è·å–å¾—åˆ°è¿™ä¸ªåˆ·æ–°Tokençš„ã€‚</li></ul><h3 id="Access-token-scope"><a href="#Access-token-scope" class="headerlink" title="Access token scope"></a>Access token scope</h3><p>scopeæ˜¯ä¸€ä¸ªå¯¹å®¢æˆ·ç«¯è®¿é—®èµ„æºçš„æƒé™é™åˆ¶çš„å‚æ•°ï¼ŒæˆæƒæœåŠ¡å™¨Authorization Serverä¼šå®šä¹‰ä¸€ä¸ªscopeåˆ—è¡¨ï¼Œå®¢æˆ·ç«¯åœ¨è¯·æ±‚è·å–Tokençš„æ—¶å€™éœ€è¦å°†scopeä½œä¸ºä¸€ä¸ªå‚æ•°æäº¤ï¼Œè¿™ä¸ªscopeå‚æ•°çš„å†…å®¹è¶Šå¤šï¼Œé‚£ä¹ˆè·å¾—çš„èµ„æºè®¿é—®èƒ½åŠ›å°±è¶Šå¤šï¼Œè¿™ä¸ªé€šå¸¸éƒ½æ˜¯ç”¨æˆ·æˆæƒç»™å®¢æˆ·ç«¯çš„ã€‚</p><h3 id="Register-as-a-Client"><a href="#Register-as-a-Client" class="headerlink" title="Register as a Client"></a>Register as a Client</h3><p>ç”±äºå®¢æˆ·ç«¯æƒ³è¦é€šè¿‡Oauth2æ¥è·å¾—èµ„æºæœåŠ¡å™¨ä¸­ç”¨æˆ·çš„èµ„æºå†…å®¹ï¼Œå› æ­¤å®¢æˆ·ç«¯éœ€è¦å‘è®¤è¯æœåŠ¡å™¨æ³¨å†Œä¸€ä¸ªclientï¼Œæ³¨å†Œclientçš„å‚æ•°åŒ…å«å¦‚ä¸‹å‡ ä¸ª</p><ul><li>Application Name: åº”ç”¨çš„åç§°</li><li>Redirect URLs: è®¤è¯ç å’ŒAccess Tokenæ‰€å¯¹åº”clientçš„URLs</li><li>Grant Type(s): æˆæƒçš„ç±»å‹ï¼Œä¸€èˆ¬æœ‰å››ç§</li><li>JavaScript Origin(optional): è®¾ç½®è¢«å…è®¸è®¿é—®èµ„æºæœåŠ¡å™¨çš„ä¸»æœºå</li></ul><p>èµ„æºæœåŠ¡å™¨æ”¶åˆ°clientçš„æ³¨å†Œå†…å®¹ä¹‹åè¿”å›çš„å†…å®¹å¦‚ä¸‹</p><ul><li>Client Id: ä¸€ä¸ªå”¯ä¸€çš„éšæœºå­—ç¬¦</li><li>Client Secret: éœ€è¦ç§˜å¯†ä¿ç®¡å¥½çš„å®¢æˆ·ç«¯å¯†ç </li></ul><h3 id="Authorization-grant-types"><a href="#Authorization-grant-types" class="headerlink" title="Authorization grant types"></a>Authorization grant types</h3><p>Oauth2å®šä¹‰äº†4ä¸­æˆæƒç±»å‹ï¼Œè¿™4ä¸­æˆæƒç±»å‹éœ€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯è¿›è¡Œä½¿ç”¨ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»</p><h4 id="Authorization-Code-Grant"><a href="#Authorization-Code-Grant" class="headerlink" title="Authorization Code Grant"></a>Authorization Code Grant</h4><p>æˆæƒç é€‚åˆåœ¨Clientæ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹å¼å…è®¸webä¿æŒä¸€ä¸ªé•¿æ—¶é—´çš„Access Tokenå› ä¸ºå¯ä»¥é€šè¿‡refresh Tokenæ¥åˆ·æ–°æœåŠ¡å™¨(åªè¦æˆæƒæœåŠ¡å™¨å…è®¸è¿™ç§è¡Œä¸º)ã€‚</p><p>ä¾‹å­</p><ul><li>èµ„æºæ‹¥æœ‰è€…: ç”¨æˆ·</li><li>Resource Server: Google æœåŠ¡å™¨</li><li>Client: ä»»ä½•ä¸€ä¸ªç½‘ç«™</li><li>Authorization Server: Googleçš„è®¤è¯æœåŠ¡å™¨</li></ul><p>åœºæ™¯</p><ul><li>å½“ä¸€ä¸ªç½‘ç«™æƒ³è¦è·å–ç”¨æˆ·çš„Googleä¸ªäººä¿¡æ¯</li><li>è¿™ä¸ªç½‘ç«™ä¼šé‡å®šå‘åˆ°Googleçš„è®¤è¯æœåŠ¡å™¨</li><li>å¦‚æœä½ æˆæƒé€šè¿‡äº†è¿™ä¸ªè®¿é—®ï¼Œè®¤è¯æœåŠ¡å™¨ä¼šç»™ç½‘ç«™å›è°ƒå‘é€ä¸€ä¸ªè®¤è¯ç </li><li>ä¹‹åå®¢æˆ·ç«¯ç½‘ç«™ä¾¿å’Œè®¤çœŸæœåŠ¡å™¨é€šè¿‡è®¤è¯ç æ¥è·å–Access Token</li><li>ä¹‹åç½‘ç«™ä¾¿å¯ä»¥è·å–åˆ°ç”¨æˆ·åœ¨Googleä¸Šé¢çš„ä¸ªäººèµ„æºä¿¡æ¯</li></ul><p>ç”¨æˆ·åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šçœ‹åˆ°Access Tokenï¼Œç½‘ç«™ä¼šè‡ªè¡Œå­˜å‚¨è¿™ä¸ªAccess Tokenï¼ŒGoogle è®¤è¯æœåŠ¡å™¨åœ¨ä¸‹å‘Access Tokençš„åŒäº‹ä¸€èˆ¬è¿˜ä¼šä¸‹å‘Refresh Token</p><p>æ—¶åºå›¾å¦‚ä¸‹<br><img src="/images/java/oauth/auth_code_flow.png" alt="image"></p><h4 id="Implicit-Grant"><a href="#Implicit-Grant" class="headerlink" title="Implicit Grant"></a>Implicit Grant</h4><p>å½“ç½‘é¡µé€šè¿‡ä¸€äº›è„šæœ¬è¯­è¨€ä¾‹å¦‚JavaScriptä½œä¸ºClientå®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œè¿™ç§æƒ…å†µä¸å…è®¸è„šæœ¬è·å–åˆ°Refresh Tokenã€‚</p><p>ä¾‹å­</p><ul><li>Resource Owner: ç”¨æˆ·</li><li>Resource Server: Facebook æœåŠ¡å™¨</li><li>Client: ä½¿ç”¨AngularJSçš„ç½‘ç«™</li><li>Authorization Server: Facebook æœåŠ¡å™¨</li></ul><p>åœºæ™¯</p><ul><li>AngularJSå®¢æˆ·ç«¯æƒ³è¦è·å–ç”¨æˆ·çš„Facebookä¸ªäººä¿¡æ¯</li><li>ç”¨æˆ·ä¼šè¢«é‡å®šä½åˆ°Facebookçš„è®¤è¯æœåŠ¡å™¨</li><li>å¦‚æœç”¨æˆ·æˆæƒäº†è®¿é—®ï¼Œè®¤è¯æœåŠ¡å™¨ä¼šé‡å®šå‘åˆ°ç½‘ç«™ï¼Œå¹¶ä¸”åœ¨URIä¸­æºå¸¦Access Tokenï¼Œä¾‹å¦‚: <a href="http://example.com/oauthcallback#access_token=MzJmNDc3M2VjMmQzN" target="_blank" rel="noopener">http://example.com/oauthcallback#access_token=MzJmNDc3M2VjMmQzN</a></li><li>è¿™ä¸ªAccess Tokenå¯ä»¥ç”¨äºå®¢æˆ·ç«¯è¯·æ±‚Facebookçš„èµ„æºï¼Œä¾‹å¦‚: <a href="https://graph.facebook.com/me?access_token=MzJmNDc3M2VjMmQzN" target="_blank" rel="noopener">https://graph.facebook.com/me?access_token=MzJmNDc3M2VjMmQzN</a>.</li></ul><p>ä¹Ÿè®¸ä½ ä¼šå¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆFacebookå…è®¸å®¢æˆ·ç«¯ç›´æ¥é€šè¿‡æ·»åŠ Access Tokenè€Œä¸ä¼šè¢«è·¨åŸŸè§„åˆ™æ‰€æ‹¦æˆªä¸‹æ¥ã€‚è¿™æ˜¯å¯èƒ½çš„ä¹Ÿæ˜¯å…è®¸çš„ï¼Œå› ä¸ºæœ‰CORS(Access-Control-Allow-Origin)çš„å¸®åŠ©ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#The_HTTP_response_headers" target="_blank" rel="noopener">Access-Control-Allow-Origin</a></p><blockquote><p>Attention! This type of authorization should only be used if no other type of authorization is available. Indeed, it is the least secure because the access token is exposed (and therefore vulnerable) on the client side.</p></blockquote><p>æ—¶åºå›¾å¦‚ä¸‹<br><img src="/images/java/oauth/implicit_flow.png" alt="images"></p><h4 id="Resource-Owner-Password-Credentials-Grant"><a href="#Resource-Owner-Password-Credentials-Grant" class="headerlink" title="Resource Owner Password Credentials Grant"></a>Resource Owner Password Credentials Grant</h4><p>è¿™ç§è®¤è¯æ–¹å¼æ¯”è¾ƒç‰¹åˆ«ï¼Œè®¤è¯çš„ä¿¡æ¯(ä¹Ÿå°±æ˜¯å¯†ç )æ˜¯å…ˆä¼ ç»™å®¢æˆ·ç«¯ç½‘ç«™ï¼Œå®¢æˆ·ç«¯ç½‘ç«™æ‹¿ç€å¯†ç å»å’Œè®¤è¯æœåŠ¡å™¨é€šè®¯è·å¾—å¯¹åº”çš„Access Tokenï¼Œå› æ­¤è¯´è¿™ä¸¤ä¸ªåº”ç”¨éƒ½éœ€è¦æœ‰åŒç­‰çš„ä¿¡ä»»å…³ç³»ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´è¿™ç§æ–¹å¼ç”¨äºä¸¤ä¸ªåº”ç”¨å±äºåŒä¸€ä¸ªå•ä½æˆ–è€…ä¼ä¸šçš„åº”ç”¨ä¹‹é—´ä½¿ç”¨ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªç½‘ç«™å±äº<code>example.com</code>ï¼Œç°åœ¨å®ƒéœ€è¦æˆæƒè®¿é—®<code>api.example.com</code>ä¸‹é¢æ‰€ä¿æŠ¤çš„èµ„æºï¼Œé‚£ä¹ˆç”¨æˆ·è‡ªç„¶ä¼šæ„¿æ„å°†è‡ªå·±çš„å¯†ç æˆæƒç»™å®¢æˆ·ç«¯ç½‘ç«™ï¼Œå› ä¸ºä»–çš„è´¦å·å¯†ç å°±æ˜¯ä»<code>example.com</code>æ‰€è·å¾—çš„ã€‚</p><p>ä¾‹å­</p><ul><li>Resource Owner: ç”¨æˆ·åœ¨<code>acme.com</code>ç½‘ç«™(å±äºAcmeå…¬å¸)æ³¨å†Œäº†è´¦å·</li><li>Resource Server: Acmeå…¬å¸åœ¨<code>api.acme.com</code>æš´éœ² API</li><li>Client: Acmeå…¬å¸ä¸‹çš„<code>acme.com</code>ç½‘ç«™</li><li>Authorization Server: Acmeçš„è®¤è¯æœåŠ¡å™¨</li></ul><p>åœºæ™¯</p><ul><li>Acme å…¬å¸æƒ³å°†è‡ªå·±çš„REST APIæä¾›ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚</li><li>ä¸ºäº†é¿å…é‡å¤é€ è½®å­ï¼Œå…¬å¸è§‰å¾—ç”¨è‡ªå·±çš„APIä¼šå¾ˆæ–¹ä¾¿</li><li>å› æ­¤å…¬å¸éœ€è¦è·å¾—ä¸€ä¸ªAccess Tokenæ¥è®¿é—®å¯¹åº”çš„é‚£äº›API</li><li>ä¸ºæ­¤å…¬å¸çš„ç½‘ç«™è¦æ±‚ç”¨æˆ·ç™»å½•å¹¶æˆæƒREST APIç»™å…¶ä»–çš„åº”ç”¨</li><li>æœåŠ¡ç«¯åº”ç”¨ (acme.com) ä¼šå’Œè®¤è¯æœåŠ¡å™¨è¿›è¡Œäº¤äº’è·å¾—å¯¹åº”çš„Access Token</li><li>ä¹‹ååº”ç”¨ä¾¿å¯ä»¥ä½¿ç”¨Access Tokenè®¿é—®å¯¹åº”çš„èµ„æºäº†(api.acme.com).</li></ul><p>æ—¶åºå›¾<br><img src="/images/java/oauth/password.png" alt="images"></p><h4 id="Client-Credentials-Grant"><a href="#Client-Credentials-Grant" class="headerlink" title="Client Credentials Grant"></a>Client Credentials Grant</h4><p>å½“å®¢æˆ·ç«¯Clientè‡ªå·±æœ¬èº«å°±æ˜¯Resource Ownerï¼Œé‚£ä¹ˆæ„å‘³ç€ä¸ç”¨ç”¨æˆ·ä¸ºä¹‹æˆæƒã€‚</p><p>ä¾‹å­</p><ul><li>Resource Owner: ä»»æ„ä¸€ä¸ªç½‘ç«™</li><li>Resource Server: Google Cloud Storage</li><li>Client: åŒResource Owner</li><li>Authorization Server: è°·æ­Œçš„è®¤è¯æœåŠ¡å™¨</li></ul><p>åœºæ™¯</p><ul><li>ä¸€ä¸ªç½‘ç«™ä½¿ç”¨Googleçš„å­˜å‚¨æœåŠ¡ï¼Œå¹¶å­˜å‚¨äº†ä¸€ç³»åˆ—çš„æ–‡ä»¶</li><li>ç½‘ç«™å…ˆéœ€è¦è·å–æ–‡ä»¶å¹¶ä¸”ä¿®æ”¹æ–‡ä»¶ï¼Œåˆ™éœ€è¦å‘è°·æ­Œçš„è®¤è¯æœåŠ¡å™¨å‘èµ·è®¤è¯è¯·æ±‚</li><li>ä¸€æ—¦æˆæƒæˆåŠŸï¼Œç½‘ç«™ä¾¿å¯ä»¥è·å–åˆ°è‡ªå·±åœ¨Googleå­˜å‚¨ä¸Šé¢è‡ªå·±çš„èµ„æºå†…å®¹</li></ul><p>åœ¨è¿™é‡Œï¼Œç½‘ç«™çš„ä½¿ç”¨è€…å°±æ²¡æœ‰å¿…è¦ç»™ç½‘ç«™æˆæƒè‡ªå·±çš„èµ„æºå†…å®¹è®¿é—®æƒé™ç»™ç½‘ç«™ã€‚</p><p>æ—¶åºå›¾<br><img src="/images/java/oauth/client_credentials_flow.png" alt="images"></p><h2 id="é…ç½®Spring-Boot-Security-Oauth2"><a href="#é…ç½®Spring-Boot-Security-Oauth2" class="headerlink" title="é…ç½®Spring Boot + Security + Oauth2"></a>é…ç½®Spring Boot + Security + Oauth2</h2><p>æœ¬äººä½¿ç”¨çš„å¼€å‘å·¥å…·æ˜¯<a href="https://spring.io/tools" target="_blank" rel="noopener">Spring Tool Suite 4</a>ï¼Œæ„å»ºé¡¹ç›®çš„æ—¶å€™é€‰æ‹©ï¼šWebã€JPAã€Thymeleafã€Securityã€Oauth2 Resource Serverï¼Œå¦‚ä¸‹</p><p><img src="/images/java/spring-boot/sso.png" alt="image"></p><p>åˆ›å»ºå¥½é¡¹ç›®ä¹‹åï¼Œå¯¹åº”çš„<code>pom.xml</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;parent&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;        &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;    &lt;/parent&gt;    &lt;groupId&gt;org.scut.storic&lt;/groupId&gt;    &lt;artifactId&gt;storic-rest&lt;/artifactId&gt;    &lt;version&gt;1.0.0&lt;/version&gt;    &lt;name&gt;storic-rest&lt;/name&gt;    &lt;description&gt;manager for storest based on fabric&lt;/description&gt;    &lt;properties&gt;        &lt;java.version&gt;1.8&lt;/java.version&gt;        &lt;skipTests&gt;true&lt;/skipTests&gt;    &lt;/properties&gt;    &lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.security.oauth&lt;/groupId&gt;            &lt;artifactId&gt;spring-security-oauth2&lt;/artifactId&gt;            &lt;version&gt;2.3.3.RELEASE&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;            &lt;optional&gt;true&lt;/optional&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;            &lt;scope&gt;test&lt;/scope&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;            &lt;scope&gt;test&lt;/scope&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;mysql&lt;/groupId&gt;            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.jasypt&lt;/groupId&gt;            &lt;artifactId&gt;jasypt&lt;/artifactId&gt;            &lt;version&gt;1.9.2&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;            &lt;artifactId&gt;gson&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.google.guava&lt;/groupId&gt;            &lt;artifactId&gt;guava&lt;/artifactId&gt;            &lt;version&gt;24.0-jre&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;    &lt;build&gt;        &lt;plugins&gt;            &lt;plugin&gt;                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;            &lt;/plugin&gt;        &lt;/plugins&gt;    &lt;/build&gt;&lt;/project&gt;</code></pre><h2 id="é…ç½®Spring-Security"><a href="#é…ç½®Spring-Security" class="headerlink" title="é…ç½®Spring Security"></a>é…ç½®Spring Security</h2><p>é¦–å…ˆé…ç½®Spring Security</p><p>CustomSecurityConfiguration.java</p><pre><code>import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.security.authentication.AuthenticationManager;import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;import org.springframework.security.core.userdetails.UserDetailsService;import org.springframework.security.crypto.password.PasswordEncoder;@Configuration@EnableWebSecurity@EnableGlobalMethodSecurity(securedEnabled = true)public class CustomSecurityConfiguration extends WebSecurityConfigurerAdapter{    @Bean    @Override    protected UserDetailsService userDetailsService(){        //é‡‡ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„å®ç°UserDetailsServiceæ¥å£çš„ç±»        return new CustomUserDetailsService();    }    @Override    protected void configure(AuthenticationManagerBuilder auth) throws Exception {        auth.authenticationProvider(new NullAuthenticationProvider());        super.configure(auth);    }    /**     * Spring Boot 2 é…ç½®ï¼Œè¿™é‡Œè¦bean æ³¨å…¥     */    @Bean    @Override    public AuthenticationManager authenticationManagerBean() throws Exception {        AuthenticationManager manager = super.authenticationManagerBean();        return manager;    }    @Bean    public PasswordEncoder passwordEncoder() {        //return PasswordEncoderFactories.createDelegatingPasswordEncoder();        return new CustomPasswordEncoder();    }}</code></pre><p>CustomUserDetailsService.java</p><pre><code>import java.util.ArrayList;import java.util.List;import org.scut.storic.persistent.entity.Account;import org.scut.storic.persistent.repository.AccountRepository;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.core.GrantedAuthority;import org.springframework.security.core.authority.SimpleGrantedAuthority;import org.springframework.security.core.userdetails.UserDetails;import org.springframework.security.core.userdetails.UserDetailsService;import org.springframework.security.core.userdetails.UsernameNotFoundException;public class CustomUserDetailsService implements UserDetailsService {    private static final Logger logger = LoggerFactory.getLogger(CustomUserDetailsService.class);    @Autowired    private AccountRepository accountRepository;    @Override    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {        logger.info(&quot;Load UserDetails by username: &quot; + username);        Account account = accountRepository.findByName(username);        if (account == null)             throw new UsernameNotFoundException(username);        List&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();        for (String permission : account.getPermission().split(&quot; &quot;)) {            if (permission.isEmpty()) continue;            authorities.add(new SimpleGrantedAuthority(permission));        }        return new CustomUser(username, account.getPassword(), true, true, true, account.isVerified(), authorities);    }}</code></pre><p>å…¶ä¸­<code>AccountRepository</code>æ˜¯ä¸ºäº†ä»Mysqlæ•°æ®åº“ä¸­è·å–å¯¹åº”è´¦æˆ·çš„æƒé™å†…å®¹ï¼Œä¸å†è¯¦ç»†æè¿°ã€‚</p><p>CustomUser.java</p><pre><code>import java.util.Collection;import org.springframework.security.core.GrantedAuthority;import org.springframework.security.core.authority.SimpleGrantedAuthority;import org.springframework.security.core.userdetails.User;public class CustomUser extends User {    /**     *      */    private static final long serialVersionUID = 1527936124593374191L;    /**     * Construct the &lt;code&gt;User&lt;/code&gt; with the details required by     * {@link org.springframework.security.authentication.dao.DaoAuthenticationProvider}.     *     * @param username the username presented to the     * &lt;code&gt;DaoAuthenticationProvider&lt;/code&gt;     * @param password the password that should be presented to the     * &lt;code&gt;DaoAuthenticationProvider&lt;/code&gt;     * @param enabled set to &lt;code&gt;true&lt;/code&gt; if the user is enabled     * @param accountNonExpired set to &lt;code&gt;true&lt;/code&gt; if the account has not expired     * @param credentialsNonExpired set to &lt;code&gt;true&lt;/code&gt; if the credentials have not     * expired     * @param accountNonLocked set to &lt;code&gt;true&lt;/code&gt; if the account is not locked     * @param authorities the authorities that should be granted to the caller if they     * presented the correct username and password and the user is enabled. Not null.     *     * @throws IllegalArgumentException if a &lt;code&gt;null&lt;/code&gt; value was passed either as     * a parameter or as an element in the &lt;code&gt;GrantedAuthority&lt;/code&gt; collection     */    public CustomUser(String username, String password, boolean enabled, boolean accountNonExpired,            boolean credentialsNonExpired, boolean accountNonLocked,            Collection&lt;? extends GrantedAuthority&gt; authorities) {        super(username, password, enabled, accountNonExpired, credentialsNonExpired, accountNonLocked, authorities);    }    @Override    public boolean isCredentialsNonExpired() {        return super.isCredentialsNonExpired();    }    @Override    public boolean isAccountNonExpired() {        return super.isAccountNonExpired();    }    @Override    public boolean isAccountNonLocked() {        return super.isAccountNonLocked();    }    public boolean isManager() {        return this.getAuthorities()                .contains(new SimpleGrantedAuthority(&quot;ROLE_ADMIN&quot;));    }    public boolean isSystemManager() {        return this.getAuthorities()                .contains(new SimpleGrantedAuthority(&quot;ROLE_SYSTEM_ADMIN&quot;));    }}</code></pre><p>CustomPasswordEncoder.java</p><pre><code>import org.springframework.security.crypto.password.PasswordEncoder;public class CustomPasswordEncoder implements PasswordEncoder {    @Override    public String encode(CharSequence rawPassword) {        return PasswordHelper.encryptPassword(rawPassword.toString());    }    @Override    public boolean matches(CharSequence rawPassword, String encodedPassword) {        return PasswordHelper.checkPassword(rawPassword.toString(),                encodedPassword.toString());    }}</code></pre><p>PasswordHelper.java</p><pre><code>import java.util.HashMap;import java.util.Map;import org.jasypt.digest.StandardStringDigester;import org.jasypt.util.password.PasswordEncryptor;public class PasswordHelper {    public enum Type{        SHA256_BASE64(&quot;SHA-256&quot;, &quot;base64&quot;),        SHA256_HEX(&quot;SHA-256&quot;, &quot;hexadecimal&quot;),        MD5_BASE64(&quot;MD5&quot;, &quot;base64&quot;),        MD5_HEX(&quot;MD5&quot;, &quot;hexadecimal&quot;);        private String algorithm;        private String outputType;        private Type(String algorithm, String value) {            this.algorithm = algorithm;            this.outputType = value;        }        public String getAlgorithm() {            return algorithm;        }        public String getOutputType() {            return outputType;        }    }    private final static class MyPasswordEncryptor implements PasswordEncryptor {        private final StandardStringDigester digester;        public MyPasswordEncryptor(String algorithm) {            this.digester = new StandardStringDigester();            this.digester.setAlgorithm(algorithm);            this.digester.setIterations(1000);            this.digester.setSaltSizeBytes(8);        }        public void setStringOutputType(final String stringOutputType) {            this.digester.setStringOutputType(stringOutputType);        }        public String encryptPassword(final String password) {            return this.digester.digest(password);        }        public boolean checkPassword(final String plainPassword,                final String encryptedPassword) {            return this.digester.matches(plainPassword, encryptedPassword);        }    }    private static Map&lt;Type, MyPasswordEncryptor&gt; passwordEncryptors = new HashMap&lt;Type, MyPasswordEncryptor&gt;();    private PasswordHelper(){}    private static PasswordEncryptor getPasswordEncryptor(final Type type) {        if (passwordEncryptors.get(type) == null) {            synchronized (passwordEncryptors) {                if (passwordEncryptors.get(type) == null) {                    MyPasswordEncryptor passwordEncryptor = new MyPasswordEncryptor(type.getAlgorithm());                    passwordEncryptor.setStringOutputType(type.getOutputType());                    passwordEncryptors.put(type, passwordEncryptor);                }            }        }        return passwordEncryptors.get(type);    }    public static String encryptPassword(final String password) {        return getPasswordEncryptor(Type.SHA256_BASE64).encryptPassword(password);    }    public static String encryptPassword(final String password, final Type type) {        return getPasswordEncryptor(type).encryptPassword(password);    }    public static boolean checkPassword(final String plainPassword,            final String encryptedPassword) {        return getPasswordEncryptor(Type.SHA256_BASE64).checkPassword(plainPassword, encryptedPassword);    }    public static boolean checkPassword(final String plainPassword,            final String encryptedPassword, final Type type) {        return getPasswordEncryptor(type).checkPassword(plainPassword, encryptedPassword);    }}</code></pre><p>NullAuthenticationProvider.java</p><pre><code>import org.springframework.security.authentication.AuthenticationProvider;import org.springframework.security.core.Authentication;import org.springframework.security.core.AuthenticationException;public class NullAuthenticationProvider implements AuthenticationProvider {    @Override    public Authentication authenticate(Authentication authentication)            throws AuthenticationException {        return authentication;    }    @Override    public boolean supports(Class&lt;?&gt; authentication) {        return (NullAuthenticationToken.class.isAssignableFrom(authentication));    }}</code></pre><p>NullAuthenticationToken.java</p><pre><code>import org.springframework.security.authentication.AbstractAuthenticationToken;import org.springframework.security.core.userdetails.User;public class NullAuthenticationToken extends AbstractAuthenticationToken {    /**     *      */    private static final long serialVersionUID = 4544894451246623482L;    private final Object principal;    public NullAuthenticationToken(User principal) {        super(principal.getAuthorities());        this.principal = principal;        setAuthenticated(true);    }    @Override    public Object getCredentials() {        return null;    }    @Override    public Object getPrincipal() {        return principal;    }}</code></pre><h2 id="é…ç½®Oauth2"><a href="#é…ç½®Oauth2" class="headerlink" title="é…ç½®Oauth2"></a>é…ç½®Oauth2</h2><p>Oauth2éœ€è¦é…ç½®ä¸€ä¸‹ä¸‰é¡¹ï¼šAuthorizationServerã€ClientDetailsServiceã€ResourceServer</p><p>CustomAuthServerConfiguration.java</p><pre><code>import java.util.concurrent.TimeUnit;import org.scut.storic.utils.PasswordHelper;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Configuration;import org.springframework.http.HttpMethod;import org.springframework.security.authentication.AuthenticationManager;import org.springframework.security.core.userdetails.UserDetailsService;import org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer;import org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter;import org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer;import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer;import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer;import org.springframework.security.oauth2.provider.token.store.InMemoryTokenStore;@Configuration@EnableAuthorizationServerpublic class CustomAuthServerConfiguration extends AuthorizationServerConfigurerAdapter {    @Autowired    AuthenticationManager authenticationManager;    @Autowired    UserDetailsService userDetailsService;    private static final String DEMO_RESOURCE_ID = &quot;storicid&quot;;    @Override    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {        //Oauth2 é»˜è®¤ä½¿ç”¨BCryptPasswordEncoderä½œä¸ºåŠ å¯†æ–¹æ³•ï¼Œéœ€è¦åœ¨åŠ å¯†ä¹‹åçš„å­—ç¬¦å‰åŠ {bcrypt}        //String finalSecret = &quot;{bcrypt}&quot; + new BCryptPasswordEncoder().encode(&quot;storic-secret&quot;);        String finalSecret = PasswordHelper.encryptPassword(&quot;storic-secret&quot;);        //è¿™é‡Œé€šè¿‡å®ç° ClientDetailsServiceæ¥å£ clients.withClientDetails(new BaseClientDetailService());        //é…ç½®å®¢æˆ·ç«¯,ä¸€ä¸ªç”¨äºpasswordè®¤è¯ä¸€ä¸ªç”¨äºclientè®¤è¯        clients            .inMemory()            .withClient(&quot;client_app&quot;)            .resourceIds(DEMO_RESOURCE_ID)            .authorizedGrantTypes(&quot;client_credentials&quot;, &quot;refresh_token&quot;, &quot;password&quot;)            .scopes(&quot;select&quot;)            .authorities(&quot;oauth2&quot;)            .secret(finalSecret)            .accessTokenValiditySeconds((int)TimeUnit.DAYS.toSeconds(1))            .refreshTokenValiditySeconds((int)TimeUnit.DAYS.toSeconds(1))        .and()            .withClient(&quot;client_web&quot;)            .resourceIds(DEMO_RESOURCE_ID)            .authorizedGrantTypes(&quot;authorization_code&quot;, &quot;client_credentials&quot;, &quot;refresh_token&quot;,                    &quot;password&quot;, &quot;implicit&quot;)            .scopes(&quot;read&quot;, &quot;write&quot;, &quot;trust&quot;)            .authorities(&quot;oauth2&quot;)            .secret(finalSecret)            .accessTokenValiditySeconds((int)TimeUnit.DAYS.toSeconds(1))            .refreshTokenValiditySeconds((int)TimeUnit.DAYS.toSeconds(1));     }    @Override    public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {        endpoints            .tokenStore(new InMemoryTokenStore())            .authenticationManager(authenticationManager)            .userDetailsService(userDetailsService) // ä¸æ·»åŠ æ— æ³•æ­£å¸¸ä½¿ç”¨refresh_token            .allowedTokenEndpointRequestMethods(HttpMethod.GET, HttpMethod.POST, HttpMethod.PUT, HttpMethod.DELETE);    }    @Override    public void configure(AuthorizationServerSecurityConfigurer oauthServer) throws Exception {        //å…è®¸è¡¨å•è®¤è¯        //è¿™é‡Œå¢åŠ æ‹¦æˆªå™¨åˆ°å®‰å…¨è®¤è¯é“¾ä¸­ï¼Œå®ç°è‡ªå®šä¹‰è®¤è¯ï¼ŒåŒ…æ‹¬å›¾ç‰‡éªŒè¯ï¼ŒçŸ­ä¿¡éªŒè¯ï¼Œå¾®ä¿¡å°ç¨‹åºï¼Œç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼ŒCASå•ç‚¹ç™»å½•        //addTokenEndpointAuthenticationFilter(IntegrationAuthenticationFilter())        //IntegrationAuthenticationFilter é‡‡ç”¨ @Component æ³¨å…¥        oauthServer            .realm(DEMO_RESOURCE_ID)            .tokenKeyAccess(&quot;permitAll()&quot;)            .checkTokenAccess(&quot;isAuthenticated()&quot;)            .allowFormAuthenticationForClients();    }}</code></pre><p>è¿™é‡ŒClientDetailServiceåŸºäºå†…å­˜çš„æ–¹å¼ï¼Œæ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨çœŸæ˜¯ç¯å¢ƒä¸­ï¼Œä¸€èˆ¬å»ºè®®ç»“åˆJDBCæˆ–è€…Redisã€‚ä¸ºæ­¤å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªClientDetailService</p><p>CustomClientDetailService.java (å¯é€‰)</p><pre><code>import java.util.Arrays;import java.util.HashSet;import java.util.Set;import java.util.concurrent.TimeUnit;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.security.core.authority.AuthorityUtils;import org.springframework.security.oauth2.provider.ClientDetails;import org.springframework.security.oauth2.provider.ClientDetailsService;import org.springframework.security.oauth2.provider.ClientRegistrationException;import org.springframework.security.oauth2.provider.NoSuchClientException;import org.springframework.security.oauth2.provider.client.BaseClientDetails;/** * è‡ªå®šä¹‰ClientDetailsServiceï¼Œå¯ä»¥çµæ´»å®šä¹‰auth2æ‹¦æˆªçš„æ¥å£ã€æƒé™é›†åˆç­‰ * @author chenzhiling * */public class CustomClientDetailService implements ClientDetailsService {    private static final Logger log = LoggerFactory.getLogger(CustomClientDetailService.class);    @Override    public ClientDetails loadClientByClientId(String clientId) throws ClientRegistrationException {        BaseClientDetails client = null;        //è¿™é‡Œå¯ä»¥æ”¹ä¸ºæŸ¥è¯¢æ•°æ®åº“        if(&quot;client_app&quot;.equals(clientId)) {            log.info(&quot;Create a app client detail.&quot;);            client = new BaseClientDetails();            client.setClientId(clientId);            client.setClientSecret(&quot;{noop}123456&quot;);            client.setResourceIds(Arrays.asList(&quot;order&quot;));            client.setAuthorizedGrantTypes(Arrays.asList(&quot;authorization_code&quot;,                     &quot;client_credentials&quot;, &quot;refresh_token&quot;, &quot;password&quot;, &quot;implicit&quot;));            //ä¸åŒçš„clientå¯ä»¥é€šè¿‡ä¸€ä¸ªscope å¯¹åº”æƒé™é›†            client.setScope(Arrays.asList(&quot;all&quot;, &quot;select&quot;));            client.setAuthorities(AuthorityUtils.createAuthorityList(&quot;ADMIN_ROLE&quot;));            client.setAccessTokenValiditySeconds((int)TimeUnit.DAYS.toSeconds(1)); //1å¤©            client.setRefreshTokenValiditySeconds((int)TimeUnit.DAYS.toSeconds(1)); //1å¤©            Set&lt;String&gt; uris = new HashSet&lt;&gt;();            uris.add(&quot;/login&quot;);            client.setRegisteredRedirectUri(uris);        }        if(client == null) {            throw new NoSuchClientException(&quot;No client width requested id: &quot; + clientId);        }        return client;    }}</code></pre><p>CustomResServerConfiguration.java</p><pre><code>import org.springframework.context.annotation.Configuration;import org.springframework.http.HttpMethod;import org.springframework.security.config.annotation.web.builders.HttpSecurity;import org.springframework.security.config.http.SessionCreationPolicy;import org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer;import org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter;import org.springframework.security.oauth2.config.annotation.web.configurers.ResourceServerSecurityConfigurer;/** * Spring Security ä¸­çš„ResourceServerConfigurerAdapteré…ç½®ä¼šè¦†ç›–WebSecurityConfigurerAdapter * protected void configure(HttpSecurity http) ä¸­çš„é…ç½®ä¼šä»¥ResourceServerConfigurerAdapterä¸ºå‡† * @author chenzhiling * */@Configuration@EnableResourceServerpublic class CustomResServerConfiguration extends ResourceServerConfigurerAdapter {    private static final String RESOURCE_ID = &quot;storicid&quot;;    @Override    public void configure(ResourceServerSecurityConfigurer resources) {        resources.resourceId(RESOURCE_ID).stateless(true);    }    @Override    public void configure(HttpSecurity http) throws Exception {        // Since we want the protected resources to be accessible in the UI as well we need        // session creation to be allowed (it&#39;s disabled by default in 2.0.6)        http            .httpBasic()        .and()            .sessionManagement()            .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)        .and()            .authorizeRequests()            .antMatchers(&quot;/&quot;)            .permitAll()        .and()            .logout()            .permitAll()        .and()            .authorizeRequests()            .antMatchers(&quot;/oauth/*&quot;)            .permitAll()        .and()            .authorizeRequests()            .antMatchers(&quot;/v2/api-docs&quot;, &quot;/configuration/**&quot;, &quot;/swagger*/**&quot;, &quot;/webjars/**&quot;, &quot;/**/*.js&quot;, &quot;/**/*.css&quot;, &quot;/**/*.png&quot;)            .permitAll()        .and()            .authorizeRequests()            .regexMatchers(HttpMethod.POST, &quot;/user&quot;)            .permitAll()        .and()            .authorizeRequests()            .antMatchers(&quot;/admin/**&quot;)            .access(&quot;#oauth2.hasScope(&#39;read&#39;)&quot;)            .antMatchers(&quot;/admin/**&quot;)            .hasAnyAuthority(&quot;ROLE_ADMIN&quot;)        .and()            .authorizeRequests()            .anyRequest()            .authenticated()        .and()            //å…³é—­é»˜è®¤çš„csrfè®¤è¯            .csrf()            .disable();    }}</code></pre><p>å¯¹äºhttpçš„Securityæ‹¦æˆªå¯ä»¥çµæ´»æ ¹æ®ä¸åŒçš„éœ€æ±‚å®šä¹‰ï¼Œè¿™é‡Œåªæ˜¯æå°½å¯èƒ½åˆ—å‡ºä¸åŒæƒ…å†µã€‚</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://spring.io/guides/gs/securing-web/" target="_blank" rel="noopener">Securing a Web Application</a></li><li><a href="https://javadeveloperzone.com/spring/spring-jackson-property-naming-strategy/" target="_blank" rel="noopener">Spring Jackson property naming strategy</a></li><li><a href="https://javadeveloperzone.com/spring-boot/spring-boot-configure-gson/" target="_blank" rel="noopener">Spring boot configure Gson</a></li><li><a href="https://javadeveloperzone.com/spring-boot/change-gson-field-naming-strategy-in-spring/" target="_blank" rel="noopener">Change Gson field naming strategy in Spring</a></li><li><a href="http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/" target="_blank" rel="noopener">Understanding OAuth2</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Spring-Boot2-0-Spring-Security-Oauth2&quot;&gt;&lt;a href=&quot;#Spring-Boot2-0-Spring-Security-Oauth2&quot; class=&quot;headerlink&quot; title=&quot;Spring-Boot2.0 + S
      
    
    </summary>
    
    
      <category term="Java" scheme="https://banbanpeppa.github.io/tags/Java/"/>
    
      <category term="Spring Boot" scheme="https://banbanpeppa.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>Spring-Boot + HTTPS</title>
    <link href="https://banbanpeppa.github.io/2019/04/28/java/spring/spring-boot-https/"/>
    <id>https://banbanpeppa.github.io/2019/04/28/java/spring/spring-boot-https/</id>
    <published>2019-04-28T09:00:00.000Z</published>
    <updated>2019-04-28T13:48:15.845Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Bootå®ç°HTTPS"><a href="#Spring-Bootå®ç°HTTPS" class="headerlink" title="Spring-Bootå®ç°HTTPS"></a>Spring-Bootå®ç°HTTPS</h1><p>ä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼ˆè‹±è¯­ï¼šTransport Layer Securityï¼Œç¼©å†™ä½œ TLSï¼‰ï¼ŒåŠå…¶å‰èº«å®‰å…¨å¥—æ¥å±‚ï¼ˆSecure Sockets Layerï¼Œç¼©å†™ä½œ SSLï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç›®çš„æ˜¯ä¸ºäº’è”ç½‘é€šä¿¡ï¼Œæä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§ä¿éšœã€‚ç½‘æ™¯å…¬å¸ï¼ˆNetscapeï¼‰åœ¨1994å¹´æ¨å‡ºé¦–ç‰ˆç½‘é¡µæµè§ˆå™¨ï¼Œç½‘æ™¯å¯¼èˆªè€…æ—¶ï¼Œæ¨å‡ºHTTPSåè®®ï¼Œä»¥SSLè¿›è¡ŒåŠ å¯†ï¼Œè¿™æ˜¯SSLçš„èµ·æºã€‚IETFå°†SSLè¿›è¡Œæ ‡å‡†åŒ–ï¼Œ1999å¹´å…¬å¸ƒç¬¬ä¸€ç‰ˆTLSæ ‡å‡†æ–‡ä»¶ã€‚éšååˆå…¬å¸ƒRFC 5246 ï¼ˆ2008å¹´8æœˆï¼‰ä¸ RFC 6176 ï¼ˆ2011å¹´3æœˆï¼‰ã€‚åœ¨æµè§ˆå™¨ã€ç”µå­é‚®ä»¶ã€å³æ—¶é€šä¿¡ã€VoIPã€ç½‘ç»œä¼ çœŸç­‰åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¿æ³›æ”¯æŒè¿™ä¸ªåè®®ã€‚ä¸»è¦çš„ç½‘ç«™ï¼Œå¦‚Googleã€Facebookç­‰ä¹Ÿä»¥è¿™ä¸ªåè®®æ¥åˆ›å»ºå®‰å…¨è¿æ¥ï¼Œå‘é€æ•°æ®ã€‚ç›®å‰å·²æˆä¸ºäº’è”ç½‘ä¸Šä¿å¯†é€šä¿¡çš„å·¥ä¸šæ ‡å‡†ã€‚</p><p>SSLåŒ…å«è®°å½•å±‚ï¼ˆRecord Layerï¼‰å’Œä¼ è¾“å±‚ï¼Œè®°å½•å±‚åè®®ç¡®å®šä¼ è¾“å±‚æ•°æ®çš„å°è£…æ ¼å¼ã€‚ä¼ è¾“å±‚å®‰å…¨åè®®ä½¿ç”¨X.509è®¤è¯ï¼Œä¹‹ååˆ©ç”¨éå¯¹ç§°åŠ å¯†æ¼”ç®—æ¥å¯¹é€šä¿¡æ–¹åšèº«ä»½è®¤è¯ï¼Œä¹‹åäº¤æ¢å¯¹ç§°å¯†é’¥ä½œä¸ºä¼šè°ˆå¯†é’¥ï¼ˆSession keyï¼‰ã€‚è¿™ä¸ªä¼šè°ˆå¯†é’¥æ˜¯ç”¨æ¥å°†é€šä¿¡ä¸¤æ–¹äº¤æ¢çš„æ•°æ®åšåŠ å¯†ï¼Œä¿è¯ä¸¤ä¸ªåº”ç”¨é—´é€šä¿¡çš„ä¿å¯†æ€§å’Œå¯é æ€§ï¼Œä½¿å®¢æˆ·ä¸æœåŠ¡å™¨åº”ç”¨ä¹‹é—´çš„é€šä¿¡ä¸è¢«æ”»å‡»è€…çªƒå¬ã€‚</p><h2 id="ç”Ÿæˆè¯ä¹¦"><a href="#ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè¯ä¹¦"></a>ç”Ÿæˆè¯ä¹¦</h2><p>ä½¿ç”¨Javaçš„Keytoolç”Ÿæˆè¯ä¹¦</p><pre><code>[banban:~ chenzhiling$ which keytool/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/bin/keytool[banban:~ chenzhiling$ keytool å¯†é’¥å’Œè¯ä¹¦ç®¡ç†å·¥å…·å‘½ä»¤: -certreq            ç”Ÿæˆè¯ä¹¦è¯·æ±‚ -changealias        æ›´æ”¹æ¡ç›®çš„åˆ«å -delete             åˆ é™¤æ¡ç›® -exportcert         å¯¼å‡ºè¯ä¹¦ -genkeypair         ç”Ÿæˆå¯†é’¥å¯¹ -genseckey          ç”Ÿæˆå¯†é’¥ -gencert            æ ¹æ®è¯ä¹¦è¯·æ±‚ç”Ÿæˆè¯ä¹¦ -importcert         å¯¼å…¥è¯ä¹¦æˆ–è¯ä¹¦é“¾ -importpass         å¯¼å…¥å£ä»¤ -importkeystore     ä»å…¶ä»–å¯†é’¥åº“å¯¼å…¥ä¸€ä¸ªæˆ–æ‰€æœ‰æ¡ç›® -keypasswd          æ›´æ”¹æ¡ç›®çš„å¯†é’¥å£ä»¤ -list               åˆ—å‡ºå¯†é’¥åº“ä¸­çš„æ¡ç›® -printcert          æ‰“å°è¯ä¹¦å†…å®¹ -printcertreq       æ‰“å°è¯ä¹¦è¯·æ±‚çš„å†…å®¹ -printcrl           æ‰“å° CRL æ–‡ä»¶çš„å†…å®¹ -storepasswd        æ›´æ”¹å¯†é’¥åº“çš„å­˜å‚¨å£ä»¤ä½¿ç”¨ &quot;keytool -command_name -help&quot; è·å– command_name çš„ç”¨æ³•</code></pre><p>è¾“å…¥</p><pre><code>keytool -genkey -storetype PKCS12 -keysize 2048 -alias tomcat -keyalg RSA -keystore ./tomcat.keystore</code></pre><p>ç»“æœå¦‚ä¸‹</p><pre><code>è¾“å…¥å¯†é’¥åº“å£ä»¤:  å†æ¬¡è¾“å…¥æ–°å£ä»¤: æ‚¨çš„åå­—ä¸å§“æ°æ˜¯ä»€ä¹ˆ?  [Unknown]:  chenæ‚¨çš„ç»„ç»‡å•ä½åç§°æ˜¯ä»€ä¹ˆ?  [Unknown]:  scutæ‚¨çš„ç»„ç»‡åç§°æ˜¯ä»€ä¹ˆ?  [Unknown]:  scutæ‚¨æ‰€åœ¨çš„åŸå¸‚æˆ–åŒºåŸŸåç§°æ˜¯ä»€ä¹ˆ?  [Unknown]:  guangzhouæ‚¨æ‰€åœ¨çš„çœ/å¸‚/è‡ªæ²»åŒºåç§°æ˜¯ä»€ä¹ˆ?  [Unknown]:  guangzhouè¯¥å•ä½çš„åŒå­—æ¯å›½å®¶/åœ°åŒºä»£ç æ˜¯ä»€ä¹ˆ?  [Unknown]:  CNCN=chen, OU=scut, O=scut, L=guangzhou, ST=guangzhou, C=CNæ˜¯å¦æ­£ç¡®?  [å¦]:  æ˜¯</code></pre><p>å¾—åˆ°äº†<code>tomcat.keystore</code>ä¹‹åå°†è¯ä¹¦æ”¾ç½®åˆ°é¡¹ç›®æ ¹ç›®å½•</p><h2 id="é…ç½®HTTPS"><a href="#é…ç½®HTTPS" class="headerlink" title="é…ç½®HTTPS"></a>é…ç½®HTTPS</h2><p>åœ¨spring-booté¡¹ç›®çš„<code>application.properties</code>é…ç½®æ–‡ä»¶ä¸‹å¢åŠ é…ç½®å¦‚ä¸‹</p><pre><code>server.port=8843server.ssl.key-store=tomcat.keystoreserver.ssl.key-store-password=&lt;password&gt;server.ssl.key-store-type=PKCS12server.ssl.key-alias=tomcat</code></pre><p>å…¶ä¸­<code>&lt;password&gt;</code>æ˜¯åœ¨ç”Ÿæˆè¯ä¹¦çš„æ—¶å€™è®¾ç½®çš„å£ä»¤</p><p>å®šä¹‰HTTPSçš„é…ç½®ç±»</p><pre><code>import org.apache.catalina.Context;import org.apache.catalina.connector.Connector;import org.apache.tomcat.util.descriptor.web.SecurityCollection;import org.apache.tomcat.util.descriptor.web.SecurityConstraint;import org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configurationpublic class HttpsConfiguration {    /**     * @author chenzhiling     * @since spring boot 2.0     * @return     */    @Bean    public TomcatServletWebServerFactory servletContainer() {        TomcatServletWebServerFactory tomcat = new TomcatServletWebServerFactory() {            @Override            protected void postProcessContext(Context context) {                SecurityConstraint constraint = new SecurityConstraint();                constraint.setUserConstraint(&quot;CONFIDENTIAL&quot;);                SecurityCollection collection = new SecurityCollection();                collection.addPattern(&quot;/*&quot;);                constraint.addCollection(collection);                context.addConstraint(constraint);            }        };        tomcat.addAdditionalTomcatConnectors(httpConnector());        return tomcat;    }    @Bean    public Connector httpConnector() {        Connector connector = new Connector(&quot;org.apache.coyote.http11.Http11NioProtocol&quot;);        connector.setScheme(&quot;http&quot;);        //Connectorç›‘å¬çš„httpçš„ç«¯å£å·        connector.setPort(6161);        connector.setSecure(false);        //ç›‘å¬åˆ°httpçš„ç«¯å£å·åè½¬å‘åˆ°çš„httpsçš„ç«¯å£å·        connector.setRedirectPort(8843);        return connector;    }}</code></pre><p>æœ¬äººåœ¨é…ç½®è¯¥HTTPSçš„æ—¶å€™ä½¿ç”¨çš„springç‰ˆæœ¬ä¿¡æ¯ä¸º</p><pre><code>&lt;parent&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;    &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&lt;/parent&gt;</code></pre><p>ä¹‹åè®¿é—®èµ„æºçš„æ—¶å€™å¯ä»¥é€šè¿‡<code>https://host:8843/</code>æ¥è®¿é—®ï¼Œå¦‚æœè®¿é—®æ–¹å¼ä¸º<code>http://host:6161/</code>ä¼šè·³è½¬åˆ°HTTPSç«¯å£ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Spring-Bootå®ç°HTTPS&quot;&gt;&lt;a href=&quot;#Spring-Bootå®ç°HTTPS&quot; class=&quot;headerlink&quot; title=&quot;Spring-Bootå®ç°HTTPS&quot;&gt;&lt;/a&gt;Spring-Bootå®ç°HTTPS&lt;/h1&gt;&lt;p&gt;ä¼ è¾“å±‚å®‰å…¨æ€§
      
    
    </summary>
    
    
      <category term="Java" scheme="https://banbanpeppa.github.io/tags/Java/"/>
    
      <category term="Spring Boot" scheme="https://banbanpeppa.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£</title>
    <link href="https://banbanpeppa.github.io/2019/04/28/java/retrofit-https/"/>
    <id>https://banbanpeppa.github.io/2019/04/28/java/retrofit-https/</id>
    <published>2019-04-28T02:00:00.000Z</published>
    <updated>2019-05-13T15:44:00.661Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£"><a href="#ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£" class="headerlink" title="ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£"></a>ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£</h1><p>Retrofitæ˜¯ä¸€ä¸ªç±»å‹å®‰å…¨çš„HTTPå®¢æˆ·ç«¯å·¥å…·ï¼Œä½¿ç”¨Javaè¯­è¨€å¼€å‘ï¼Œä¸»è¦ä¸ºAndroidå’ŒJavaå®¢æˆ·ç«¯çš„HTTPè¯·æ±‚çš„æä¾›æ–¹ä¾¿ï¼ŒRetrofitå¯ä»¥è®¤ä¸ºæ˜¯OkHttpçš„åŠ å¼ºç‰ˆï¼Œæ˜¯ä¸€ä¸ªç½‘ç»œåŠ è½½æ¡†æ¶ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯OkHttpå°è£…ã€‚ä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œç½‘ç»œè¯·æ±‚çš„å·¥ä½œæœ¬è´¨ä¸Šéƒ½æ˜¯OkHttpå®Œæˆçš„ï¼Œè€ŒRetrofitåˆ™è´Ÿè´£ç½‘ç»œè¯·æ±‚æ¥å£çš„å°è£…ï¼Œå®ƒæä¾›äº†å¾ˆå¤šæ³¨è§£ï¼Œç®€åŒ–äº†ä»£ç ï¼Œæœ‰å¾ˆå¤šè‘—åçš„å¼€æºåº“å¦‚ï¼šRetrofit + RxJavaã€‚</p><p>ä½†æ˜¯åœ¨ä½¿ç”¨Retrofitçš„è¿‡ç¨‹ä¸­ï¼Œéš¾å…ä¼šé‡åˆ°è¯·æ±‚HTTPSçš„æƒ…å†µï¼Œä¸ºæ­¤éœ€è¦é…ç½®ç±»ä¼¼<code>SSLSocket</code>ç­‰å†…å®¹ã€‚</p><h2 id="æ·»åŠ Retrofitä¾èµ–"><a href="#æ·»åŠ Retrofitä¾èµ–" class="headerlink" title="æ·»åŠ Retrofitä¾èµ–"></a>æ·»åŠ Retrofitä¾èµ–</h2><p>ä½¿ç”¨mavenå¼•å…¥Retrofité…ç½®ï¼Œæœ¬äººä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯<code>2.5.0</code></p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;com.squareup.retrofit2&lt;/groupId&gt;    &lt;artifactId&gt;retrofit&lt;/artifactId&gt;    &lt;version&gt;2.5.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;com.squareup.retrofit2&lt;/groupId&gt;    &lt;artifactId&gt;converter-gson&lt;/artifactId&gt;    &lt;version&gt;2.5.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;com.squareup.retrofit2&lt;/groupId&gt;    &lt;artifactId&gt;adapter-rxjava&lt;/artifactId&gt;    &lt;version&gt;2.5.0&lt;/version&gt;&lt;/dependency&gt;</code></pre><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯·æ±‚HTTPèµ„æºçš„æ—¶å€™Retrofitçš„ä½¿ç”¨å¾ˆç®€å•ï¼Œå¦‚ä¸‹æ˜¯å®˜æ–¹ç»™å‡ºçš„ä¾‹å­ã€‚</p><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ç±»ï¼Œé€šè¿‡æ³¨è§£æ ‡è¯†è¯·æ±‚ç±»å‹å’Œè¯·æ±‚çš„URL</p><pre><code>public interface GitHubService {  @GET(&quot;users/{user}/repos&quot;)  Call&lt;List&lt;Repo&gt;&gt; listRepos(@Path(&quot;user&quot;) String user);}</code></pre><p>é€šè¿‡Retrofitæ¥åˆ›å»ºè¿™ä¸ªæ¥å£çš„è¯·æ±‚å®ä¾‹</p><pre><code>Retrofit retrofit = new Retrofit.Builder()    .baseUrl(&quot;https://api.github.com/&quot;)    .build();GitHubService service = retrofit.create(GitHubService.class);</code></pre><p>ä¹‹åè¯·æ±‚èµ„æºå†…å®¹ä¾¿å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–</p><pre><code>Call&lt;List&lt;Repo&gt;&gt; repos = service.listRepos(&quot;octocat&quot;);</code></pre><h2 id="Retrofitæ³¨è§£"><a href="#Retrofitæ³¨è§£" class="headerlink" title="Retrofitæ³¨è§£"></a>Retrofitæ³¨è§£</h2><ul><li>è¯·æ±‚æ–¹æ³•</li></ul><table><thead><tr><th>æ³¨è§£ä»£ç </th><th style="text-align:center">è¯·æ±‚æ ¼å¼</th></tr></thead><tbody><tr><td>@GET</td><td style="text-align:center">GETè¯·æ±‚</td></tr><tr><td>@POST</td><td style="text-align:center">POSTè¯·æ±‚</td></tr><tr><td>@DELETE</td><td style="text-align:center">DELETEè¯·æ±‚</td></tr><tr><td>@HEAD</td><td style="text-align:center">HEADè¯·æ±‚</td></tr><tr><td>@OPTIONS</td><td style="text-align:center">OPTIONSè¯·æ±‚</td></tr><tr><td>@PATCH</td><td style="text-align:center">PATCHè¯·æ±‚</td></tr></tbody></table><ul><li>è¯·æ±‚å‚æ•°</li></ul><table><thead><tr><th>æ³¨è§£ä»£ç </th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td>@Headers</td><td style="text-align:center">æ·»åŠ è¯·æ±‚å¤´</td></tr><tr><td>@Path</td><td style="text-align:center">æ›¿æ¢è·¯å¾„</td></tr><tr><td>@Query</td><td style="text-align:center">æ›¿ä»£å‚æ•°å€¼ï¼Œé€šå¸¸æ˜¯ç»“åˆgetè¯·æ±‚çš„</td></tr><tr><td>@FormUrlEncoded</td><td style="text-align:center">ç”¨è¡¨å•æ•°æ®æäº¤</td></tr><tr><td>@Field</td><td style="text-align:center">æ›¿æ¢å‚æ•°å€¼ï¼Œæ˜¯ç»“åˆpostè¯·æ±‚çš„</td></tr></tbody></table><h2 id="é…ç½®ä½¿ç”¨HTTPS"><a href="#é…ç½®ä½¿ç”¨HTTPS" class="headerlink" title="é…ç½®ä½¿ç”¨HTTPS"></a>é…ç½®ä½¿ç”¨HTTPS</h2><p>å®šä¹‰OkHttpClient</p><pre><code>OkHttpClient okHttpClient = new OkHttpClient.Builder()        .connectTimeout(5, TimeUnit.SECONDS)        .readTimeout(10, TimeUnit.SECONDS)        .sslSocketFactory(getSSLSocketFactory(), new CustomTrustManager())        .hostnameVerifier(getHostnameVerifier())        .build();Retrofit retrofit = new Retrofit.Builder()        .baseUrl(&quot;https://localhost:8843&quot;)        .client(okHttpClient)        .addConverterFactory(new NullOnEmptyConverterFactory())        .addConverterFactory(GsonConverterFactory.create())        .addCallAdapterFactory(RxJavaCallAdapterFactory.create())        .build();</code></pre><p>å…¶ä¸­<code>getSSLSocketFactor</code>æ–¹æ³•å†…å®¹å¦‚ä¸‹</p><pre><code>private static SSLSocketFactory getSSLSocketFactory() {    SSLContext sslContext = null;    try {        KeyStore keyStore = KeyStore.getInstance(&quot;PKCS12&quot;);        InputStream certificate = new FileInputStream(new File(&quot;tomcat.keystore&quot;));        keyStore.load(certificate, &quot;somnus&quot;.toCharArray());        sslContext = SSLContext.getInstance(&quot;TLS&quot;);        TrustManagerFactory trustManagerFactory = TrustManagerFactory                .getInstance(TrustManagerFactory.getDefaultAlgorithm());        trustManagerFactory.init(keyStore);        sslContext.init(null, trustManagerFactory.getTrustManagers(), new SecureRandom());    } catch (Exception e) {        e.printStackTrace();    }    return sslContext.getSocketFactory();}</code></pre><p>Keystoreä¹‹æ‰€ä»¥è·å–çš„å®ä¾‹æ˜¯<code>PKCS12</code>ï¼Œæ˜¯å› ä¸ºæœ¬ä¾‹å­ä¸­çš„è¯ä¹¦æ˜¯è‡ªå·±ç”Ÿæˆçš„è¯ä¹¦ï¼Œè¯ä¹¦é‡‡ç”¨javaå·¥å…·<code>keytool</code>ç”Ÿæˆï¼Œç”Ÿæˆä¹‹ååŠ åˆ°<code>spring-boot</code>ä¸­ä½¿ç”¨ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæ–‡ç« <a href="https://banbanpeppa.github.io/2019/04/28/java/spring/spring-boot-https/">Spring-Boot + HTTPS</a>ã€‚è¯ä¹¦è¯»å–çš„å¤–éƒ¨æ–‡ä»¶<code>tomcat.keystore</code>ï¼Œå¯†ç æ˜¯<code>somnus</code>ã€‚</p><p>ç±»<code>CustomTrustManager</code>å†…å®¹å¦‚ä¸‹</p><pre><code>import java.security.cert.CertificateException;import java.security.cert.X509Certificate;import javax.net.ssl.X509TrustManager;public class CustomTrustManager implements X509TrustManager {    @Override    public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException {    }    @Override    public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException {    }    @Override    public X509Certificate[] getAcceptedIssuers() {        return new X509Certificate[0];    }}</code></pre><p>æ–¹æ³•<code>getHostnameVerifier</code>å†…å®¹ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­çš„<code>HostnameVerifier</code>ç›´æ¥å¯¹éªŒè¯è¿”å›äº†ä¸€ä¸ª<code>true</code>ï¼Œè¿™ä¸ªéªŒè¯ä¸»è¦å¤„ç†é‚£äº›éœ€è¦é€šè¿‡éªŒè¯çš„åŸŸåï¼Œè§†æƒ…å†µè€Œè®¾ç½®</p><pre><code>public static HostnameVerifier getHostnameVerifier() {    HostnameVerifier hostnameVerifier = new HostnameVerifier() {        public boolean verify(String hostname, SSLSession session) {            return true;        }    };    return hostnameVerifier;}</code></pre><p>åœ¨ä½¿ç”¨Retrofitæ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯<code>GsonConverterFactory</code>è½¬æ¢å™¨ã€‚ä½†æ˜¯æœ‰æ—¶å€™åå°ä¼šè¿”å›ä¸ºç©ºçš„responseã€‚ appç«¯ä¼šè¿”å›  <code>response.body() on a null object reference</code>é”™è¯¯ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹ï¼Œé€šè¿‡è‡ªå®šä¹‰ä¸€ä¸ª<code>NullOnEmptyConverterFactory</code>æ¥å¯¹è¿”å›ä¸ºç©ºçš„responseè¿›è¡Œæ‹¦æˆªäºŒæ¬¡å¤„ç†ã€‚</p><pre><code>import okhttp3.ResponseBody;import retrofit2.Converter;import retrofit2.Retrofit;import java.io.IOException;import java.lang.annotation.Annotation;import java.lang.reflect.Type;public class NullOnEmptyConverterFactory extends Converter.Factory {    @Override    public Converter&lt;ResponseBody, ?&gt; responseBodyConverter(Type type, Annotation[] annotations, Retrofit retrofit) {        final Converter&lt;ResponseBody, ?&gt; delegate = retrofit.nextResponseBodyConverter(this, type, annotations);        return new Converter&lt;ResponseBody, Object&gt;() {            @Override            public Object convert(ResponseBody body) throws IOException {                if (body.contentLength() == 0) return null;                return delegate.convert(body);            }        };    }}</code></pre><h2 id="å®šåˆ¶X509TrustManager"><a href="#å®šåˆ¶X509TrustManager" class="headerlink" title="å®šåˆ¶X509TrustManager"></a>å®šåˆ¶X509TrustManager</h2><p>è¯ä¹¦çš„éªŒè¯æ˜¯å¿…é¡»çš„ï¼Œä¸ºæ­¤å¯ä»¥å®šåˆ¶<code>X509TrustManager</code>ï¼Œå¯¹å…¶ä¸­çš„<code>checkServerTrusted</code>æ–¹æ³•å®šåˆ¶åŒ–ï¼Œä¾‹å¦‚ä¸‹ä¾‹å­</p><pre><code>import java.io.File;import java.io.FileInputStream;import java.io.InputStream;import java.math.BigInteger;import java.security.KeyStore;import java.security.cert.CertificateException;import java.security.cert.X509Certificate;import java.security.interfaces.RSAPublicKey;import javax.net.ssl.TrustManager;import javax.net.ssl.TrustManagerFactory;import javax.net.ssl.X509TrustManager;public class CustomTrustManager implements X509TrustManager {    // è¯ä¹¦ä¸­çš„å…¬é’¥    public static final String PUB_KEY = &quot;30820122300d06092a864886f70d01010105000382010f003082010a0282010&quot;            + &quot;1009d5d3bc479af1780ec41485b592952cafaeb028f2917606cab945d0b3d2172fea8273921a3866b8c16a537a&quot;            + &quot;6502782734c68425be33b16515933881acdda6c008d8cbc8c215f38fecc876543f780ceca81f41d0731c62d5de&quot;            + &quot;9bcd4dfcfb05d0bd343a87bb00f60e4cdf2392896003acc6a7de2e161583d2542b4a3c6f290a67c49a06cc2cca&quot;            + &quot;ea929165b66a2f18f9f21ff5567a177c33c466a85505060316387762dadd143a63778603c98e29b9cd38aedf9e&quot;            + &quot;ccc0f75dda34b78bcc6f4959bd879217d07ce7681d170c41a103ec2f36e2e015ec0a365a8cafc5b5a563671bd0&quot;            + &quot;79096b83daf3f4140651975631e79f9becf0238c99cd8edbd7e078e4d0c35d3cb0203010001&quot;;    @Override    public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException {        // TODO Auto-generated method stub    }    @Override    public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException {        if (chain == null) {            throw new IllegalArgumentException(&quot;checkServerTrusted:Certificate array isnull&quot;);        }        if (!(chain.length &gt; 0)) {            throw new IllegalArgumentException(&quot;checkServerTrusted: Certificate is empty&quot;);        }        if (!(null != authType &amp;&amp; authType.equalsIgnoreCase(&quot;ECDHE_RSA&quot;))) {            throw new CertificateException(&quot;checkServerTrusted: AuthType is not ECDHE_RSA&quot;);        }        // Perform customary SSL/TLS checks        try {            TrustManagerFactory tmf = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());            KeyStore keyStore = KeyStore.getInstance(&quot;PKCS12&quot;);            InputStream certificate = new FileInputStream(new File(&quot;tomcat.keystore&quot;));            keyStore.load(certificate, &quot;somnus&quot;.toCharArray());            tmf.init(keyStore);            for (TrustManager trustManager : tmf.getTrustManagers()) {                ((X509TrustManager) trustManager).checkServerTrusted(chain, authType);            }        } catch (Exception e) {            throw new CertificateException(e);        }        // Hack ahead: BigInteger and toString(). We know a DER encoded Public Key begins        // with 0Ã—30 (ASN.1 SEQUENCE and CONSTRUCTED), so there is no leading 0Ã—00 to drop.        RSAPublicKey pubkey = (RSAPublicKey) chain[0].getPublicKey();        String encoded = new BigInteger(1 /* positive */, pubkey.getEncoded()).toString(16);        // Pin it!        final boolean expected = PUB_KEY.equalsIgnoreCase(encoded);        if (!expected) {            throw new CertificateException(                    &quot;checkServerTrusted: Expected public key: &quot; + PUB_KEY + &quot;, got public key:&quot; + encoded);        }    }    @Override    public X509Certificate[] getAcceptedIssuers() {        return new X509Certificate[0];    }}</code></pre><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">http://square.github.io/retrofit/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£&quot;&gt;&lt;/a&gt;ä½¿ç”¨Retrofitè®¿é—®HTTPSæ¥å£&lt;/h1&gt;&lt;p&gt;Re
      
    
    </summary>
    
    
      <category term="Java" scheme="https://banbanpeppa.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>PostManè‡ªåŠ¨è®¾ç½®OAuth2è¯·æ±‚å¤´Auhtorization</title>
    <link href="https://banbanpeppa.github.io/2019/04/28/java/post-man-authorization/"/>
    <id>https://banbanpeppa.github.io/2019/04/28/java/post-man-authorization/</id>
    <published>2019-04-28T02:00:00.000Z</published>
    <updated>2019-04-28T10:20:30.547Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å¼€å‘javaåº”ç”¨è¿‡ç¨‹ä¸­ï¼Œéš¾å…é‡åˆ°èµ„æºè¯·æ±‚çš„æµ‹è¯•è¿‡ç¨‹ï¼Œä¸€èˆ¬å¼€å‘è¿‡ç¨‹ä¸­ä¼šå€ŸåŠ©ç±»ä¼¼PostManæˆ–è€…Insomniaçš„å·¥å…·ã€‚åœ¨ä½¿ç”¨PostMançš„è¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦ç»“åˆoauth2è¯·æ±‚è®¤è¯çš„tokenæ—¶ï¼Œå¦‚æœä¸è®¾ç½®å˜é‡ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨å»æ›´æ¢æ¯ä¸€ä¸ªè¯·æ±‚çš„Tokenï¼Œæ“ä½œéå¸¸ç¹çã€‚</p><p>ä¸ºäº†è‡ªåŠ¨åŒ–åœ°è®¾ç½®è¿™ä¸ªtokenï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨postmançš„<code>Tests</code>åŠŸèƒ½ã€‚Postmançš„<code>Tests</code>åŠŸèƒ½æ”¯æŒä½¿ç”¨JSè¿›è¡Œä¸€äº›å˜é‡æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥åœ¨æˆæƒæ¥å£çš„è¯·æ±‚ä¸­å¡«å…¥å¦‚ä¸‹çš„Testsè„šæœ¬ï¼š</p><pre><code>var token = JSON.parse(responseBody).value;postman.clearGlobalVariable(&quot;token&quot;);postman.setGlobalVariable(&quot;token&quot;, token);</code></pre><p>å…·ä½“å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/images/java/postman_test.jpg" alt="image"></p><p>ä¹‹åå…¶ä»–éœ€è¦ç”¨åˆ°è®¤è¯Tokençš„è¯·æ±‚éƒ½å¯ä»¥é€šè¿‡å¦‚ä¸‹è®¾ç½®æ–¹å¼è‡ªåŠ¨è®¾ç½®å¥½Token</p><p><img src="/images/java/postman_req.png" alt="image"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨å¼€å‘javaåº”ç”¨è¿‡ç¨‹ä¸­ï¼Œéš¾å…é‡åˆ°èµ„æºè¯·æ±‚çš„æµ‹è¯•è¿‡ç¨‹ï¼Œä¸€èˆ¬å¼€å‘è¿‡ç¨‹ä¸­ä¼šå€ŸåŠ©ç±»ä¼¼PostManæˆ–è€…Insomniaçš„å·¥å…·ã€‚åœ¨ä½¿ç”¨PostMançš„è¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦ç»“åˆoauth2è¯·æ±‚è®¤è¯çš„tokenæ—¶ï¼Œå¦‚æœä¸è®¾ç½®å˜é‡ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨å»æ›´æ¢æ¯ä¸€ä¸ªè¯·æ±‚çš„Tokenï¼Œæ“ä½œéå¸¸ç¹çã€‚&lt;/
      
    
    </summary>
    
    
      <category term="Java" scheme="https://banbanpeppa.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>æ­å»ºv2ray</title>
    <link href="https://banbanpeppa.github.io/2019/03/29/essay/v2ray/"/>
    <id>https://banbanpeppa.github.io/2019/03/29/essay/v2ray/</id>
    <published>2019-03-29T11:21:00.000Z</published>
    <updated>2019-12-03T12:08:46.610Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ä½¿ç”¨vultrçš„VPSæ­å»ºSSRï¼Œä¸‰å¤©ä¸¤å¤´è¢«æŸ¥ï¼Œå‡ºä¸å»çš„å¿ƒæƒ…éå¸¸ä½è½ã€‚äºæ˜¯é‡‡ç”¨å¦ä¸€ä¸ªå·¥å…·v2rayï¼Œä½¿ç”¨ä¹‹åå‘ç°ç¨³å®šæ€§é«˜äº†å¾ˆå¤šã€‚è¯ä¸å¤šè¯´ï¼Œæèµ·ï¼</p><h2 id="ä»€ä¹ˆæ˜¯V2Ray"><a href="#ä»€ä¹ˆæ˜¯V2Ray" class="headerlink" title="ä»€ä¹ˆæ˜¯V2Ray"></a>ä»€ä¹ˆæ˜¯V2Ray</h2><p>Project V æä¾›äº†å•ä¸€çš„å†…æ ¸å’Œå¤šç§ç•Œé¢æ“ä½œæ–¹å¼ã€‚å†…æ ¸ï¼ˆV2Rayï¼‰ç”¨äºå®é™…çš„ç½‘ç»œäº¤äº’ã€è·¯ç”±ç­‰é’ˆå¯¹ç½‘ç»œæ•°æ®çš„å¤„ç†ï¼Œè€Œå¤–å›´çš„ç”¨æˆ·ç•Œé¢ç¨‹åºæä¾›äº†æ–¹ä¾¿ç›´æ¥çš„æ“ä½œæµç¨‹ï¼Œç®€å•æ¥è¯´ï¼ŒV2Rayå°±æ˜¯ä¸€ä¸ªä»£ç†è½¯ä»¶ï¼Œå¯ä»¥ç”¨æ¥ç§‘å­¦ä¸Šç½‘å­¦ä¹ å›½å¤–å…ˆè¿›ç§‘å­¦æŠ€æœ¯ã€‚</p><h2 id="V2Rayä¸ShadowsocksåŒºåˆ«"><a href="#V2Rayä¸ShadowsocksåŒºåˆ«" class="headerlink" title="V2Rayä¸ShadowsocksåŒºåˆ«"></a>V2Rayä¸ShadowsocksåŒºåˆ«</h2><p>V2Rayæ˜¯åœ¨Shadowsocksçš„ä½œè€…è¢«è¯·å–èŒ¶ä¹‹åå‡ºç°çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†æ›´å¥½çš„ç§‘å­¦ä¸Šç½‘ã€‚ç›¸æ¯”äºssï¼ŒV2Rayçš„å®šä½æ˜¯ä¸€ä¸ªå¹³å°ï¼Œä»»ä½•å¼€å‘è€…éƒ½å¯ä»¥åœ¨è¿™ä¸ªå¹³å°ä¸Šåˆ©ç”¨V2Rayå¼€å‘å‡ºä¸€ä¸ªæ–°çš„ä»£ç†è½¯ä»¶ï¼Œç®€å•æ¥è¯´ï¼Œssçš„å®šä½æ¯”è¾ƒç®€å•ï¼ŒåŠŸèƒ½ä¹Ÿæ¯”è¾ƒå•ä¸€ï¼Œè€ŒV2Rayçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œç›¸å¯¹çš„ï¼ŒV2Rayçš„é…ç½®å°±ä¼šå¤æ‚å¾ˆå¤šã€‚</p><h2 id="V2Rayçš„ä¼˜åŠ¿"><a href="#V2Rayçš„ä¼˜åŠ¿" class="headerlink" title="V2Rayçš„ä¼˜åŠ¿"></a>V2Rayçš„ä¼˜åŠ¿</h2><ul><li>æ›´å®Œå–„çš„åè®®: V2Ray ä½¿ç”¨äº†æ–°çš„è‡ªè¡Œç ”å‘çš„ VMess åè®®ï¼Œæ”¹æ­£äº† Shadowsocks ä¸€äº›å·²æœ‰çš„ç¼ºç‚¹ï¼Œæ›´éš¾è¢«æ£€æµ‹åˆ°ï¼ˆä¸ä¿è¯å¯é æ€§ï¼‰</li><li>æ›´å¼ºå¤§çš„æ€§èƒ½: ç½‘ç»œæ€§èƒ½æ›´å¥½ï¼Œå…·ä½“æ•°æ®å¯ä»¥çœ‹ V2Ray å®˜æ–¹åšå®¢</li><li>æ›´ä¸°å¯Œçš„åŠŸèƒ½: ä»¥ä¸‹æ˜¯éƒ¨åˆ† V2Ray çš„åŠŸèƒ½</li><li>mKCP: KCP åè®®åœ¨ V2Ray ä¸Šçš„å®ç°ï¼Œä¸å¿…å¦è¡Œå®‰è£… kcptun</li><li>åŠ¨æ€ç«¯å£ï¼šåŠ¨æ€æ”¹å˜é€šä¿¡çš„ç«¯å£ï¼Œå¯¹æŠ—å¯¹é•¿æ—¶é—´å¤§æµé‡ç«¯å£çš„é™é€Ÿå°é”</li><li>è·¯ç”±åŠŸèƒ½ï¼šå¯ä»¥éšæ„è®¾å®šæŒ‡å®šæ•°æ®åŒ…çš„æµå‘ï¼Œå»å¹¿å‘Šã€åè·Ÿè¸ªéƒ½å¯ä»¥</li><li>ä¼ å‡ºä»£ç†ï¼šçœ‹åå­—å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œå…¶å®å·®ä¸å¤šå¯ä»¥ç§°ä¹‹ä¸ºå¤šé‡ä»£ç†ã€‚ç±»ä¼¼äº Tor çš„ä»£ç†</li><li>æ•°æ®åŒ…ä¼ªè£…ï¼šç±»ä¼¼äº Shadowsocks-rss çš„æ··æ·†ï¼Œå¦å¤–å¯¹äº mKCP çš„æ•°æ®åŒ…ä¹Ÿå¯ä¼ªè£…ï¼Œä¼ªè£…å¸¸è§æµé‡ï¼Œä»¤è¯†åˆ«æ›´å›°éš¾</li><li>WebSocket åè®®ï¼šå¯ä»¥ PaaS å¹³å°æ­å»ºV2Rayï¼Œé€šè¿‡ WebSocket ä»£ç†ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å®ƒä½¿ç”¨ CDN ä¸­è½¬ï¼ŒæŠ—å°é”æ•ˆæœæ›´å¥½</li><li>Mux:å¤šè·¯å¤ç”¨ï¼Œè¿›ä¸€æ­¥æé«˜ç§‘å­¦ä¸Šç½‘çš„å¹¶å‘æ€§èƒ½</li></ul><h2 id="ä¸€é”®è„šæœ¬æ­å»ºV2Ray"><a href="#ä¸€é”®è„šæœ¬æ­å»ºV2Ray" class="headerlink" title="ä¸€é”®è„šæœ¬æ­å»ºV2Ray"></a>ä¸€é”®è„šæœ¬æ­å»ºV2Ray</h2><p>ç›´æ¥æ‰§è¡Œï¼š</p><pre><code>wget https://raw.githubusercontent.com/banbanpeppa/ss-fly/master/v2ray.sh &amp;&amp; chmod +x v2ray.sh &amp;&amp; ./v2ray.sh</code></pre><p>æ‰§è¡Œç»“æœå¦‚ä¸‹</p><pre><code>--2019-03-29 19:31:17--  https://raw.githubusercontent.com/banbanpeppa/ss-fly/master/v2ray.shResolving raw.githubusercontent.com (raw.githubusercontent.com)... 151.101.108.133Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.108.133|:443... connected.HTTP request sent, awaiting response... 200 OKLength: 2292 (2.2K) [text/plain]Saving to: â€˜v2ray.shâ€™v2ray.sh                                     100%[==============================================================================================&gt;]   2.24K  --.-KB/s    in 0s      2019-03-29 19:31:18 (50.5 MB/s) - â€˜v2ray.shâ€™ saved [2292/2292]Installing V2Ray v4.18.0 on x86_64Downloading V2Ray: https://github.com/v2ray/v2ray-core/releases/download/v4.18.0/v2ray-linux-64.zip  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed100   608    0   608    0     0    472      0 --:--:--  0:00:01 --:--:--   473100 10.5M  100 10.5M    0     0  1900k      0  0:00:05  0:00:05 --:--:-- 3469kUpdating software repoInstalling unzipSelecting previously unselected package unzip.(Reading database ... 136355 files and directories currently installed.)Preparing to unpack .../unzip_6.0-20ubuntu1_amd64.deb ...Unpacking unzip (6.0-20ubuntu1) ...Processing triggers for mime-support (3.59ubuntu1) ...Processing triggers for man-db (2.7.5-1) ...Setting up unzip (6.0-20ubuntu1) ...Extracting V2Ray package to /tmp/v2ray.Archive:  /tmp/v2ray/v2ray.zip  inflating: /tmp/v2ray/config.json     creating: /tmp/v2ray/doc/  inflating: /tmp/v2ray/doc/readme.md    inflating: /tmp/v2ray/geoip.dat      inflating: /tmp/v2ray/geosite.dat     creating: /tmp/v2ray/systemd/  inflating: /tmp/v2ray/systemd/v2ray.service     creating: /tmp/v2ray/systemv/  inflating: /tmp/v2ray/systemv/v2ray    inflating: /tmp/v2ray/v2ctl         extracting: /tmp/v2ray/v2ctl.sig      inflating: /tmp/v2ray/v2ray         extracting: /tmp/v2ray/v2ray.sig      inflating: /tmp/v2ray/vpoint_socks_vmess.json    inflating: /tmp/v2ray/vpoint_vmess_freedom.json  Shutting down V2Ray service.Failed to stop v2ray.service: Unit v2ray.service not loaded.Failed to shutdown V2Ray service.PORT:16928UUID:43d27c77-fd22-47d4-8fb7-93973a56b920Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.Restarting V2Ray service.V2Ray v4.18.0 is installed.</code></pre><p>æ­¤è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ä»¥ä¸‹æ–‡ä»¶ï¼š</p><pre><code>/usr/bin/v2ray/v2rayï¼šV2Ray ç¨‹åº/usr/bin/v2ray/v2ctlï¼šV2Ray å·¥å…·/etc/v2ray/config.jsonï¼šé…ç½®æ–‡ä»¶/usr/bin/v2ray/geoip.datï¼šIP æ•°æ®æ–‡ä»¶/usr/bin/v2ray/geosite.datï¼šåŸŸåæ•°æ®æ–‡ä»¶</code></pre><p>ç”¨è¿™ä¸ªä¸€é”®è„šæœ¬å®‰è£…å¥½V2Rayåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ§åˆ¶V2Rayçš„å¼€å¯ã€å…³é—­ã€é‡å¯ã€æŸ¥çœ‹çŠ¶æ€ç­‰ï¼š</p><pre><code>service v2ray start|stop|status|reload|restart|force-reload</code></pre><h2 id="é…ç½®V2RayæœåŠ¡å™¨"><a href="#é…ç½®V2RayæœåŠ¡å™¨" class="headerlink" title="é…ç½®V2RayæœåŠ¡å™¨"></a>é…ç½®V2RayæœåŠ¡å™¨</h2><p>V2Rayçš„é…ç½®æ–‡ä»¶åœ¨<code>/etc/v2ray/config.json</code>ï¼Œå…ˆåˆ é™¤è¿™ä¸ªé…ç½®æ–‡ä»¶</p><pre><code>rm /etc/v2ray/config.json</code></pre><p>ä¹‹ååœ¨V2Rayé…ç½®<a href="https://intmainreturn0.com/v2ray-config-gen/" target="_blank" rel="noopener">åœ¨çº¿ç”Ÿæˆå™¨</a>ç”Ÿæˆå¯¹åº”çš„æœåŠ¡å™¨é…ç½®ï¼Œé€‰æ‹©å¥½å¯¹åº”çš„é…ç½®å(å–æ¶ˆå‹¾é€‰æ˜¯å¦æ˜¯åŠ¨æ€ç«¯å£å’Œæ˜¯å¦æ˜¯mKCPåè®®)ï¼Œå…¶ä¸­ç”¨æˆ·uuidæ˜¯ç”¨æ¥è¯†åˆ«ç”¨æˆ·çš„ï¼ŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¦ä¸€è‡´ï¼Œç›´æ¥ç‚¹å‡»æœåŠ¡å™¨é…ç½®ä¸‹æ–¹çš„å¤åˆ¶é…ç½®ã€‚ä¹Ÿå¯ä»¥ç”¨å¦‚ä¸‹çš„ä¸€ä¸ªæ¨¡æ¿</p><pre><code>{    &quot;log&quot;: {        &quot;access&quot;: &quot;/var/log/v2ray/access.log&quot;,        &quot;error&quot;: &quot;/var/log/v2ray/error.log&quot;,        &quot;loglevel&quot;: &quot;warning&quot;    },    &quot;inbound&quot;: {        &quot;port&quot;: 12345,        &quot;protocol&quot;: &quot;vmess&quot;,        &quot;settings&quot;: {            &quot;clients&quot;: [                {                    &quot;id&quot;: &quot;aab9c609-44c4-eb73-aa1f-c6611657409c&quot;,                    &quot;level&quot;: 1,                    &quot;alterId&quot;: 100                }            ]        },        &quot;streamSettings&quot;: {            &quot;network&quot;: &quot;kcp&quot;        },        &quot;detour&quot;: {            &quot;to&quot;: &quot;vmess-detour-345411&quot;        }    },    &quot;outbound&quot;: {        &quot;protocol&quot;: &quot;freedom&quot;,        &quot;settings&quot;: {}    },    &quot;inboundDetour&quot;: [        {            &quot;protocol&quot;: &quot;vmess&quot;,            &quot;port&quot;: &quot;10000-10010&quot;,            &quot;tag&quot;: &quot;vmess-detour-345411&quot;,            &quot;settings&quot;: {},            &quot;allocate&quot;: {                &quot;strategy&quot;: &quot;random&quot;,                &quot;concurrency&quot;: 5,                &quot;refresh&quot;: 5            },            &quot;streamSettings&quot;: {                &quot;network&quot;: &quot;kcp&quot;            }        }    ],    &quot;outboundDetour&quot;: [        {            &quot;protocol&quot;: &quot;blackhole&quot;,            &quot;settings&quot;: {},            &quot;tag&quot;: &quot;blocked&quot;        }    ],    &quot;routing&quot;: {        &quot;strategy&quot;: &quot;rules&quot;,        &quot;settings&quot;: {            &quot;rules&quot;: [                {                    &quot;type&quot;: &quot;field&quot;,                    &quot;ip&quot;: [                        &quot;0.0.0.0/8&quot;,                        &quot;10.0.0.0/8&quot;,                        &quot;100.64.0.0/10&quot;,                        &quot;127.0.0.0/8&quot;,                        &quot;169.254.0.0/16&quot;,                        &quot;172.16.0.0/12&quot;,                        &quot;192.0.0.0/24&quot;,                        &quot;192.0.2.0/24&quot;,                        &quot;192.168.0.0/16&quot;,                        &quot;198.18.0.0/15&quot;,                        &quot;198.51.100.0/24&quot;,                        &quot;203.0.113.0/24&quot;,                        &quot;::1/128&quot;,                        &quot;fc00::/7&quot;,                        &quot;fe80::/10&quot;                    ],                    &quot;outboundTag&quot;: &quot;blocked&quot;                }            ]        }    }}</code></pre><blockquote><p>éœ€è¦ä¿®æ”¹çš„å‚æ•°ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°<br><code>inbound.port</code> = <code>12345</code><br><code>inbound.settings.clients[0].id</code> = <code>aab9c609-44c4-eb73-aa1f-c6611657409c</code><br><code>inbound.settings.clients[0].alterId</code> = <code>100</code></p></blockquote><p>ä¹‹åæ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š<code>vim /etc/v2ray/config.json</code>ï¼ŒæŠŠç”Ÿæˆçš„é…ç½®æ‹·è´è¿›å»å³å¯ã€‚</p><p>æœ€åï¼Œå¯åŠ¨V2Ray</p><pre><code>service v2ray restart</code></pre><p>æŸ¥çœ‹V2Rayçš„çŠ¶æ€</p><pre><code># service v2ray statusâ— v2ray.service - V2Ray Service   Loaded: loaded (/etc/systemd/system/v2ray.service; enabled; vendor preset: enabled)   Active: active (running) since Fri 2019-03-29 15:37:10 CST; 4h 17min ago Main PID: 695 (v2ray)   CGroup: /system.slice/v2ray.service           â””â”€695 /usr/bin/v2ray/v2ray -config /etc/v2ray/config.jsonMar 29 15:37:10 v2ray systemd[1]: Started V2Ray Service.Mar 29 15:37:10 v2ray v2ray[695]: V2Ray 4.18.0 (Po) 20190228Mar 29 15:37:10 v2ray v2ray[695]: A unified platform for anti-censorship.</code></pre><h2 id="é…ç½®V2Rayå®¢æˆ·ç«¯"><a href="#é…ç½®V2Rayå®¢æˆ·ç«¯" class="headerlink" title="é…ç½®V2Rayå®¢æˆ·ç«¯"></a>é…ç½®V2Rayå®¢æˆ·ç«¯</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>windowsä¸‹é¢å»ºè®®ä½¿ç”¨v2rayN: <a href="https://github.com/2dust/v2rayN/releasesï¼Œ" target="_blank" rel="noopener">https://github.com/2dust/v2rayN/releasesï¼Œ</a> å¼ºå¤§å¥½ç”¨ï¼Œä¸ç”¨é…ç½®æµè§ˆå™¨ã€‚å®¢æˆ·ç«¯ä¼šç”¨åˆ°é…ç½®æ–‡ä»¶æ¨¡æ¿å¦‚ä¸‹ï¼š</p><pre><code>{    &quot;log&quot;: {        &quot;loglevel&quot;: &quot;warning&quot;    },    &quot;inbound&quot;: {        &quot;listen&quot;: &quot;127.0.0.1&quot;,        &quot;port&quot;: 1081,        &quot;protocol&quot;: &quot;socks&quot;,        &quot;settings&quot;: {            &quot;auth&quot;: &quot;noauth&quot;,            &quot;udp&quot;: true,            &quot;ip&quot;: &quot;127.0.0.1&quot;        }    },    &quot;outbound&quot;: {        &quot;protocol&quot;: &quot;vmess&quot;,        &quot;settings&quot;: {            &quot;vnext&quot;: [                {                    &quot;address&quot;: &quot;192.168.10.1&quot;,                    &quot;port&quot;: 12345,                    &quot;users&quot;: [                        {                            &quot;id&quot;: &quot;c383e9af-8d5a-9d58-9c14-9d1bc2363ff9&quot;,                            &quot;level&quot;: 1,                            &quot;alterId&quot;: 100                        }                    ]                }            ]        },        &quot;streamSettings&quot;: {            &quot;network&quot;: &quot;kcp&quot;        }    },    &quot;outboundDetour&quot;: [        {            &quot;protocol&quot;: &quot;freedom&quot;,            &quot;settings&quot;: {},            &quot;tag&quot;: &quot;direct&quot;        }    ],    &quot;routing&quot;: {        &quot;strategy&quot;: &quot;rules&quot;,        &quot;settings&quot;: {            &quot;rules&quot;: [                {                    &quot;type&quot;: &quot;field&quot;,                    &quot;port&quot;: &quot;54-79&quot;,                    &quot;outboundTag&quot;: &quot;direct&quot;                },                {                    &quot;type&quot;: &quot;field&quot;,                    &quot;port&quot;: &quot;81-442&quot;,                    &quot;outboundTag&quot;: &quot;direct&quot;                },                {                    &quot;type&quot;: &quot;field&quot;,                    &quot;port&quot;: &quot;444-65535&quot;,                    &quot;outboundTag&quot;: &quot;direct&quot;                },                {                    &quot;type&quot;: &quot;field&quot;,                    &quot;domain&quot;: [                        &quot;gc.kis.scr.kaspersky-labs.com&quot;                    ],                    &quot;outboundTag&quot;: &quot;direct&quot;                },                {                    &quot;type&quot;: &quot;chinasites&quot;,                    &quot;outboundTag&quot;: &quot;direct&quot;                },                {                    &quot;type&quot;: &quot;field&quot;,                    &quot;ip&quot;: [                        &quot;0.0.0.0/8&quot;,                        &quot;10.0.0.0/8&quot;,                        &quot;100.64.0.0/10&quot;,                        &quot;127.0.0.0/8&quot;,                        &quot;169.254.0.0/16&quot;,                        &quot;172.16.0.0/12&quot;,                        &quot;192.0.0.0/24&quot;,                        &quot;192.0.2.0/24&quot;,                        &quot;192.168.0.0/16&quot;,                        &quot;198.18.0.0/15&quot;,                        &quot;198.51.100.0/24&quot;,                        &quot;203.0.113.0/24&quot;,                        &quot;::1/128&quot;,                        &quot;fc00::/7&quot;,                        &quot;fe80::/10&quot;                    ],                    &quot;outboundTag&quot;: &quot;direct&quot;                },                {                    &quot;type&quot;: &quot;chinaip&quot;,                    &quot;outboundTag&quot;: &quot;direct&quot;                }            ]        }    }}</code></pre><p>å…¶ä¸­ä¸‹é¢éƒ¨åˆ†éœ€è¦ä¿®æ”¹ä¸ºå¯¹åº”è‡ªå·±æ­å»ºçš„v2rayä¿¡æ¯</p><pre><code>&quot;settings&quot;: {    &quot;vnext&quot;: [        {            &quot;address&quot;: &quot;192.168.10.1&quot;,            &quot;port&quot;: 12345,            &quot;users&quot;: [                {                    &quot;id&quot;: &quot;c383e9af-8d5a-9d58-9c14-9d1bc2363ff9&quot;,                    &quot;level&quot;: 1,                    &quot;alterId&quot;: 100                }            ]        }    ]},</code></pre><h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h3><p>åœ¨MacOSä¸‹å»ºè®®ä½¿ç”¨V2rayXå·¥å…·ï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/Cenmrev/V2RayX" target="_blank" rel="noopener">https://github.com/Cenmrev/V2RayX</a> ,å·¥å…·éå¸¸ä¾¿æ·å¼ºå¤§ï¼Œé…ç½®æ–¹å¼ä¹Ÿå¾ˆç®€å•ã€‚</p><h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/2dust/v2rayNG" target="_blank" rel="noopener">https://github.com/2dust/v2rayNG</a> ï¼Œæ‰¾åˆ°<code>release</code>å³å¯</p><h2 id="å¸è½½v2rayæœåŠ¡"><a href="#å¸è½½v2rayæœåŠ¡" class="headerlink" title="å¸è½½v2rayæœåŠ¡"></a>å¸è½½v2rayæœåŠ¡</h2><p>æœåŠ¡ç«¯å¦‚æœè¦å¸è½½v2rayï¼Œç›´æ¥æ‰§è¡Œ</p><pre><code>wget https://raw.githubusercontent.com/banbanpeppa/ss-fly/master/go.sh &amp;&amp; chmod +x go.sh &amp;&amp; ./go.sh --remove</code></pre><p>æ‰§è¡Œç»“æœ</p><pre><code>Shutting down V2Ray service.Removed symlink /etc/systemd/system/multi-user.target.wants/v2ray.service.Removed V2Ray successfully.If necessary, please remove configuration file and log file manually.</code></pre><h2 id="V2Rayçš„ä¼˜åŒ–"><a href="#V2Rayçš„ä¼˜åŒ–" class="headerlink" title="V2Rayçš„ä¼˜åŒ–"></a>V2Rayçš„ä¼˜åŒ–</h2><p>è°·æ­Œçš„BBRåŠ é€Ÿæ‰€æœ‰ï¼Œä¸€é”®å¼€å¯æ–¹å¼ï¼š</p><pre><code>wget hhttps://raw.githubusercontent.com/banbanpeppa/ss-fly/master/ss-fly.sh &amp;&amp; chmod +x ss-fly.sh &amp;&amp; ./ss-fly.sh -bbr</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>V2Rayä½œä¸ºä¸€ä¸ªæ–°å…´çš„ä»£ç†å·¥å…·ï¼Œå¥½ç”¨ç¨³å®šå®‰å…¨ï¼</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>githubï¼š<a href="https://github.com/banbanpeppa/ss-fly" target="_blank" rel="noopener">https://github.com/banbanpeppa/ss-fly</a><br>ä¸€é”®è„šæœ¬æ­å»ºV2Ray &amp; V2Rayé…ç½®ä¸ä¼˜åŒ–ï¼š <a href="https://www.flyzy2005.com/v2ray/how-to-build-v2ray/" target="_blank" rel="noopener">https://www.flyzy2005.com/v2ray/how-to-build-v2ray/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¹‹å‰ä½¿ç”¨vultrçš„VPSæ­å»ºSSRï¼Œä¸‰å¤©ä¸¤å¤´è¢«æŸ¥ï¼Œå‡ºä¸å»çš„å¿ƒæƒ…éå¸¸ä½è½ã€‚äºæ˜¯é‡‡ç”¨å¦ä¸€ä¸ªå·¥å…·v2rayï¼Œä½¿ç”¨ä¹‹åå‘ç°ç¨³å®šæ€§é«˜äº†å¾ˆå¤šã€‚è¯ä¸å¤šè¯´ï¼Œæèµ·ï¼&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯V2Ray&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯V2Ray&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
    
      <category term="éšç¬”" scheme="https://banbanpeppa.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
</feed>
